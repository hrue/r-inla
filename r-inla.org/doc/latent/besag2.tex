\documentclass[a4paper,11pt]{article}
\usepackage[scale={0.8,0.9},centering,includeheadfoot]{geometry}
\usepackage{amstext}
\usepackage{listings}
\begin{document}

\section*{Besag2 model for weighted spatial effects}

\subsection*{Parametrization}

The besag2 model is an extention to the besag model. Let the random
vector $\mathbf{z}=(x_1,\dots,x_n)$ be the besag model, then the
besag2 is the following extentions
\begin{displaymath}
    \mathbf{x} = (a\mathbf{z}, \mathbf{z}/a)
\end{displaymath}
where $a>0$ is an additional hyperparameter and
$\text{dim}(\mathbf{x}) = 2n$, and $\mathbf{z}$ is the \emph{same} (up
to tiny additive noise) random vector.

\subsection*{Hyperparameters}

This model has two hyperparameters $\mathbf{\theta} = (\theta_{1},
\theta_{2})$.

The precision parameter $\tau$ is represented as
\begin{displaymath}
    \theta_{1} =\log \tau
\end{displaymath}
and the prior is defined on $\theta_{1}$.

The weight-parameter $a$ is represented as
\begin{displaymath}
    \theta_{2} = \log a
\end{displaymath}
and the prior is defined on $\theta_{2}$.

\subsection*{Specification}

The besag2 model is specified inside the {\tt f()} function as
\begin{verbatim}
 f(<whatever>,model="besag2",graph.file=<graph file name>
              prior=c(<prior.model.theta1>, <prior.model.theta2>),
              param=c(<param.prior.theta1>, <param.prior.theta2>),
              precision=<precision>)
\end{verbatim}

The precision is the precision defining how equal the two copies of
$\mathbf{z}$ is. The neighbourhood structure of $\mathbf{x}$ is passed
to the program through the {\tt graph.file} argument.  The structure
of this file is described below.

Note that the besag2 model has dimension $2 n$, where $n$ is the
size of the graph.

\subsubsection*{Structure of the graph file}

We describe the required format for the graph file using a small
example. Let the file {\tt gra.dat}, relative to a small graph of only
5 elements, be
\begin{lstlisting}[basicstyle=\footnotesize]
    5
    1 1 2
    2 2 1 3
    3 3 2 4 5 
    4 1 3
    5 1 3
\end{lstlisting}
Line 1 declares the total number of nodes in the graph (5), then, in
lines 2-6 each node is described. For example, line 4 states that node
3 has 4 neighbours and these are nodes 2, 4 and 5.

The graph file can either have nodes indexed from 1 to $n$, or from 0
to $n-1$. Note that in the latter case, node $i$ seen from R
corresponds to node $i-1$ in the 0-indexed graph.



\subsection*{Example}

This is a simulated example.

\begin{verbatim}
data(Oral)
g = system.file("demodata/germany.graph", package="INLA")

## use data Oral to estimate a spatial field in order to simulate a
## 'realistic' dataset.
formula = Y ~ f(region, model="bym", graph.file=g)
result = inla(formula, data = Oral, family = "poisson", E = E)

x = result$summary.random$region$mean
n = length(x)/2

## simulate two new datasets. 'a' is the weighting between the
## log.rel.risk:
a = 2
xx = x[1:n]+1
x = c(a*xx, xx/a)
E = c(Oral$E, Oral$E)
N = 2*n
y = rpois(N, lambda = E*exp(x))

## model='besag2' defines a model with length N = 2*graph->n, the
## first half is weighted with 'a' the other half is weighted with
## 1/a. here there is no unstructed terms.
i = 1:N
formula = y ~ f(i, model="besag2", graph.file=g) -1
r = inla(formula, family = "poisson", data = data.frame(E,y,i), E=E, verbose=TRUE)
\end{verbatim}


\subsection*{Notes}

The besag2 model has default \texttt{constr=FALSE}, and
\texttt{constr=TRUE} does not make sense. 

The model is modified accordingly is the graph has more than one
connected components.


\end{document}


% LocalWords: 

%%% Local Variables: 
%%% TeX-master: t
%%% End: 
