\documentclass[a4paper,11pt]{article}
\usepackage[compat2]{geometry}
\usepackage{amstext}
\usepackage{amsmath,amssymb}
\usepackage{listings}
\def\mm#1{\ensuremath{\boldsymbol{#1}}} % version: amsmath
\begin{document}

\section*{Generic 2 model}

\subsection*{Parametrization}

The generic2 model implements the following precision matrix
\begin{equation}\label{eq1}%
    \mathbf{Q}=
    \begin{bmatrix}
        \tau_{u} \mm{I} & -\tau_{u}\mm{I} \\
        -\tau_{u}\mm{I} & \tau_{u}\mm{I} + \tau_{v} \mm{C}
    \end{bmatrix}
\end{equation}
where $\mathbf{C}$ is (a given) symmetric matrix. This model arrives from the
hierarchical model,
\begin{displaymath}
    \mm{v} \;\sim\; {\mathcal N}(\mm{0}, \tau_v \mm{C})
\end{displaymath}
and
\begin{displaymath}
    \mm{u}\mid \mm{v} \;\sim\; {\mathcal N}(\mm{v}, \tau_{u} \mm{I})
\end{displaymath}
and the precision matrix in Eq.~(\ref{eq1}) implements the joint
precision matrix of
\begin{displaymath}
    \begin{bmatrix}
        \mm{u}\\
        \mm{v}
    \end{bmatrix}
\end{displaymath}
using the following hyperparameters
\begin{displaymath}
    \tau_{v}\qquad\text{and}\qquad   h^{2} = \frac{1/\tau_{v}}{1/\tau_{v} + 1/\tau_{u}}.
\end{displaymath}


\subsection*{Hyperparameters}

The two parameters in the \texttt{generic2} model are represented as
\begin{eqnarray*}
    \theta_1 &= & \log(\tau_{v})\\
    \theta_2 &=& \log\left(
      \frac{h^{2}}{1-h^{2}}\right)
\end{eqnarray*}
and priors are assigned to $(\theta_1,\theta_2)$

\subsection*{Specification}

The generic2model is specified inside the {\tt f()} function as
\begin{verbatim}
 f(<whatever>,model="generic2",Cmatrix = <Cmat>,
              prior=c(<prior.model.theta1>,<prior.model.theta2>),
              param=c(<param.prior.theta1>,<param.prior.theta1>,
                      <param.prior.theta2>,<param.prior.theta2>))
\end{verbatim}
where {\tt <Cmat>} can be given in two different ways:
\begin{itemize}
\item a list of type {\tt Cmatrix = list(i = c(), j = c(), Cij =
        c())}, where {\tt i}, {\tt j} and {\tt Cij} are vectors of the
    non-zero elements of $\mathbf{C}$. Note that {\tt i} and {\tt j}
    start from 1, and only the upper or lower part of $\mathbf{C}$ has
    to be given.
\item the name of a file giving the structure matrix. The file should
    have the following format
    \[
    i\quad j\quad \mathbf{C}_{ij}
    \]
    where $i$ and $j$ are the row and column index and
    $\mathbf{C}_{ij}$ is the corresponding element of the precision
    matrix. Only the non-zero elements of the precision matrix need to
    be stored in the file. {\bf NOTE:} the indexes for $i$ and $j$
    start from 0, as this matrix is passed directly into the
    \texttt{inla}-program.
\end{itemize}

\subsection*{Example}
{\small\begin{verbatim}
require(mvtnorm)

n = 50
Cm = matrix(runif(n^2,min=-1,max=1),n,n)
Cm = Cm %*% t(Cm)
Sigma = solve(Cm)

sd = 0.001
z = rnorm(n,sd=sd)
eta = rmvnorm(n=1,sigma = Sigma)
s = 0.1
y = c(eta) + rnorm(n,sd=s) + z

file = "Cmatrix.dat"
cat("",file=file, append = FALSE)
for(i in 1:n)
{
    j = i
    cat(i-1,j-1,Cm[i,j], "\n", sep = " ", file=file, append=TRUE)
    if (i < n)
    {
        for(j in (i+1):n)
            cat(i-1,j-1,Cm[i,j], "\n", sep = " ", file=file, append=TRUE)
    }
}


idx = 1:n
formula = y ~ f(idx, model = "generic2", Cmatrix = file,
                initial=c(0,0), fixed=c(F,F))

result = inla(formula, data=data.frame(y,idx),
              control.data = list(initial = log(1/sd^2), fixed=TRUE),
              verbose = TRUE)


## tau.u should be about 1/s^2 = 100. increase `n' above to get
## it...
tau.u = result$summary.hyperpar["Precision-cmatrix for idx", "mean"]
h2 = result$summary.hyperpar["h2 for idx", "mean"]
tau.v = h2/(1-h2)*tau.u
print(paste("tau.v", tau.v, "should be (for large n)", 1/s^2))
\end{verbatim}}

\subsection*{Notes}

The option \texttt{constr=TRUE} will impose a sum-to-zero constraint
on $\mm{v}$ only.

\end{document}


% LocalWords:  Parametrization Eq hyperparameters Cmat Cmatrix Cij ij inla

%%% Local Variables: 
%%% TeX-master: t
%%% End: 
% LocalWords:  constr
