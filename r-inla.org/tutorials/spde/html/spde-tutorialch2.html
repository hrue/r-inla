<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>2 The SPDE approach</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<!-- xhtml,html,frames,2 --> 
<meta name="src" content="spde-tutorial.tex" /> 
<meta name="date" content="2017-01-22 14:18:00" /> 
<link rel="stylesheet" type="text/css" href="spde-tutorial.css" /> 
</head><body 
>
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="spde-tutorialch3.html" >next</a>] [<a 
href="spde-tutorialch1.html" >prev</a>] [<a 
href="spde-tutorialch1.html#tailspde-tutorialch1.html" >prev-tail</a>] [<a 
href="#tailspde-tutorialch2.html">tail</a>] [<a 
href="spde-tutorial3.html#spde-tutorialch2.html" >up</a>] </p></div>
   <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;2</span><br /><a 
 id="x6-80002"></a>The SPDE approach</h2>
<!--l. 3--><p class="noindent" >In the literature there are some ideas to fit GF by an approximation of the GF to any GMRF. A
very good way is to use an explicit link between the precision matrix from the solution to a
stochastic partial differential equation (SPDE) and the Matérn Gaussian random fields,
<span class="cite">[<a 
href="spde-tutorialli2.html#XlindgrenRL:2011">Lindgren et&#x00A0;al., 2011</a>]</span>. This approach provide an explicit link between GF and GMRF. It is
common to use the the Finite Element Method (FEM) to estimate the solution to an
SPDE. This is particularly convenient in the case where we have a set of irregular
locations.
</p>
   <h3 class="sectionHead"><span class="titlemark">2.1   </span> <a 
 id="x6-90002.1"></a>The <span class="cite">[<a 
href="spde-tutorialli2.html#XlindgrenRL:2011">Lindgren et&#x00A0;al., 2011</a>]</span> results</h3>
<!--l. 18--><p class="noindent" >The SPDE approach is based on two main results. The first one extends the result obtained by
<span class="cite">[<a 
href="spde-tutorialli2.html#Xbesag:1981">Besag, 1981</a>]</span>. This result is to approximate a GF with a generalized covariance function,
obtained when <span 
class="cmmi-10x-x-109">&#x03BD; </span><span 
class="cmsy-10x-x-109">&#x2192; </span><span 
class="cmr-10x-x-109">0 </span>in the Matérn correlation function. This approximation, considering a
regular two-dimensional lattice with number of sites tending to infinite, is that the full
conditional has
</p>
   <table 
class="equation"><tr><td><a 
 id="x6-9001r1"></a>
   <center class="math-display" >
<img 
src="spde-tutorial8x.png" alt="              1
E (xij|x-ij) = -(xi-1,j + xi+1,j + xi,j-1 + xi,j+1)
              a
" class="math-display"  /></center></td><td class="equation-label">(2.1)</td></tr></table>
<!--l. 28--><p class="nopar" >
and <span 
class="cmmi-10x-x-109">V ar</span><span 
class="cmr-10x-x-109">(</span><span 
class="cmmi-10x-x-109">x</span><sub><span 
class="cmmi-8">ij</span></sub><span 
class="cmsy-10x-x-109">|</span><span 
class="cmmi-10x-x-109">x</span><sub><span 
class="cmsy-8">-</span><span 
class="cmmi-8">ij</span></sub><span 
class="cmr-10x-x-109">) = 1</span><span 
class="cmmi-10x-x-109">&#x2215;a </span>for <span 
class="cmsy-10x-x-109">|</span><span 
class="cmmi-10x-x-109">a</span><span 
class="cmsy-10x-x-109">| </span><span 
class="cmmi-10x-x-109">&#x003E; </span><span 
class="cmr-10x-x-109">4</span>. In the representation using a precision matrix, we have,
for one single site, just the upper right quadrant and with <span 
class="cmmi-10x-x-109">a </span>as the central element,
that
</p>
   <table 
class="equation"><tr><td><a 
 id="x6-9002r2"></a>
   <center class="math-display" >
<img 
src="spde-tutorial9x.png" alt="- 1
 a  - 1
" class="math-display"  /></center></td><td class="equation-label">(2.2)</td></tr></table>
<!--l. 38--><p class="nopar" >
</p><!--l. 40--><p class="indent" >   Considering a GF <span 
class="cmmi-10x-x-109">x</span><span 
class="cmr-10x-x-109">(</span><span 
class="cmmib-10x-x-109">u</span><span 
class="cmr-10x-x-109">) </span>with the Matérn covariance is a solution to the linear fractional
SPDE
                                                                                 
                                                                                 
</p>
   <table 
class="equation"><tr><td><a 
 id="x6-9003r3"></a>
   <center class="math-display" >
<img 
src="spde-tutorial10x.png" alt="(&#x03BA;2 - &#x0394; )&#x03B1;&#x2215;2x (u ) = W (u),u &#x2208; &#x211C;d,&#x03B1; = &#x03BD; + d&#x2215;2,&#x03BA; &#x003E; 0,&#x03BD; &#x003E; 0,
" class="math-display"  /></center></td><td class="equation-label">(2.3)</td></tr></table>
<!--l. 45--><p class="nopar" >
<span class="cite">[<a 
href="spde-tutorialli2.html#XlindgrenRL:2011">Lindgren et&#x00A0;al., 2011</a>]</span> show that for <span 
class="cmmi-10x-x-109">&#x03BD; </span><span 
class="cmr-10x-x-109">= 1 </span>and <span 
class="cmmi-10x-x-109">&#x03BD; </span><span 
class="cmr-10x-x-109">= 2 </span>the GMRF representations are
convolutions of (<a 
href="#x6-9002r2">2.2<!--tex4ht:ref: eq:q0 --></a>). So, for <span 
class="cmmi-10x-x-109">&#x03BD; </span><span 
class="cmr-10x-x-109">= 1</span>, in that representation we have:
</p>
   <table 
class="equation"><tr><td><a 
 id="x6-9004r4"></a>
   <center class="math-display" >
<img 
src="spde-tutorial11x.png" alt="   1
 - 2a    2
4 + a2  - 2a  1
" class="math-display"  /></center></td><td class="equation-label">(2.4)</td></tr></table>
<!--l. 55--><p class="nopar" >
 and, for <span 
class="cmmi-10x-x-109">&#x03BD; </span><span 
class="cmr-10x-x-109">= 2</span>:
</p>
   <table 
class="equation"><tr><td><a 
 id="x6-9005r5"></a>
   <center class="math-display" >
<img 
src="spde-tutorial12x.png" alt="    - 1
    3a2          - 3
- 3(a + 3)      6a      3
 a(a2 + 12)  - 3(a2 + 3) 3a  - 1
" class="math-display"  /></center></td><td class="equation-label">(2.5)</td></tr></table>
<!--l. 64--><p class="nopar" >
</p><!--l. 66--><p class="indent" >   This is an intuitive result, because if we have larger <span 
class="cmmi-10x-x-109">&#x03BD; </span>on the Matérn correlation function of
the GF, we need more non zero neighbours sites in the GMRF representation. Remember that it
is the smoothness parameter, so if the process is more smooth, the precision matrix
has values over a larger neighbourhood areas. Hovewer, it does not means that one
                                                                                 
                                                                                 
can just averages over larger neighboorhod to make it smooth. However, it does not
means averaging over larger neighboorhod to make it smoother. This is like when
going from first order random walk to the second order one: to square the precision
matrix.
</p><!--l. 79--><p class="indent" >   If the spatial locations are on a irregular grid, it is necessary to use the second result in
<span class="cite">[<a 
href="spde-tutorialli2.html#XlindgrenRL:2011">Lindgren et&#x00A0;al., 2011</a>]</span>. To extend the first result, the finite element method (FEM) is used for a
interpolation of the locations of observations to the nearest grid point. To do it, suppose that the
<span 
class="cmsy-10x-x-109">&#x211C;</span><sup><span 
class="cmr-8">2</span></sup> is subdivided into a set of non-intersecting triangles, where any two triangles meet in at most
a common edge or corner. The three corners of a triangle are named <span 
class="aeti-10x-x-109">vertices</span>. The suggestion is
to start with the location of the observed points and add some triangles (heuristically) with
restriction to maximize the allowed edge length and minimize the allowed angles. The
approximation is
</p>
   <center class="math-display" >
<img 
src="spde-tutorial13x.png" alt="       &#x2211;n
x (u ) =    &#x03C8;k(u)wk
       k=1
" class="math-display"  /></center>
<!--l. 94--><p class="nopar" > for some chosen basis functions <span 
class="cmmi-10x-x-109">&#x03C8;</span><sub><span 
class="cmmi-8">k</span></sub>, Gaussian distributed weights <span 
class="cmmi-10x-x-109">w</span><sub><span 
class="cmmi-8">k</span></sub> and <span 
class="cmmi-10x-x-109">n </span>the number of
vertices on the triangulation. If the functions <span 
class="cmmi-10x-x-109">&#x03C8;</span><sub><span 
class="cmmi-8">k</span></sub> are piecewise linear in each triangle, <span 
class="cmmi-10x-x-109">&#x03C8;</span><sub><span 
class="cmmi-8">k</span></sub> is 1 at
vertices <span 
class="cmmi-10x-x-109">k </span>and 0 at all other vertices.
</p><!--l. 102--><p class="indent" >   The second result is obtained using the <span 
class="cmmi-10x-x-109">n </span><span 
class="cmsy-10x-x-109">&#x00D7; </span><span 
class="cmmi-10x-x-109">n </span>matrices <span 
class="cmmib-10x-x-109">C</span>, <span 
class="cmmib-10x-x-109">G</span> and <span 
class="cmmib-10x-x-109">K</span> with entries
</p>
   <table 
class="equation"><tr><td><a 
 id="x6-9006r6"></a>
   <center class="math-display" >
<img 
src="spde-tutorial14x.png" alt="Ci,j = &#x27E8;&#x03C8;i,&#x03C8;j&#x27E9;,Gi,j = &#x27E8;&#x2207; &#x03C8;i,&#x2207;&#x03C8;j&#x27E9;,(K &#x03BA;2)i,j = &#x03BA;2Ci,j + Gi,j
" class="math-display"  /></center></td><td class="equation-label">(2.6)</td></tr></table>
<!--l. 108--><p class="nopar" >
to get the precision matrix <span 
class="cmmib-10x-x-109">Q</span><sub><span 
class="cmmi-8">&#x03B1;,&#x03BA;</span></sub> as a function of <span 
class="cmmi-10x-x-109">&#x03BA;</span><sup><span 
class="cmr-8">2</span></sup> and <span 
class="cmmi-10x-x-109">&#x03B1;</span>:
</p>
   <table 
class="equation"><tr><td><a 
 id="x6-9007r7"></a>
   <center class="math-display" >
<img 
src="spde-tutorial15x.png" alt="                Q1,&#x03BA;2 = K &#x03BA;2,
            Q2,&#x03BA;2 = K &#x03BA;2C -1K &#x03BA;2,
Q   2 = K  2C -1Q     2C -1K  2,for&#x03B1; =  3,4,....
  &#x03B1;,&#x03BA;      &#x03BA;       &#x03B1;-2,&#x03BA;       &#x03BA;
" class="math-display"  /></center></td><td class="equation-label">(2.7)</td></tr></table>
                                                                                 
                                                                                 
<!--l. 116--><p class="nopar" >
Again, increasing <span 
class="cmmi-10x-x-109">&#x03BD; </span>denser the precision matrix.
</p><!--l. 119--><p class="indent" >   The <span 
class="cmmib-10x-x-109">Q</span> precision matrix is generalized for a fractional values of <span 
class="cmmi-10x-x-109">&#x03B1; </span>(or <span 
class="cmmi-10x-x-109">&#x03BD;</span>) using a
Taylor approximation, see the author&#8217;s discussion response in <span class="cite">[<a 
href="spde-tutorialli2.html#XlindgrenRL:2011">Lindgren et&#x00A0;al., 2011</a>]</span>.
From this approximation, we have the polynomial of order <span 
class="cmmi-10x-x-109">p </span><span 
class="cmr-10x-x-109">= </span><span 
class="cmsy-10x-x-109">&#x2308;</span><span 
class="cmmi-10x-x-109">&#x03B1;</span><span 
class="cmsy-10x-x-109">&#x2309; </span>for the precision
matrix
</p>
   <table 
class="equation"><tr><td><a 
 id="x6-9008r8"></a>
   <center class="math-display" >
<img 
src="spde-tutorial16x.png" alt="      p
Q  = &#x2211;  b C (C- 1G)i.
         i
     i=0
" class="math-display"  /></center></td><td class="equation-label">(2.8)</td></tr></table>
<!--l. 126--><p class="nopar" >
For <span 
class="cmmi-10x-x-109">&#x03B1; </span><span 
class="cmr-10x-x-109">= 1 </span>and <span 
class="cmmi-10x-x-109">&#x03B1; </span><span 
class="cmr-10x-x-109">= 2 </span>we have the (<a 
href="#x6-9007r7">2.7<!--tex4ht:ref: eq:Qalpha --></a>). Because for <span 
class="cmmi-10x-x-109">&#x03B1; </span><span 
class="cmr-10x-x-109">= 1</span>, we have <span 
class="cmmi-10x-x-109">b</span><sub><span 
class="cmr-8">0</span></sub> <span 
class="cmr-10x-x-109">= </span><span 
class="cmmi-10x-x-109">&#x03BA;</span><sup><span 
class="cmr-8">2</span></sup> and <span 
class="cmmi-10x-x-109">b</span><sub><span 
class="cmr-8">1</span></sub> <span 
class="cmr-10x-x-109">= 1</span>, and for
<span 
class="cmmi-10x-x-109">&#x03B1; </span><span 
class="cmr-10x-x-109">= 2</span>, we have <span 
class="cmmi-10x-x-109">b</span><sub><span 
class="cmr-8">0</span></sub> <span 
class="cmr-10x-x-109">= </span><span 
class="cmmi-10x-x-109">&#x03BA;</span><sup><span 
class="cmr-8">4</span></sup>, <span 
class="cmmi-10x-x-109">b</span><sub><span 
class="cmr-8">1</span></sub> <span 
class="cmr-10x-x-109">= </span><span 
class="cmmi-10x-x-109">&#x03B1;&#x03BA;</span><sup><span 
class="cmr-8">4</span></sup> and <span 
class="cmmi-10x-x-109">b</span><sub><span 
class="cmr-8">2</span></sub> <span 
class="cmr-10x-x-109">= 1</span>. For fractional <span 
class="cmmi-10x-x-109">&#x03B1; </span><span 
class="cmr-10x-x-109">= 1</span><span 
class="cmmi-10x-x-109">&#x2215;</span><span 
class="cmr-10x-x-109">2</span>, <span 
class="cmmi-10x-x-109">b</span><sub><span 
class="cmr-8">0</span></sub> <span 
class="cmr-10x-x-109">= 3</span><span 
class="cmmi-10x-x-109">&#x03BA;&#x2215;</span><span 
class="cmr-10x-x-109">4 </span>and
<span 
class="cmmi-10x-x-109">b</span><sub><span 
class="cmr-8">1</span></sub> <span 
class="cmr-10x-x-109">= </span><span 
class="cmmi-10x-x-109">&#x03BA;</span><sup><span 
class="cmsy-8">-</span><span 
class="cmr-8">1</span></sup><span 
class="cmr-10x-x-109">3</span><span 
class="cmmi-10x-x-109">&#x2215;</span><span 
class="cmr-10x-x-109">8</span>. And for <span 
class="cmmi-10x-x-109">&#x03B1; </span><span 
class="cmr-10x-x-109">= 3</span><span 
class="cmmi-10x-x-109">&#x2215;</span><span 
class="cmr-10x-x-109">2 </span>(<span 
class="cmmi-10x-x-109">&#x03BD; </span><span 
class="cmr-10x-x-109">= 0</span><span 
class="cmmi-10x-x-109">.</span><span 
class="cmr-10x-x-109">5</span>, the exponential case), <span 
class="cmmi-10x-x-109">b</span><sub><span 
class="cmr-8">0</span></sub> <span 
class="cmr-10x-x-109">= 15</span><span 
class="cmmi-10x-x-109">&#x03BA;</span><sup><span 
class="cmr-8">3</span></sup><span 
class="cmmi-10x-x-109">&#x2215;</span><span 
class="cmr-10x-x-109">16</span>, <span 
class="cmmi-10x-x-109">b</span><sub><span 
class="cmr-8">1</span></sub> <span 
class="cmr-10x-x-109">= 15</span><span 
class="cmmi-10x-x-109">&#x03BA;&#x2215;</span><span 
class="cmr-10x-x-109">8</span>,
<span 
class="cmmi-10x-x-109">b</span><sub><span 
class="cmr-8">2</span></sub> <span 
class="cmr-10x-x-109">= 15</span><span 
class="cmmi-10x-x-109">&#x03BA;</span><sup><span 
class="cmsy-8">-</span><span 
class="cmr-8">1</span></sup><span 
class="cmmi-10x-x-109">&#x2215;</span><span 
class="cmr-10x-x-109">128</span>. Using these results combined with recursive construction, for <span 
class="cmmi-10x-x-109">&#x03B1; &#x003E; </span><span 
class="cmr-10x-x-109">2</span>, we have
GMRF approximations for all positive integers and half-integers.
</p><!--l. 1--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">2.2   </span> <a 
 id="x6-100002.2"></a>The triangulation</h3>
<!--l. 5--><p class="noindent" >The first step to fit the model is the construction of the &#8217;mesh&#8217;. This step must be done VERY
CAREFULLY. It is similar to choosing the integration points on a numeric integration
algorithm. Should the boints be regular? How many points are needed?
</p><!--l. 13--><p class="indent" >   Additionally, we need to add, ALSO CAREFULLY, additional points around the boundary,
the outer extension. This is necessary to avoid a boundary effect where we have a variance twice
as larger at the border than within the domain <span class="cite">[<a 
href="spde-tutorialli2.html#Xlindgren:2012">Lindgren, 2012</a>]</span>. For more about it please see
<span class="cite">[<a 
href="spde-tutorialli2.html#XlindgrenR:2013">Lindgren and Rue, 2013</a>]</span>.
</p><!--l. 22--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.2.1   </span> <a 
 id="x6-110002.2.1"></a>Getting started</h4>
<!--l. 24--><p class="noindent" >For a two dimentional mesh, we have a main function <span 
class="aett-10x-x-109">inla.mesh.2d() </span>that is recommended to
use for building a mesh. This function creates the Constrained Refined Delaunay Triangulation
(CRDT) that we just call mesh. There are a several options:
</p>
   <div class="fancyvrb" id="fancyvrb21"><a 
 id="x6-11002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;args(inla.mesh.2d)</span></div>
<!--l. 34--><p class="noindent" >
                                                                                 
                                                                                 
</p>
   <div class="fancyvrb" id="fancyvrb22"><a 
 id="x6-11004r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;function</span><span 
class="aett-10x-x-109">&#x00A0;(loc</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;NULL,</span><span 
class="aett-10x-x-109">&#x00A0;loc.domain</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;NULL,</span><span 
class="aett-10x-x-109">&#x00A0;offset</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;NULL,</span><span 
class="aett-10x-x-109">&#x00A0;n</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;NULL,</span>
<br class="fancyvrb" /><a 
 id="x6-11006r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;boundary</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;NULL,</span><span 
class="aett-10x-x-109">&#x00A0;interior</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;NULL,</span><span 
class="aett-10x-x-109">&#x00A0;max.edge,</span><span 
class="aett-10x-x-109">&#x00A0;min.angle</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;NULL,</span>
<br class="fancyvrb" /><a 
 id="x6-11008r3"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;cutoff</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;1e-12,</span><span 
class="aett-10x-x-109">&#x00A0;plot.delay</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;NULL)</span><br class="fancyvrb" /><a 
 id="x6-11010r4"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;NULL</span></div>
<!--l. 42--><p class="indent" >   We need some reference about the study region, which can be provided by the location
points or just a domain. The location, supplied on the <span 
class="aett-10x-x-109">loc </span>argument, are used as initial
triangulation nodes. A single polygon can be supplied to determine the domain extent on the
<span 
class="aett-10x-x-109">loc.domain </span>argument. If we supply the point locations, or the domain is supplied using the
<span 
class="aett-10x-x-109">loc.domain </span>argument, the algorithm find a convex hull mesh. A non convex hull mesh can be
made when we provide a (list of) set of polygons on the <span 
class="aett-10x-x-109">boundary </span>argument, where each
element of this list is of <span 
class="aett-10x-x-109">inla.mesh.segment() </span>class. So, one of these three options is
mandatory.
</p><!--l. 57--><p class="indent" >   The other mandatory argument is the <span 
class="aett-10x-x-109">max.edge</span>. This argument specifies the maximum
allowed triangle edge lengths in the inner domain and in the outer extension. So, it is a scalar or
length two vector. This argument is numeric on the <span 
class="aebx-10x-x-109">SAME SCALE UNIT </span>as the
coordinates.
</p><!--l. 65--><p class="indent" >   The another arguments are used to specify additional conditions. The <span 
class="aett-10x-x-109">offset </span>is a numeric,
or length two vector. If negative it is interpreted as a factor relative to the approximate data
diameter. If positive it is the extension distance on same scale unit to the coordinates
provided.
</p><!--l. 72--><p class="indent" >   The argument <span 
class="aett-10x-x-109">n </span>is the initial number of points on the extended boundary. The <span 
class="aett-10x-x-109">interior </span>is a
list of segments to specify interior constraints, each one of <span 
class="aett-10x-x-109">inla.mesh.segment </span>class. A good
mesh needs to have triangles as regular as possible in size and shape. To help this requirement
in addition to <span 
class="aett-10x-x-109">max.edge</span>, we have the <span 
class="aett-10x-x-109">min.angle </span>argument, which can be scalar or
length two vector, to specify the minimum internal angles of the triangles on the inner
domain and on the outer extension. Values up to 21 guarantee the convergence of the
algorithm.
</p><!--l. 89--><p class="indent" >   To further control the shape of the triangles, we also have the <span 
class="aett-10x-x-109">cutoff </span>argument, which is the
minimum allowed distance between points. It means that points at a closer distance than the
supplied value are replaced by a single vertex. So, it avoids small triangles and must be a
positive number, and is critical when we have some very close points, either for point locations
or on the domain boundary.
</p><!--l. 100--><p class="indent" >   To understand how this function works, we apply it while varying some arguments to the
first five locations of the toy dataset.
</p>
   <div class="fancyvrb" id="fancyvrb23"><a 
 id="x6-11012r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;data(SPDEtoy)</span><br class="fancyvrb" /><a 
 id="x6-11014r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;coords</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;as.matrix(SPDEtoy[,1:2])</span><span 
class="aesltt-10x-x-109">&#x00A0;;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;p5</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;coords[1:5,]</span></div>
<!--l. 109--><p class="noindent" >We also build some meshes using the domain and not the points and we define the domain
with
</p>
   <div class="fancyvrb" id="fancyvrb24"><a 
 id="x6-11016r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;pl.dom</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;cbind(c(0,1,1,0.7,0),</span><span 
class="aesltt-10x-x-109">&#x00A0;c(0,0,0.7,1,1))</span></div>
<!--l. 117--><p class="indent" >   Creating some meshes for the first five points:
</p>
   <div class="fancyvrb" id="fancyvrb25"><a 
 id="x6-11018r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m1</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(p5,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(0.5,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.5))</span>
<br class="fancyvrb" /><a 
 id="x6-11020r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m2</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(p5,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(0.5,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.5),</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.1)</span>
<br class="fancyvrb" /><a 
 id="x6-11022r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m3</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(p5,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(0.1,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.5),</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.1)</span>
<br class="fancyvrb" /><a 
 id="x6-11024r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m4</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(p5,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(0.1,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.5),</span><span 
class="aesltt-10x-x-109">&#x00A0;offset=c(0,-0.65))</span>
<br class="fancyvrb" /><a 
 id="x6-11026r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m5</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(,</span><span 
class="aesltt-10x-x-109">&#x00A0;pl.dom,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(0.3,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.5),</span><span 
class="aesltt-10x-x-109">&#x00A0;offset=c(0.03,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.5))</span>
<br class="fancyvrb" /><a 
 id="x6-11028r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m6</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(,</span><span 
class="aesltt-10x-x-109">&#x00A0;pl.dom,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(0.3,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.5),</span><span 
class="aesltt-10x-x-109">&#x00A0;offset=c(0.03,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.5),</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.1)</span>
<br class="fancyvrb" /><a 
 id="x6-11030r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m7</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(,</span><span 
class="aesltt-10x-x-109">&#x00A0;pl.dom,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(0.3,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.5),</span><span 
class="aesltt-10x-x-109">&#x00A0;n=5,</span><span 
class="aesltt-10x-x-109">&#x00A0;offset=c(.05,.1))</span>
<br class="fancyvrb" /><a 
 id="x6-11032r8"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m8</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(,</span><span 
class="aesltt-10x-x-109">&#x00A0;pl.dom,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(.3,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.5),</span><span 
class="aesltt-10x-x-109">&#x00A0;n=7,</span><span 
class="aesltt-10x-x-109">&#x00A0;offset=c(.01,.3))</span>
<br class="fancyvrb" /><a 
 id="x6-11034r9"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m9</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(,</span><span 
class="aesltt-10x-x-109">&#x00A0;pl.dom,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(.3,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.5),</span><span 
class="aesltt-10x-x-109">&#x00A0;n=4,</span><span 
class="aesltt-10x-x-109">&#x00A0;offset=c(.05,.3))</span></div>
                                                                                 
                                                                                 
<!--l. 131--><p class="noindent" >We visualize these meshes in Figure&#x00A0;<a 
href="#x6-110491">2.1<!--tex4ht:ref: fig:meshtest --></a>, produced with the code below
</p>
   <div class="fancyvrb" id="fancyvrb26"><a 
 id="x6-11036r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mfrow=c(3,</span><span 
class="aesltt-10x-x-109">&#x00A0;3),</span><span 
class="aesltt-10x-x-109">&#x00A0;mar=c(0,0,1,0))</span><br class="fancyvrb" /><a 
 id="x6-11038r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;for</span><span 
class="aesltt-10x-x-109">&#x00A0;(i</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;1:9)</span><span 
class="aesltt-10x-x-109">&#x00A0;{</span>
<br class="fancyvrb" /><a 
 id="x6-11040r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(pl.dom,</span><span 
class="aesltt-10x-x-109">&#x00A0;type=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">l</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=3,</span><span 
class="aesltt-10x-x-109">&#x00A0;lwd=2*(i&#x003E;4),</span><span 
class="aesltt-10x-x-109">&#x00A0;xlim=c(-0.57,1.57),</span>
<br class="fancyvrb" /><a 
 id="x6-11042r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;main</span><span 
class="aesltt-10x-x-109">&#x00A0;=</span><span 
class="aesltt-10x-x-109">&#x00A0;paste(</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">m</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,i,sep=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">),</span><span 
class="aesltt-10x-x-109">&#x00A0;asp=1,</span><span 
class="aesltt-10x-x-109">&#x00A0;axes=FALSE)</span>
<br class="fancyvrb" /><a 
 id="x6-11044r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(get(paste(</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">m</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;i,</span><span 
class="aesltt-10x-x-109">&#x00A0;sep=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">)),</span><span 
class="aesltt-10x-x-109">&#x00A0;add=TRUE)</span><br class="fancyvrb" /><a 
 id="x6-11046r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;points(p5,</span><span 
class="aesltt-10x-x-109">&#x00A0;pch=19,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=2)</span><br class="fancyvrb" /><a 
 id="x6-11048r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;}</span></div>
<hr class="figure" /><div class="figure" 
><a 
 id="x6-110491"></a><img 
src="spde-tutorial17x.png" alt="PIC" class="graphics" width="422.52936pt" height="422.54613pt"  /><!--tex4ht:graphics  
name="spde-tutorial17x.png" src="figs/mesh-vvizmesh.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;2.1: </span><span  
class="content">Triangulation with different restrictions.</span></div><!--tex4ht:label?: x6-110491 -->
   </div><hr class="endfigure" />
<!--l. 151--><p class="indent" >   The <span 
class="aett-10x-x-109">m1 </span>mesh has two main problems: 1) some triangles with small inner angles, 2) some large
triangles in the inner domain. In the <span 
class="aett-10x-x-109">m2 </span>mesh, we relax the restriction on the locations, because
points with distance less than the cutoff are considered a single vertex. This avoids some of
the triangles (at bottom right side) with small angles on the previous mesh. So the
<span 
class="aebx-10x-x-109">cutoff is a VERY GOOD idea</span>! Each inner triangle in the <span 
class="aett-10x-x-109">m3 </span>mesh on the top
right had edge length less than 0.1 and this mesh looks better than the two previous
ones.
</p><!--l. 164--><p class="indent" >   The <span 
class="aett-10x-x-109">m4 </span>was made without first building a convex hull extension around the points. It has just
the second outer bondary. In this case, the length of inner triangles does not work (first value on
<span 
class="aett-10x-x-109">max.edge </span>argument) and we have triangles with edge lengths up to 0.5. The shape of the
triangles looks good, except for these ones with vertices including the two points at the bottom
right side.
                                                                                 
                                                                                 
</p><!--l. 174--><p class="indent" >   The <span 
class="aett-10x-x-109">m5 </span>mesh was made just using the domain polygon and it has shape similar to the
domain area. In this mesh we have some small triangles at corners due the fact that is was built
without specifying a <span 
class="aett-10x-x-109">cutoff</span>. Also, we have a (relatively) small first extension and a (relatively)
large second one. On the <span 
class="aett-10x-x-109">m6 </span>mesh we have added the cutoff and got a better mesh than the
previous one.
</p><!--l. 183--><p class="indent" >   In the last tree meshes we change the initial number of extension points. It can be useful to
change in some situations to get convergence. Here we show the shape of the mesh that we got
with, for example, <span 
class="aett-10x-x-109">n=5</span>, in the <span 
class="aett-10x-x-109">m7 </span>mesh. This number produces a mesh that seems inadequate for
this domain because we have a non uniform exension behind the border. The <span 
class="aett-10x-x-109">m9 </span>mesh has very
bad triangles shapes.
</p><!--l. 196--><p class="indent" >   The object returned by the <span 
class="aett-10x-x-109">inla.mesh.2d() </span>function is of class <span 
class="aett-10x-x-109">inla.mesh </span>and contains a
list of things:
</p>
   <div class="fancyvrb" id="fancyvrb27"><a 
 id="x6-11051r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;class(m1)</span></div>
<!--l. 203--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb28"><a 
 id="x6-11053r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;"inla.mesh"</span></div>
<!--l. 206--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb29"><a 
 id="x6-11055r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;names(m1)</span></div>
<!--l. 209--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb30"><a 
 id="x6-11057r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;"meta"</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;"manifold"</span><span 
class="aett-10x-x-109">&#x00A0;"n"</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;"loc"</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;"graph"</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;"segm"</span><br class="fancyvrb" /><a 
 id="x6-11059r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[7]</span><span 
class="aett-10x-x-109">&#x00A0;"idx"</span></div>
<!--l. 214--><p class="noindent" >The number of vertices on each mesh is
</p>
   <div class="fancyvrb" id="fancyvrb31"><a 
 id="x6-11061r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;c(m1$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;m2$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;m3$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;m4$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;m5$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;m6$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;m7$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;m8$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;m9$n)</span></div>
<!--l. 219--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb32"><a 
 id="x6-11063r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;61</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;36</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;79</span><span 
class="aett-10x-x-109">&#x00A0;195</span><span 
class="aett-10x-x-109">&#x00A0;117</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;88</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;87</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;69</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;72</span></div>
<!--l. 223--><p class="noindent" >The &#8217;graph&#8217; element represents the CRDT obtained. In addition, the &#8217;graph&#8217; element contains the
matrix that represents the graph of the neighborhood structure. For example, for <span 
class="aett-10x-x-109">m1 </span>we have
&#8217;A&#8217;
</p>
   <div class="fancyvrb" id="fancyvrb33"><a 
 id="x6-11065r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;dim(m1$graph$vv)</span></div>
<!--l. 231--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb34"><a 
 id="x6-11067r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;61</span><span 
class="aett-10x-x-109">&#x00A0;61</span></div>
<!--l. 235--><p class="noindent" >The vertices that correspond the location points are identified in the &#8217;idx&#8217; element
</p>
   <div class="fancyvrb" id="fancyvrb35"><a 
 id="x6-11069r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m1$idx$loc</span></div>
<!--l. 241--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb36"><a 
 id="x6-11071r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;24</span><span 
class="aett-10x-x-109">&#x00A0;25</span><span 
class="aett-10x-x-109">&#x00A0;26</span><span 
class="aett-10x-x-109">&#x00A0;27</span><span 
class="aett-10x-x-109">&#x00A0;28</span></div>
                                                                                 
                                                                                 
<!--l. 246--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.2.2   </span> <a 
 id="x6-120002.2.2"></a>Non-convex hull meshes</h4>
<!--l. 248--><p class="noindent" >All the meshes in Figure&#x00A0;<a 
href="#x6-110491">2.1<!--tex4ht:ref: fig:meshtest --></a> are made to have a convex hull boundary. A convex hull is a
polygon of triangles out of the domain area, the extension made to avoid the boundary effect. A
triangulation without an additional border can be made by supplying the <span 
class="aett-10x-x-109">boundary </span>argument
instead of the <span 
class="aett-10x-x-109">location </span>or <span 
class="aett-10x-x-109">loc.domain </span>argument. One way is to build a boundary for the points
and supply it on <span 
class="aett-10x-x-109">boundary </span>argument.
</p><!--l. 260--><p class="indent" >   We can also build boundaries using the <span 
class="aett-10x-x-109">inla.nonconvex.hull() </span>function
</p>
   <div class="fancyvrb" id="fancyvrb37"><a 
 id="x6-12002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;args(inla.nonconvex.hull)</span></div>
<!--l. 266--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb38"><a 
 id="x6-12004r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;function</span><span 
class="aett-10x-x-109">&#x00A0;(points,</span><span 
class="aett-10x-x-109">&#x00A0;convex</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;-0.15,</span><span 
class="aett-10x-x-109">&#x00A0;concave</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;convex,</span><span 
class="aett-10x-x-109">&#x00A0;resolution</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;40,</span><br class="fancyvrb" /><a 
 id="x6-12006r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;eps</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;NULL)</span><br class="fancyvrb" /><a 
 id="x6-12008r3"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;NULL</span></div>
<!--l. 272--><p class="noindent" >In this function we provide the points and set some constraint. We can control the shape of the
boundary including its convexity, concavity and resolution. Here, we make some boundaries and
build a mesh with each one to better understand it.
</p>
   <div class="fancyvrb" id="fancyvrb39"><a 
 id="x6-12010r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;bound1</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.nonconvex.hull(p5)</span><br class="fancyvrb" /><a 
 id="x6-12012r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;bound2</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.nonconvex.hull(p5,</span><span 
class="aesltt-10x-x-109">&#x00A0;convex=0.5,</span><span 
class="aesltt-10x-x-109">&#x00A0;concave=-0.15)</span>
<br class="fancyvrb" /><a 
 id="x6-12014r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;bound3</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.nonconvex.hull(p5,</span><span 
class="aesltt-10x-x-109">&#x00A0;concave=0.5)</span>
<br class="fancyvrb" /><a 
 id="x6-12016r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;bound4</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.nonconvex.hull(p5,</span><span 
class="aesltt-10x-x-109">&#x00A0;concave=0.5,</span><span 
class="aesltt-10x-x-109">&#x00A0;resolution=c(20,</span><span 
class="aesltt-10x-x-109">&#x00A0;20))</span>
<br class="fancyvrb" /><a 
 id="x6-12018r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m10</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(boundary=bound1,</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.05,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(.1,.2))</span>
<br class="fancyvrb" /><a 
 id="x6-12020r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m11</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(boundary=bound2,</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.05,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(.1,.2))</span>
<br class="fancyvrb" /><a 
 id="x6-12022r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m12</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(boundary=bound3,</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.05,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(.1,.2))</span>
<br class="fancyvrb" /><a 
 id="x6-12024r8"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m13</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(boundary=bound4,</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.05,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(.1,.2))</span></div>
<!--l. 292--><p class="indent" >   These meshes are visualized in Figure&#x00A0;<a 
href="#x6-120352">2.2<!--tex4ht:ref: fig:nonconmesh --></a> by commands bellow
</p>
   <div class="fancyvrb" id="fancyvrb40"><a 
 id="x6-12026r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mfrow=c(2,2),</span><span 
class="aesltt-10x-x-109">&#x00A0;mar=c(0,0,1,0))</span><br class="fancyvrb" /><a 
 id="x6-12028r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;for</span><span 
class="aesltt-10x-x-109">&#x00A0;(i</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;10:13)</span><span 
class="aesltt-10x-x-109">&#x00A0;{</span>
<br class="fancyvrb" /><a 
 id="x6-12030r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(get(paste(</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">m</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;i,</span><span 
class="aesltt-10x-x-109">&#x00A0;sep=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">)),</span><span 
class="aesltt-10x-x-109">&#x00A0;asp=1,</span><span 
class="aesltt-10x-x-109">&#x00A0;main=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">)</span>
<br class="fancyvrb" /><a 
 id="x6-12032r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;points(p5,</span><span 
class="aesltt-10x-x-109">&#x00A0;pch=19,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=2);</span><span 
class="aesltt-10x-x-109">&#x00A0;title(main=paste(</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">m</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;i,</span><span 
class="aesltt-10x-x-109">&#x00A0;sep=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">))</span><br class="fancyvrb" /><a 
 id="x6-12034r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;}</span></div>
                                                                                 
                                                                                 
<hr class="figure" /><div class="figure" 
><a 
 id="x6-120352"></a><img 
src="spde-tutorial18x.png" alt="PIC" class="graphics" width="298.75517pt" height="298.7627pt"  /><!--tex4ht:graphics  
name="spde-tutorial18x.png" src="figs/mesh-vnonconmeshv.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;2.2: </span><span  
class="content">Non-convex meshes with different boundaries.</span></div><!--tex4ht:label?: x6-120352 -->
   </div><hr class="endfigure" />
<!--l. 310--><p class="indent" >   The <span 
class="aett-10x-x-109">m10 </span>mesh is built with a boundary that we got using default arguments in the
<span 
class="aett-10x-x-109">inla.nonconvex.hull() </span>function. The default <span 
class="aett-10x-x-109">convex </span>and <span 
class="aett-10x-x-109">concave </span>arguments are both equal
<span 
class="aett-10x-x-109">0.15 </span>proportion of the points domain radius, that is computed by
</p>
   <div class="fancyvrb" id="fancyvrb41"><a 
 id="x6-12037r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;max(diff(range(p5[,1])),</span><span 
class="aesltt-10x-x-109">&#x00A0;diff(range(p5[,2])))*.15</span></div>
<!--l. 320--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb42"><a 
 id="x6-12039r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;0.12906</span></div>
<!--l. 324--><p class="noindent" >If we supply a larger convex value, like the one used to generate <span 
class="aett-10x-x-109">m11</span>, we get a larger boundary. It&#8217;s
because all circles with a centre on each point and a radius less than the convex value are inside
the boundary. When we choose a larger concave value, as in the boundary used for the
&#8217;m12&#8217; and &#8217;m13&#8217; meshes, we don&#8217;t have circles with radius less than the concave value
outside the boudary. If we choose a smaller resolution, we get a boundary with small
resolution (in terms of number of points), for example, comparing the <span 
class="aett-10x-x-109">m12 </span>and <span 
class="aett-10x-x-109">m13</span>
meshes.
</p><!--l. 338--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.2.3   </span> <a 
 id="x6-130002.2.3"></a>Meshes for the toy example</h4>
<!--l. 340--><p class="noindent" >To analyze the toy data set, we use six triangulation options to make comparisons in section&#x00A0;<a 
href="spde-tutorialch3.html#x7-310003.5">3.5<!--tex4ht:ref: sec:meshcompare --></a>.
The first mesh forces the location points to be vertices of the mesh.
</p>
   <div class="fancyvrb" id="fancyvrb43"><a 
 id="x6-13002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh1</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(coords,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(0.035,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.1))</span>
<br class="fancyvrb" /><a 
 id="x6-13004r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh2</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(coords,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(0.15,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.2))</span></div>
                                                                                 
                                                                                 
<!--l. 352--><p class="indent" >   The second and third meshes are based on the points, but we use a cutoff greather than zero
to avoid small triangles in regions where we have dense observations
</p>
   <div class="fancyvrb" id="fancyvrb44"><a 
 id="x6-13006r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh3</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(coords,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(0.15,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.2),</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.02)</span></div>
<!--l. 362--><p class="indent" >   We also build three other meshes based on the domain area. These are built to have
approximately the same number of vertices as the previous ones
</p>
   <div class="fancyvrb" id="fancyvrb45"><a 
 id="x6-13008r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh4</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(,</span><span 
class="aesltt-10x-x-109">&#x00A0;pl.dom,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.e=c(0.0355,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.1))</span>
<br class="fancyvrb" /><a 
 id="x6-13010r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh5</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(,</span><span 
class="aesltt-10x-x-109">&#x00A0;pl.dom,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.e=c(0.092,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.2))</span>
<br class="fancyvrb" /><a 
 id="x6-13012r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh6</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(,</span><span 
class="aesltt-10x-x-109">&#x00A0;pl.dom,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.e=c(0.11,</span><span 
class="aesltt-10x-x-109">&#x00A0;0.2))</span></div>
<!--l. 374--><p class="indent" >   The number of nodes in each one of these meshes is
</p>
   <div class="fancyvrb" id="fancyvrb46"><a 
 id="x6-13014r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;c(mesh1$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh2$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh3$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh4$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh5$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh6$n)</span></div>
<!--l. 379--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb47"><a 
 id="x6-13016r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;2900</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;488</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;371</span><span 
class="aett-10x-x-109">&#x00A0;2878</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;490</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;375</span></div>
<!--l. 384--><p class="indent" >   These six meshes are shown in Figure <a 
href="#x6-130233">2.3<!--tex4ht:ref: fig:crdt1 --></a> with code below
</p>
   <div class="fancyvrb" id="fancyvrb48"><a 
 id="x6-13018r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mfrow=c(2,3),</span><span 
class="aesltt-10x-x-109">&#x00A0;mar=c(0,0,0,0))</span><br class="fancyvrb" /><a 
 id="x6-13020r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;for</span><span 
class="aesltt-10x-x-109">&#x00A0;(i</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;1:6)</span>
<br class="fancyvrb" /><a 
 id="x6-13022r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(get(paste(</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">mesh</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,i,sep=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">)),</span><span 
class="aesltt-10x-x-109">&#x00A0;asp=1,</span><span 
class="aesltt-10x-x-109">&#x00A0;main=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">)</span></div>
<hr class="figure" /><div class="figure" 
><a 
 id="x6-130233"></a><img 
src="spde-tutorial19x.png" alt="PIC" class="graphics" width="422.52936pt" height="281.69817pt"  /><!--tex4ht:graphics  
name="spde-tutorial19x.png" src="figs/mesh-vplotmesh1.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;2.3: </span><span  
class="content">Six triangulation options for the toy example.</span></div><!--tex4ht:label?: x6-130233 -->
   </div><hr class="endfigure" />
                                                                                 
                                                                                 
<!--l. 400--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.2.4   </span> <a 
 id="x6-140002.2.4"></a>Meshes for Paraná state</h4>
<!--l. 402--><p class="noindent" >We have some examples using data collected in Paraná state, in Brazil. In this case we need to
take into account two things: one is the shape of this domain area and the other is the
coordinates reference system.
</p><!--l. 408--><p class="indent" >   We have the daily rainfall data
</p>
   <div class="fancyvrb" id="fancyvrb49"><a 
 id="x6-14002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;data(PRprec);</span><span 
class="aesltt-10x-x-109">&#x00A0;dim(PRprec)</span></div>
<!--l. 413--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb50"><a 
 id="x6-14004r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;616</span><span 
class="aett-10x-x-109">&#x00A0;368</span></div>
<!--l. 416--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb51"><a 
 id="x6-14006r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;PRprec[1:2,</span><span 
class="aesltt-10x-x-109">&#x00A0;1:10]</span></div>
<!--l. 419--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb52"><a 
 id="x6-14008r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Longitude</span><span 
class="aett-10x-x-109">&#x00A0;Latitude</span><span 
class="aett-10x-x-109">&#x00A0;Altitude</span><span 
class="aett-10x-x-109">&#x00A0;d0101</span><span 
class="aett-10x-x-109">&#x00A0;d0102</span><span 
class="aett-10x-x-109">&#x00A0;d0103</span><span 
class="aett-10x-x-109">&#x00A0;d0104</span><span 
class="aett-10x-x-109">&#x00A0;d0105</span><span 
class="aett-10x-x-109">&#x00A0;d0106</span><span 
class="aett-10x-x-109">&#x00A0;d0107</span>
<br class="fancyvrb" /><a 
 id="x6-14010r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;-50.8744</span><span 
class="aett-10x-x-109">&#x00A0;-22.8511</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;365</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;2.5</span>
<br class="fancyvrb" /><a 
 id="x6-14012r3"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;3</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;-50.7711</span><span 
class="aett-10x-x-109">&#x00A0;-22.9597</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;344</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;6.0</span></div>
<!--l. 425--><p class="noindent" >that consists of the daily rainfall data from <span 
class="aett-10x-x-109">616 </span>stations for each day of the 2011 year. The
coordinates (two first colums) are on the latlong projection.
</p><!--l. 430--><p class="indent" >   Also, we have the Paraná state polygon with
</p>
   <div class="fancyvrb" id="fancyvrb53"><a 
 id="x6-14014r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;data(PRborder);</span><span 
class="aesltt-10x-x-109">&#x00A0;dim(PRborder)</span></div>
<!--l. 435--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb54"><a 
 id="x6-14016r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;2055</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;2</span></div>
<!--l. 439--><p class="noindent" >that consists of a set of <span 
class="aett-10x-x-109">2055 </span>points on the latlong projection.
</p><!--l. 442--><p class="indent" >   In this case is best to use a non-convex hull mesh. We start by building a non-convex domain
with
</p>
   <div class="fancyvrb" id="fancyvrb55"><a 
 id="x6-14018r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;prdomain</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.nonconvex.hull(as.matrix(PRprec[,1:2]),</span>
<br class="fancyvrb" /><a 
 id="x6-14020r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;-0.03,</span><span 
class="aesltt-10x-x-109">&#x00A0;-0.05,</span><span 
class="aesltt-10x-x-109">&#x00A0;resolution=c(100,100))</span></div>
<!--l. 450--><p class="noindent" >with this defined domain we build two meshes with different resolution (max edge length) on the
inner domain
</p>
   <div class="fancyvrb" id="fancyvrb56"><a 
 id="x6-14022r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;(prmesh1</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(boundary=prdomain,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(.7,.7),</span>
<br class="fancyvrb" /><a 
 id="x6-14024r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.35,</span><span 
class="aesltt-10x-x-109">&#x00A0;offset=c(-0.05,</span><span 
class="aesltt-10x-x-109">&#x00A0;-0.05)))$n</span></div>
<!--l. 457--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb57"><a 
 id="x6-14026r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;187</span></div>
                                                                                 
                                                                                 
<!--l. 460--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb58"><a 
 id="x6-14028r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;(prmesh2</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(boundary=prdomain,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(.45,1),</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.2))$n</span></div>
<!--l. 463--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb59"><a 
 id="x6-14030r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;382</span></div>
<!--l. 468--><p class="indent" >   We can visualize both meshes on the Figure&#x00A0;<a 
href="#x6-140374">2.4<!--tex4ht:ref: fig:prmesh --></a> with commands below
</p>
   <div class="fancyvrb" id="fancyvrb60"><a 
 id="x6-14032r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mfrow=c(1,2),</span><span 
class="aesltt-10x-x-109">&#x00A0;mar=c(0,0,0,0))</span><br class="fancyvrb" /><a 
 id="x6-14034r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(prmesh1,</span><span 
class="aesltt-10x-x-109">&#x00A0;asp=1,</span><span 
class="aesltt-10x-x-109">&#x00A0;main=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">);</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;lines(PRborder,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=3)</span>
<br class="fancyvrb" /><a 
 id="x6-14036r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(prmesh2,</span><span 
class="aesltt-10x-x-109">&#x00A0;asp=1,</span><span 
class="aesltt-10x-x-109">&#x00A0;main=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">);</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;lines(PRborder,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=3)</span></div>
<hr class="figure" /><div class="figure" 
><a 
 id="x6-140374"></a><img 
src="spde-tutorial20x.png" alt="PIC" class="graphics" width="422.52936pt" height="197.1887pt"  /><!--tex4ht:graphics  
name="spde-tutorial20x.png" src="figs/mesh-vprmesh.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;2.4: </span><span  
class="content">Mesh for Paraná state</span></div><!--tex4ht:label?: x6-140374 -->
   </div><hr class="endfigure" />
<!--l. 484--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">2.2.5   </span> <a 
 id="x6-150002.2.5"></a>Triangulation with a SpatialPolygonsDataFrame</h4>
<!--l. 486--><p class="noindent" >Suppose that we have a map of the domain region. In <span 
class="aeb10-x-x-109">R </span>the representation of a spatial object is
made using object classes in the <span 
class="aeb10-x-x-109">sp </span>package, see&#x00A0;<span class="cite">[<a 
href="spde-tutorialli2.html#Xsp">Pebesma and Bivand, 2005</a>]</span> and <span class="cite">[<a 
href="spde-tutorialli2.html#XBivandetal:2008">Bivand et&#x00A0;al.,
2008</a>]</span>. To show an aplication in this case, we use the North Carolina map, in package <span 
class="aeb10-x-x-109">spdep</span>,
<span class="cite">[<a 
href="spde-tutorialli2.html#Xspdep">Bivand et&#x00A0;al., 2012</a>]</span>.
</p><!--l. 495--><p class="indent" >
</p>
   <div class="fancyvrb" id="fancyvrb61"><a 
 id="x6-15002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;require(maptools)</span><br class="fancyvrb" /><a 
 id="x6-15004r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;nc.fl</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;system.file("etc/shapes/sids.shp",</span><span 
class="aesltt-10x-x-109">&#x00A0;package="spdep")[1]</span>
<br class="fancyvrb" /><a 
 id="x6-15006r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;nc.sids</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;readShapePoly(nc.fl,</span><span 
class="aesltt-10x-x-109">&#x00A0;ID="FIPSNO",</span>
<br class="fancyvrb" /><a 
 id="x6-15008r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;proj4string=CRS("+proj=longlat</span><span 
class="aesltt-10x-x-109">&#x00A0;+ellps=clrk66"))</span></div>
<!--l. 503--><p class="indent" >   We simplify this map by uniting all the areas together. To do it, we use the
<span 
class="aett-10x-x-109">unionSpatialPolygons() </span><span 
class="aeb10-x-x-109">spdep </span>function that uses function of the <span 
class="aeb10-x-x-109">rgeos </span>package&#x00A0;<span class="cite">[<a 
href="spde-tutorialli2.html#Xrgeos">Bivand and
Rundel, 2013</a>]</span>. If we don&#8217;t have the <span 
class="aeb10-x-x-109">rgeos </span>we can use the <span 
class="aeb10-x-x-109">gpclib </span>package instead, but the we do
need to set a permission
</p>
   <div class="fancyvrb" id="fancyvrb62"><a 
 id="x6-15010r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;gpclibPermit()</span></div>
                                                                                 
                                                                                 
<!--l. 514--><p class="noindent" >before working with this library
</p>
   <div class="fancyvrb" id="fancyvrb63"><a 
 id="x6-15012r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;nc.border</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;unionSpatialPolygons(nc.sids,</span><span 
class="aesltt-10x-x-109">&#x00A0;rep(1,</span><span 
class="aesltt-10x-x-109">&#x00A0;nrow(nc.sids)))</span></div>
<!--l. 521--><p class="indent" >   Now, we use the <span 
class="aett-10x-x-109">inla.sp2segment() </span>to extract the boundary of the <span 
class="aett-10x-x-109">SpatialPolygons</span>
object that contains the border of the map
</p>
   <div class="fancyvrb" id="fancyvrb64"><a 
 id="x6-15014r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;nc.bdry</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.sp2segment(nc.border)</span></div>
<!--l. 529--><p class="noindent" >and creates the mesh
</p>
   <div class="fancyvrb" id="fancyvrb65"><a 
 id="x6-15016r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;(nc.mesh</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(boundary=nc.bdry,</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.15,</span>
<br class="fancyvrb" /><a 
 id="x6-15018r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(0.3,</span><span 
class="aesltt-10x-x-109">&#x00A0;1)))$n</span></div>
<!--l. 535--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb66"><a 
 id="x6-15020r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;534</span></div>
<!--l. 539--><p class="noindent" >that is visualized on Figure&#x00A0;<a 
href="#x6-150255">2.5<!--tex4ht:ref: fig:ncmesh --></a> with the commands bellow.
</p>
   <div class="fancyvrb" id="fancyvrb67"><a 
 id="x6-15022r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mar=c(0,0,0,0))</span><br class="fancyvrb" /><a 
 id="x6-15024r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(nc.mesh,</span><span 
class="aesltt-10x-x-109">&#x00A0;asp=1,</span><span 
class="aesltt-10x-x-109">&#x00A0;main=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">)</span></div>
<hr class="figure" /><div class="figure" 
><a 
 id="x6-150255"></a><img 
src="spde-tutorial21x.png" alt="PIC" class="graphics" width="422.52936pt" height="158.449pt"  /><!--tex4ht:graphics  
name="spde-tutorial21x.png" src="figs/mesh-ncmeshv.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;2.5: </span><span  
class="content">Mesh constructed using the North Carolina map</span></div><!--tex4ht:label?: x6-150255 -->
   </div><hr class="endfigure" />
<!--l. 555--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">2.3   </span> <a 
 id="x6-160002.3"></a>Mesh with holes and physical boundaries</h3>
<!--l. 557--><p class="noindent" >Sometimes we need to deal with physical boundaries. It can be when there is a hole inside the
domain or when the domain shape is not convex. An example of application is when modelling
fish and we have to consider the inland as a physical barrier and, sometimes, islands inside the
domain.
</p><!--l. 562--><p class="indent" >   The polygons in the Figure&#x00A0;<a 
href="#x6-160136">2.6<!--tex4ht:ref: fig:lakehole --></a> were created with the following commands:
</p>
   <div class="fancyvrb" id="fancyvrb68"><a 
 id="x6-16002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;pl1</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;Polygon(cbind(c(0,15,15,0,0),</span><span 
class="aesltt-10x-x-109">&#x00A0;c(5,0,20,20,5)),</span><span 
class="aesltt-10x-x-109">&#x00A0;hole=FALSE)</span>
<br class="fancyvrb" /><a 
 id="x6-16004r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;h1</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;Polygon(cbind(c(5,7,7,5,5),</span><span 
class="aesltt-10x-x-109">&#x00A0;c(7,7,15,15,7)),</span><span 
class="aesltt-10x-x-109">&#x00A0;hole=TRUE)</span>
<br class="fancyvrb" /><a 
 id="x6-16006r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;pl2</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;Polygon(cbind(c(15,20,20,30,30,15,15),</span><span 
class="aesltt-10x-x-109">&#x00A0;c(10,10,0,0,20,20,10)),</span><span 
class="aesltt-10x-x-109">&#x00A0;hole=FALSE)</span>
<br class="fancyvrb" /><a 
 id="x6-16008r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;sp</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;SpatialPolygons(list(Polygons(list(pl1,</span><span 
class="aesltt-10x-x-109">&#x00A0;h1),</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">0</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">),</span><span 
class="aesltt-10x-x-109">&#x00A0;Polygons(list(pl2),</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">1</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)))</span>
<br class="fancyvrb" /><a 
 id="x6-16010r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mar=c(0,0,0,0));</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(sp)</span><span 
class="aesltt-10x-x-109">&#x00A0;###</span><span 
class="aesltt-10x-x-109">&#x00A0;to</span><span 
class="aesltt-10x-x-109">&#x00A0;visualize</span><span 
class="aesltt-10x-x-109">&#x00A0;it</span>
<br class="fancyvrb" /><a 
 id="x6-16012r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;text(c(13,</span><span 
class="aesltt-10x-x-109">&#x00A0;17,</span><span 
class="aesltt-10x-x-109">&#x00A0;23),</span><span 
class="aesltt-10x-x-109">&#x00A0;c(3,</span><span 
class="aesltt-10x-x-109">&#x00A0;12,</span><span 
class="aesltt-10x-x-109">&#x00A0;3),</span><span 
class="aesltt-10x-x-109">&#x00A0;LETTERS[1:3],</span><span 
class="aesltt-10x-x-109">&#x00A0;cex=3)</span></div>
                                                                                 
                                                                                 
<hr class="figure" /><div class="figure" 
><a 
 id="x6-160136"></a><img 
src="spde-tutorial22x.png" alt="PIC" class="graphics" width="298.75517pt" height="213.39917pt"  /><!--tex4ht:graphics  
name="spde-tutorial22x.png" src="figs/mesh-plotlake.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;2.6: </span><span  
class="content">Region with a hole and non convex domain.</span></div><!--tex4ht:label?: x6-160136 -->
   </div><hr class="endfigure" />
<!--l. 580--><p class="indent" >   We have two neighbour regions, one with a hole and one with no convex shape. Suppose that
it is necessary to avoid correlation between near regions separated by land. For example, suppose
that we want to make sure that the correlation between A and C is smaller than between A and
B or between B and C.
</p><!--l. 588--><p class="indent" >   In this example we do not want additional points outer the domain. To have it, we have to
supply a length one value for <span 
class="aett-10x-x-109">max.edge</span>. The following code is to prepare the boundary and built
the mesh.
</p>
   <div class="fancyvrb" id="fancyvrb69"><a 
 id="x6-16015r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;bound</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.sp2segment(sp)</span><br class="fancyvrb" /><a 
 id="x6-16017r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(boundary=bound,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=2)</span></div>
<!--l. 598--><p class="indent" >   The mesh is displayed in the Figure&#x00A0;<a 
href="#x6-160267">2.7<!--tex4ht:ref: fig:meshhole --></a> using the commands below:
</p>
   <div class="fancyvrb" id="fancyvrb70"><a 
 id="x6-16019r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mar=c(0,0,0,0),</span><span 
class="aesltt-10x-x-109">&#x00A0;bg=rgb(.7,.5,.5))</span><br class="fancyvrb" /><a 
 id="x6-16021r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(sp,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=rgb(.3,.7,.9))</span>
<br class="fancyvrb" /><a 
 id="x6-16023r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(mesh,</span><span 
class="aesltt-10x-x-109">&#x00A0;add=TRUE,</span><span 
class="aesltt-10x-x-109">&#x00A0;lwd=2)</span><br class="fancyvrb" /><a 
 id="x6-16025r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;text(c(13,</span><span 
class="aesltt-10x-x-109">&#x00A0;17,</span><span 
class="aesltt-10x-x-109">&#x00A0;23),</span><span 
class="aesltt-10x-x-109">&#x00A0;c(3,</span><span 
class="aesltt-10x-x-109">&#x00A0;12,</span><span 
class="aesltt-10x-x-109">&#x00A0;3),</span><span 
class="aesltt-10x-x-109">&#x00A0;LETTERS[1:3],</span><span 
class="aesltt-10x-x-109">&#x00A0;cex=3)</span></div>
<hr class="figure" /><div class="figure" 
><a 
 id="x6-160267"></a><img 
src="spde-tutorial23x.png" alt="PIC" class="graphics" width="298.75517pt" height="213.39917pt"  /><!--tex4ht:graphics  
name="spde-tutorial23x.png" src="figs/mesh-plothex.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;2.7: </span><span  
class="content">Triangulation with hole and non convex shaped region</span></div><!--tex4ht:label?: x6-160267 -->
   </div><hr class="endfigure" />
<!--l. 615--><p class="indent" >   Notice that when building the SPDE model, the neighborhood structure of the
mesh is taken into account. So, it is easier to reach B from A than C on the related
graph.
                                                                                 
                                                                                 
</p><!--l. 4--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">2.4   </span> <a 
 id="x6-170002.4"></a>The projector matrix</h3>
<!--l. 8--><p class="noindent" >Because the SPDE model is defined on the mesh, we need an appropriate specification of
the linear predictor for the data response. For details on this please see&#x00A0;<span class="cite">[<a 
href="spde-tutorialli2.html#Xlindgren:2012">Lindgren,
2012</a>]</span>.
</p><!--l. 13--><p class="indent" >   The key is that we have a random field modeled at the mesh vertices, with dimension <span 
class="cmmi-10x-x-109">m</span>, and
a response at <span 
class="cmmi-10x-x-109">n </span>locations. So, we need to define how the random field and other model
components are linked to the response.
</p><!--l. 19--><p class="indent" >   Let the projector matrix <span 
class="cmmib-10x-x-109">A</span> to project the process at the mesh vertices to the locations
response. The projector matrix can be builded with the <span 
class="aett-10x-x-109">inla.spde.make.A </span>function.
Considering that each mesh vertex has a weight, the value for one point within one
triangle is the projection of the plane (formed by these three weights) at this point
location. This projection is just a weighted average with the weights computed by
the <span 
class="aett-10x-x-109">inla.spde.make.A() </span>function. Using the toy data set and mesh number five we
have
</p>
   <div class="fancyvrb" id="fancyvrb71"><a 
 id="x6-17002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;coords</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;as.matrix(SPDEtoy[,1:2])</span><br class="fancyvrb" /><a 
 id="x6-17004r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;A5</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde.make.A(mesh5,</span><span 
class="aesltt-10x-x-109">&#x00A0;loc=coords)</span></div>
<!--l. 38--><p class="indent" >   This matrix has dimension equal to the number of data locations by the number of vertices
on the mesh
</p>
   <div class="fancyvrb" id="fancyvrb72"><a 
 id="x6-17006r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;dim(A5)</span></div>
<!--l. 45--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb73"><a 
 id="x6-17008r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;200</span><span 
class="aett-10x-x-109">&#x00A0;490</span></div>
<!--l. 49--><p class="noindent" >We have exactly three non-zero elements on each line
</p>
   <div class="fancyvrb" id="fancyvrb74"><a 
 id="x6-17010r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;table(rowSums(A5&#x003E;0))</span></div>
<!--l. 54--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb75"><a 
 id="x6-17012r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;3</span><br class="fancyvrb" /><a 
 id="x6-17014r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;200</span></div>
<!--l. 59--><p class="noindent" >because each point location is inside one of the triangles. These three non-zero elements on each line
sums to one
</p>
   <div class="fancyvrb" id="fancyvrb76"><a 
 id="x6-17016r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;table(rowSums(A5))</span></div>
<!--l. 65--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb77"><a 
 id="x6-17018r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1</span><br class="fancyvrb" /><a 
 id="x6-17020r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;200</span></div>
<!--l. 70--><p class="noindent" >because multiplication with any vector of weights at mesh nodes by this matrix is the projection of
these weights at the location points.
</p><!--l. 74--><p class="indent" >   We have some columns on the projector matrix with all elements equals zero.
                                                                                 
                                                                                 
</p>
   <div class="fancyvrb" id="fancyvrb78"><a 
 id="x6-17022r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;table(colSums(A5)&#x003E;0)</span></div>
<!--l. 80--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb79"><a 
 id="x6-17024r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;FALSE</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;TRUE</span><br class="fancyvrb" /><a 
 id="x6-17026r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;242</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;248</span></div>
<!--l. 85--><p class="noindent" >These columns correspond the triangles without any point locations inside. These columns
can be droped and the stack functionality (section&#x00A0;<a 
href="spde-tutorialch3.html#x7-210003.1">3.1<!--tex4ht:ref: sec:stack --></a>) automatically handles this
situation.
</p><!--l. 91--><p class="indent" >   When we have a mesh where every pont location is on a mesh vertex, each line on the
projector matrix has exacty one nonzero element. This is the case for the <span 
class="aett-10x-x-109">m1</span>
</p>
   <div class="fancyvrb" id="fancyvrb80"><a 
 id="x6-17028r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;A1</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde.make.A(mesh1,</span><span 
class="aesltt-10x-x-109">&#x00A0;loc=coords)</span><br class="fancyvrb" /><a 
 id="x6-17030r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;table(rowSums(A1&#x003E;0))</span></div>
<!--l. 100--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb81"><a 
 id="x6-17032r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1</span><br class="fancyvrb" /><a 
 id="x6-17034r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;200</span></div>
<!--l. 105--><p class="noindent" >and all these elements are equal to one
</p>
   <div class="fancyvrb" id="fancyvrb82"><a 
 id="x6-17036r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;table(rowSums(A1))</span></div>
<!--l. 110--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb83"><a 
 id="x6-17038r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1</span><br class="fancyvrb" /><a 
 id="x6-17040r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;200</span></div>
<!--l. 115--><p class="noindent" >because in this case the projection on the location points are just the weight at the corresponding
node (at same location) of the mesh.
</p><!--l. 119--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">2.5   </span> <a 
 id="x6-180002.5"></a>GRF sampling through SPDE</h3>
<!--l. 121--><p class="noindent" >The SPDE approach builds the model on the mesh vertices and we need to simulate values at
the set of location points. We start by defining the spde model
</p>
   <div class="fancyvrb" id="fancyvrb84"><a 
 id="x6-18002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;spde5</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde2.matern(mesh5,</span><span 
class="aesltt-10x-x-109">&#x00A0;alpha=2)</span></div>
<!--l. 129--><p class="noindent" >and build the associated precision matrix.
</p><!--l. 131--><p class="indent" >   This can be done with the <span 
class="aett-10x-x-109">inla.spde2.precision() </span>function. To use this function, we have
to provide the SPDE model and the parameters <span 
class="cmmi-10x-x-109">&#x03B8; </span>for the SPDE parametrization. <span 
class="cmmi-10x-x-109">&#x03B8; </span>is a length
two vector where the second element is the logarithim of the scale parameter, log(<span 
class="cmmi-10x-x-109">&#x03BA;</span>), and
the first one is the &#8217;local variance parameter&#8217; <span 
class="cmmi-10x-x-109">&#x03C4; </span>such that the marginal variance <span 
class="cmmi-10x-x-109">&#x03C3;</span><sub><span 
class="cmmi-8">x</span></sub><sup><span 
class="cmr-8">2</span></sup>
is
</p>
   <center class="math-display" >
<img 
src="spde-tutorial24x.png" alt=" 2   --1----
&#x03C3;x = 4&#x03C0;&#x03C4;2&#x03BA;2
" class="math-display"  /></center>
<!--l. 138--><p class="nopar" > and we have that
                                                                                 
                                                                                 
</p>
   <center class="math-display" >
<img 
src="spde-tutorial25x.png" alt="log(&#x03C4;) = &#x03B8;1 = - log(4&#x03C0;&#x03BA;2&#x03C3;2x)&#x2215;2.
" class="math-display"  /></center>
<!--l. 140--><p class="nopar" >
</p><!--l. 142--><p class="indent" >   We do the simulation considering <span 
class="cmmi-10x-x-109">&#x03BA; </span><span 
class="cmr-10x-x-109">= 5 </span>and <span 
class="cmmi-10x-x-109">&#x03C3;</span><sub><span 
class="cmmi-8">x</span></sub><sup><span 
class="cmr-8">2</span></sup> <span 
class="cmr-10x-x-109">= 1</span>
</p>
   <div class="fancyvrb" id="fancyvrb85"><a 
 id="x6-18004r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;5;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;s2x</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;1</span></div>
<!--l. 148--><p class="noindent" >so, we have
</p>
   <div class="fancyvrb" id="fancyvrb86"><a 
 id="x6-18006r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;theta</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;c(-log(4*pi*s2x*kappa^2),</span><span 
class="aesltt-10x-x-109">&#x00A0;log(kappa))</span></div>
<!--l. 154--><p class="noindent" >and we have the precision matrix <span 
class="cmmib-10x-x-109">Q</span><span 
class="cmr-10x-x-109">(</span><span 
class="cmmi-10x-x-109">&#x03B8;</span><span 
class="cmr-10x-x-109">) </span>by
</p>
   <div class="fancyvrb" id="fancyvrb87"><a 
 id="x6-18008r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;Q5</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde2.precision(spde5,</span><span 
class="aesltt-10x-x-109">&#x00A0;theta)</span></div>
<!--l. 161--><p class="indent" >   Now, we can use the <span 
class="aett-10x-x-109">inla.qsample() </span>function to get a sample at mesh nodes
by
</p>
   <div class="fancyvrb" id="fancyvrb88"><a 
 id="x6-18010r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;x5</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.qsample(Q=Q5)</span></div>
<!--l. 168--><p class="noindent" >and to get a sample at the locations, we just project it with the projector matrix by
</p>
   <div class="fancyvrb" id="fancyvrb89"><a 
 id="x6-18012r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;x</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;drop(A5%*%x5)</span></div>
<!--l. 176--><p class="indent" >   We can write a more general function to generate one or more samples, by defining a
function that needs just the coordinates and model parameters. A mesh can be provided and if
not it is also generated within this function
</p>
   <div class="fancyvrb" id="fancyvrb90"><a 
 id="x6-18014r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;rspde</span></div>
<!--l. 185--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb91"><a 
 id="x6-18016r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;function</span><span 
class="aett-10x-x-109">&#x00A0;(coords,</span><span 
class="aett-10x-x-109">&#x00A0;kappa,</span><span 
class="aett-10x-x-109">&#x00A0;variance</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;1,</span><span 
class="aett-10x-x-109">&#x00A0;alpha</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;2,</span><span 
class="aett-10x-x-109">&#x00A0;n</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;1,</span><span 
class="aett-10x-x-109">&#x00A0;mesh,</span>
<br class="fancyvrb" /><a 
 id="x6-18018r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;verbose</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;FALSE,</span><span 
class="aett-10x-x-109">&#x00A0;seed,</span><span 
class="aett-10x-x-109">&#x00A0;return.attributes</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;FALSE)</span><br class="fancyvrb" /><a 
 id="x6-18020r3"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;{</span><br class="fancyvrb" /><a 
 id="x6-18022r4"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;t0</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;Sys.time()</span>
<br class="fancyvrb" /><a 
 id="x6-18024r5"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;theta</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;c(-0.5</span><span 
class="aett-10x-x-109">&#x00A0;*</span><span 
class="aett-10x-x-109">&#x00A0;log(4</span><span 
class="aett-10x-x-109">&#x00A0;*</span><span 
class="aett-10x-x-109">&#x00A0;pi</span><span 
class="aett-10x-x-109">&#x00A0;*</span><span 
class="aett-10x-x-109">&#x00A0;variance</span><span 
class="aett-10x-x-109">&#x00A0;*</span><span 
class="aett-10x-x-109">&#x00A0;kappa^2),</span><span 
class="aett-10x-x-109">&#x00A0;log(kappa))</span>
<br class="fancyvrb" /><a 
 id="x6-18026r6"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;if</span><span 
class="aett-10x-x-109">&#x00A0;(verbose)</span><br class="fancyvrb" /><a 
 id="x6-18028r7"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;cat("theta</span><span 
class="aett-10x-x-109">&#x00A0;=",</span><span 
class="aett-10x-x-109">&#x00A0;theta,</span><span 
class="aett-10x-x-109">&#x00A0;"\n")</span><br class="fancyvrb" /><a 
 id="x6-18030r8"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;if</span><span 
class="aett-10x-x-109">&#x00A0;(missing(mesh))</span><span 
class="aett-10x-x-109">&#x00A0;{</span>
<br class="fancyvrb" /><a 
 id="x6-18032r9"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;mesh.pars</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;c(0.5,</span><span 
class="aett-10x-x-109">&#x00A0;1,</span><span 
class="aett-10x-x-109">&#x00A0;0.1,</span><span 
class="aett-10x-x-109">&#x00A0;0.5,</span><span 
class="aett-10x-x-109">&#x00A0;1)</span><span 
class="aett-10x-x-109">&#x00A0;*</span><span 
class="aett-10x-x-109">&#x00A0;sqrt(alpha</span><span 
class="aett-10x-x-109">&#x00A0;-</span><span 
class="aett-10x-x-109">&#x00A0;ncol(coords)/2)/kappa</span>
<br class="fancyvrb" /><a 
 id="x6-18034r10"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;if</span><span 
class="aett-10x-x-109">&#x00A0;(verbose)</span><br class="fancyvrb" /><a 
 id="x6-18036r11"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;cat("mesh.pars</span><span 
class="aett-10x-x-109">&#x00A0;=",</span><span 
class="aett-10x-x-109">&#x00A0;mesh.pars,</span><span 
class="aett-10x-x-109">&#x00A0;"\n")</span>
<br class="fancyvrb" /><a 
 id="x6-18038r12"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;attributes</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;list(mesh</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;inla.mesh.2d(,</span><span 
class="aett-10x-x-109">&#x00A0;coords[chull(coords),</span>
<br class="fancyvrb" /><a 
 id="x6-18040r13"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;],</span><span 
class="aett-10x-x-109">&#x00A0;max.edge</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;mesh.pars[1:2],</span><span 
class="aett-10x-x-109">&#x00A0;cutoff</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;mesh.pars[3],</span>
<br class="fancyvrb" /><a 
 id="x6-18042r14"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;offset</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;mesh.pars[4:5]))</span><br class="fancyvrb" /><a 
 id="x6-18044r15"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;if</span><span 
class="aett-10x-x-109">&#x00A0;(verbose)</span>
<br class="fancyvrb" /><a 
 id="x6-18046r16"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;cat("n.mesh</span><span 
class="aett-10x-x-109">&#x00A0;=",</span><span 
class="aett-10x-x-109">&#x00A0;attributes$mesh$n,</span><span 
class="aett-10x-x-109">&#x00A0;"\n")</span><br class="fancyvrb" /><a 
 id="x6-18048r17"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;}</span><br class="fancyvrb" /><a 
 id="x6-18050r18"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;else</span><span 
class="aett-10x-x-109">&#x00A0;attributes</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;list(mesh</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;mesh)</span>
<br class="fancyvrb" /><a 
 id="x6-18052r19"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;attributes$spde</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;inla.spde2.matern(attributes$mesh,</span><span 
class="aett-10x-x-109">&#x00A0;alpha</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;alpha)</span>
<br class="fancyvrb" /><a 
 id="x6-18054r20"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;attributes$Q</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;inla.spde2.precision(attributes$spde,</span><span 
class="aett-10x-x-109">&#x00A0;theta</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;theta)</span>
<br class="fancyvrb" /><a 
 id="x6-18056r21"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;attributes$A</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;inla.mesh.project(mesh</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;attributes$mesh,</span><br class="fancyvrb" /><a 
 id="x6-18058r22"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;loc</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;coords)$A</span>
<br class="fancyvrb" /><a 
 id="x6-18060r23"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;if</span><span 
class="aett-10x-x-109">&#x00A0;(n</span><span 
class="aett-10x-x-109">&#x00A0;==</span><span 
class="aett-10x-x-109">&#x00A0;1)</span><br class="fancyvrb" /><a 
 id="x6-18062r24"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;result</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;drop(attributes$A</span><span 
class="aett-10x-x-109">&#x00A0;%*%</span><span 
class="aett-10x-x-109">&#x00A0;inla.qsample(Q</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;attributes$Q,</span>
<br class="fancyvrb" /><a 
 id="x6-18064r25"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;constr</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;attributes$spde$f$extraconstr))</span><br class="fancyvrb" /><a 
 id="x6-18066r26"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;t1</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;Sys.time()</span>
<br class="fancyvrb" /><a 
 id="x6-18068r27"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;result</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;inla.qsample(n,</span><span 
class="aett-10x-x-109">&#x00A0;attributes$Q,</span><span 
class="aett-10x-x-109">&#x00A0;seed</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;ifelse(missing(seed),</span>
                                                                                 
                                                                                 
<br class="fancyvrb" /><a 
 id="x6-18070r28"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0,</span><span 
class="aett-10x-x-109">&#x00A0;seed),</span><span 
class="aett-10x-x-109">&#x00A0;constr</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;attributes$spde$f$extraconstr)</span><br class="fancyvrb" /><a 
 id="x6-18072r29"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;if</span><span 
class="aett-10x-x-109">&#x00A0;(nrow(result)</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;</span><span 
class="aett-10x-x-109">&#x00A0;nrow(attributes$A))</span><span 
class="aett-10x-x-109">&#x00A0;{</span>
<br class="fancyvrb" /><a 
 id="x6-18074r30"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;result</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;rbind(result,</span><span 
class="aett-10x-x-109">&#x00A0;matrix(NA,</span><span 
class="aett-10x-x-109">&#x00A0;nrow(attributes$A)</span><span 
class="aett-10x-x-109">&#x00A0;-</span><br class="fancyvrb" /><a 
 id="x6-18076r31"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;nrow(result),</span><span 
class="aett-10x-x-109">&#x00A0;ncol(result)))</span>
<br class="fancyvrb" /><a 
 id="x6-18078r32"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;dimnames(result)[[1]]</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;paste("x",</span><span 
class="aett-10x-x-109">&#x00A0;1:nrow(result),</span><span 
class="aett-10x-x-109">&#x00A0;sep</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;"")</span>
<br class="fancyvrb" /><a 
 id="x6-18080r33"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;for</span><span 
class="aett-10x-x-109">&#x00A0;(j</span><span 
class="aett-10x-x-109">&#x00A0;in</span><span 
class="aett-10x-x-109">&#x00A0;1:ncol(result))</span><span 
class="aett-10x-x-109">&#x00A0;result[,</span><span 
class="aett-10x-x-109">&#x00A0;j]</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;drop(attributes$A</span><span 
class="aett-10x-x-109">&#x00A0;%*%</span>
<br class="fancyvrb" /><a 
 id="x6-18082r34"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;result[1:ncol(attributes$A),</span><span 
class="aett-10x-x-109">&#x00A0;j])</span><br class="fancyvrb" /><a 
 id="x6-18084r35"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;}</span><br class="fancyvrb" /><a 
 id="x6-18086r36"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;else</span><span 
class="aett-10x-x-109">&#x00A0;{</span>
<br class="fancyvrb" /><a 
 id="x6-18088r37"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;for</span><span 
class="aett-10x-x-109">&#x00A0;(j</span><span 
class="aett-10x-x-109">&#x00A0;in</span><span 
class="aett-10x-x-109">&#x00A0;1:ncol(result))</span><span 
class="aett-10x-x-109">&#x00A0;result[1:nrow(attributes$A),</span>
<br class="fancyvrb" /><a 
 id="x6-18090r38"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;j]</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;drop(attributes$A</span><span 
class="aett-10x-x-109">&#x00A0;%*%</span><span 
class="aett-10x-x-109">&#x00A0;result[,</span><span 
class="aett-10x-x-109">&#x00A0;j])</span>
<br class="fancyvrb" /><a 
 id="x6-18092r39"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;result</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;result[1:nrow(attributes$A),</span><span 
class="aett-10x-x-109">&#x00A0;]</span><br class="fancyvrb" /><a 
 id="x6-18094r40"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;}</span><br class="fancyvrb" /><a 
 id="x6-18096r41"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;t2</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;Sys.time()</span>
<br class="fancyvrb" /><a 
 id="x6-18098r42"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;attributes$cpu</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;c(prep</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;t1</span><span 
class="aett-10x-x-109">&#x00A0;-</span><span 
class="aett-10x-x-109">&#x00A0;t0,</span><span 
class="aett-10x-x-109">&#x00A0;sample</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;t2</span><span 
class="aett-10x-x-109">&#x00A0;-</span><span 
class="aett-10x-x-109">&#x00A0;t1,</span><span 
class="aett-10x-x-109">&#x00A0;total</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;t2</span><span 
class="aett-10x-x-109">&#x00A0;-</span><br class="fancyvrb" /><a 
 id="x6-18100r43"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;t0)</span>
<br class="fancyvrb" /><a 
 id="x6-18102r44"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;if</span><span 
class="aett-10x-x-109">&#x00A0;(return.attributes)</span><br class="fancyvrb" /><a 
 id="x6-18104r45"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;attributes(result)</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;c(attributes(result),</span><span 
class="aett-10x-x-109">&#x00A0;attributes)</span>
<br class="fancyvrb" /><a 
 id="x6-18106r46"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;return(drop(result))</span><br class="fancyvrb" /><a 
 id="x6-18108r47"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;}</span></div>
<!--l. 236--><p class="indent" >   We can generate samples at a million of locations in a matter of seconds
</p>
   <div class="fancyvrb" id="fancyvrb92"><a 
 id="x6-18110r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;pts1</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;matrix(runif(2e6),</span><span 
class="aesltt-10x-x-109">&#x00A0;ncol=2)</span><br class="fancyvrb" /><a 
 id="x6-18112r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;x1</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;rspde(pts1,</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa=5,</span><span 
class="aesltt-10x-x-109">&#x00A0;return.attributes=TRUE)</span></div>
<!--l. 245--><p class="indent" >   Some summary
</p>
   <div class="fancyvrb" id="fancyvrb93"><a 
 id="x6-18114r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;summary(x1)</span></div>
<!--l. 250--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb94"><a 
 id="x6-18116r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Min.</span><span 
class="aett-10x-x-109">&#x00A0;1st</span><span 
class="aett-10x-x-109">&#x00A0;Qu.</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Median</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Mean</span><span 
class="aett-10x-x-109">&#x00A0;3rd</span><span 
class="aett-10x-x-109">&#x00A0;Qu.</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Max.</span><br class="fancyvrb" /><a 
 id="x6-18118r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;-2.9550</span><span 
class="aett-10x-x-109">&#x00A0;-1.4280</span><span 
class="aett-10x-x-109">&#x00A0;-0.8266</span><span 
class="aett-10x-x-109">&#x00A0;-0.9268</span><span 
class="aett-10x-x-109">&#x00A0;-0.2896</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1.1820</span></div>
<!--l. 254--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb95"><a 
 id="x6-18120r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;table(x1&#x003E;0)</span></div>
<!--l. 257--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb96"><a 
 id="x6-18122r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;FALSE</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;TRUE</span><br class="fancyvrb" /><a 
 id="x6-18124r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;875978</span><span 
class="aett-10x-x-109">&#x00A0;124022</span></div>
<!--l. 262--><p class="noindent" >and we have the attributes together
</p>
   <div class="fancyvrb" id="fancyvrb97"><a 
 id="x6-18126r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;names(attributes(x1))</span></div>
<!--l. 267--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb98"><a 
 id="x6-18128r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;"mesh"</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;"spde"</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;"Q"</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;"A"</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;"cpu"</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;"names"</span></div>
<!--l. 270--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb99"><a 
 id="x6-18130r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;attr(x1,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">cpu</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)</span><span 
class="aesltt-10x-x-109">&#x00A0;###</span><span 
class="aesltt-10x-x-109">&#x00A0;time</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;seconds</span></div>
<!--l. 273--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb100"><a 
 id="x6-18132r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;prep</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;sample</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;total</span><br class="fancyvrb" /><a 
 id="x6-18134r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1.978991</span><span 
class="aett-10x-x-109">&#x00A0;1.379530</span><span 
class="aett-10x-x-109">&#x00A0;3.358521</span></div>
<!--l. 277--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb101"><a 
 id="x6-18136r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;attr(x1,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">mesh</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)$n</span><span 
class="aesltt-10x-x-109">&#x00A0;###</span><span 
class="aesltt-10x-x-109">&#x00A0;number</span><span 
class="aesltt-10x-x-109">&#x00A0;of</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh</span><span 
class="aesltt-10x-x-109">&#x00A0;nodes</span></div>
                                                                                 
                                                                                 
<!--l. 280--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb102"><a 
 id="x6-18138r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;479</span></div>
<!--l. 283--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb103"><a 
 id="x6-18140r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;dim(attr(x1,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">Q</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">))</span></div>
<!--l. 286--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb104"><a 
 id="x6-18142r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;479</span><span 
class="aett-10x-x-109">&#x00A0;479</span></div>
<!--l. 289--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb105"><a 
 id="x6-18144r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;dim(attr(x1,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">A</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">))</span></div>
<!--l. 292--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb106"><a 
 id="x6-18146r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;1000000</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;479</span></div>
<!--l. 297--><p class="indent" >   This function is used in some of next Chapters.
</p><!--l. 299--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">2.6   </span> <a 
 id="x6-190002.6"></a>Maximum likelihood inference</h3>
<!--l. 301--><p class="noindent" >We have that the latent random field <span 
class="cmmi-10x-x-109">x </span>is distributed as
</p>
   <center class="math-display" >
<img 
src="spde-tutorial26x.png" alt="x|Q  ~ N (0,Q- 1)
" class="math-display"  /></center>
<!--l. 303--><p class="nopar" > where <span 
class="cmmib-10x-x-109">Q</span> <span 
class="cmr-10x-x-109">=</span> <span 
class="cmmib-10x-x-109">Q</span><span 
class="cmr-10x-x-109">(</span><span 
class="cmmi-10x-x-109">&#x03B8;</span><span 
class="cmr-10x-x-109">)</span>, <span 
class="cmmi-10x-x-109">&#x03B8; </span><span 
class="cmr-10x-x-109">= </span><span 
class="cmsy-10x-x-109">{</span><span 
class="cmmi-10x-x-109">&#x03B8;</span><sub><span 
class="cmr-8">1</span></sub><span 
class="cmmi-10x-x-109">,&#x03B8;</span><sub><span 
class="cmr-8">2</span></sub><span 
class="cmsy-10x-x-109">} </span>with
</p><!--l. 307--><p class="indent" >   <span 
class="cmmi-10x-x-109">&#x03B8;</span><sub><span 
class="cmr-8">1</span></sub>=log(<span 
class="cmmi-10x-x-109">&#x03C4;</span>) and <span 
class="cmmi-10x-x-109">&#x03B8;</span><sub><span 
class="cmr-8">2</span></sub>=log(<span 
class="cmmi-10x-x-109">&#x03BA;</span>). Under the toy model, whe have an GF plus noise for the
observation data. So, we have
</p>
   <center class="math-display" >
<img 
src="spde-tutorial27x.png" alt="             2                 2
y|&#x03BC;y, x,A,Q, &#x03C3;y ~ N (&#x03BC;y + Ax,I &#x03C3;y).
" class="math-display"  /></center>
<!--l. 310--><p class="nopar" > Integrating out <span 
class="cmmi-10x-x-109">x</span>, we have that
</p>
   <center class="math-display" >
<img 
src="spde-tutorial28x.png" alt="            2               &#x2032;    2 -1
y|&#x03BC;y,Q, A, &#x03C3;y ~ N (&#x03BC;y,(AQA    + I&#x03C3;y)  ).
" class="math-display"  /></center>
<!--l. 313--><p class="nopar" >
</p><!--l. 315--><p class="indent" >   The log-likelihood function, marginalized with respect <span 
class="cmmi-10x-x-109">x</span>, becomes
</p>
                                                                                 
                                                                                 
   <center class="math-display" >
<img 
src="spde-tutorial29x.png" alt="  n                1        &#x2032;
- --log (2&#x03C0; )- |&#x03A3;|-  -(y - F &#x03B2;) &#x03A3;-1(y - F &#x03B2;)
  2                2
" class="math-display"  /></center>
<!--l. 320--><p class="nopar" > where <span 
class="cmr-10x-x-109">&#x03A3; = (</span><span 
class="cmmib-10x-x-109">A</span><span 
class="cmmib-10x-x-109">Q</span><span 
class="cmmib-10x-x-109">A</span><span 
class="cmsy-10x-x-109">&#x2032; </span><span 
class="cmr-10x-x-109">+</span> <span 
class="cmmib-10x-x-109">I</span><span 
class="cmmi-10x-x-109">&#x03C3;</span><sub><span 
class="cmmi-8">y</span></sub><sup><span 
class="cmr-8">2</span></sup><span 
class="cmr-10x-x-109">)</span><sup><span 
class="cmsy-8">-</span><span 
class="cmr-8">1</span></sup> and <span 
class="cmmib-10x-x-109">Q</span> <span 
class="cmr-10x-x-109">=</span> <span 
class="cmmib-10x-x-109">Q</span><span 
class="cmr-10x-x-109">(</span><span 
class="cmmi-10x-x-109">&#x03B8;</span><span 
class="cmr-10x-x-109">) =</span> <span 
class="cmmib-10x-x-109">Q</span><span 
class="cmr-10x-x-109">(</span><span 
class="cmmi-10x-x-109">&#x03C4;,&#x03BA;</span><span 
class="cmr-10x-x-109">)</span>. We choose <span 
class="cmmi-10x-x-109">&#x03C4;</span><sup><span 
class="cmsy-8">&#x2032;</span></sup> to have marginal variance
of <span 
class="cmmi-10x-x-109">x </span>equal 1, <span 
class="cmmib-10x-x-109">Q</span><span 
class="cmr-10x-x-109">(</span><span 
class="cmmi-10x-x-109">&#x03C4;</span><sup><span 
class="cmsy-8">&#x2032;</span></sup><span 
class="cmmi-10x-x-109">,&#x03BA;</span><span 
class="cmr-10x-x-109">)) </span>= <span 
class="cmmib-10x-x-109">Q</span><sup><span 
class="cmsy-8">&#x2032;</span></sup>. In this case we write <span 
class="cmmib-10x-x-109">W</span> <span 
class="cmr-10x-x-109">= (</span><span 
class="cmmi-10x-x-109">r</span><span 
class="cmmib-10x-x-109">I</span> <span 
class="cmr-10x-x-109">+ </span><span 
class="cmmi-10x-x-109">Q</span><span 
class="cmr-10x-x-109">(</span><span 
class="cmmi-10x-x-109">&#x03C4;</span><sup><span 
class="cmsy-8">&#x2032;</span></sup><span 
class="cmmi-10x-x-109">,&#x03BA;</span><span 
class="cmr-10x-x-109">)) </span>where <span 
class="cmmi-10x-x-109">r </span><span 
class="cmr-10x-x-109">=</span> <img 
src="spde-tutorial30x.png" alt="&#x03C3;2e
&#x03C3;2x"  class="frac" align="middle" />
and
</p>
   <center class="math-display" >
<img 
src="spde-tutorial31x.png" alt="     2
&#x03A3; = &#x03C3;xW  .
" class="math-display"  /></center>
<!--l. 331--><p class="nopar" >
</p><!--l. 333--><p class="indent" >   Now, we can write a concentrated likelihood deriving the likelihood with respect to <span 
class="cmmi-10x-x-109">&#x03C3;</span><sub><span 
class="cmmi-8">x</span></sub><sup><span 
class="cmr-8">2</span></sup> and
<span 
class="cmmi-10x-x-109">&#x03B2;</span>. We have that
</p>
   <center class="math-display" >
<img 
src="spde-tutorial32x.png" alt="(F&#x2032;W  F)&#x02C6;&#x03B2; = F &#x2032;W y.
" class="math-display"  /></center>
<!--l. 336--><p class="nopar" > and
</p>
   <center class="math-display" >
<img 
src="spde-tutorial33x.png" alt="&#x02C6;&#x03C3;2x = (yi - F &#x02C6;&#x03B2;)&#x2032;W (yi - F &#x03B2;&#x02C6;)&#x2215;n
" class="math-display"  /></center>
<!--l. 340--><p class="nopar" >
</p><!--l. 342--><p class="indent" >   Now, we can work with the log-likelihood as a function of a relative variance, instead of the
noise variance, and the scale parameter <span 
class="cmmi-10x-x-109">&#x03BA;</span>. The concentrated log-likelihood can be writed
as
</p>
   <center class="math-display" >
<img 
src="spde-tutorial34x.png" alt="- 1{|W  |+ n[log(2&#x03C0;&#x03C3;&#x02C6;2 )+ 1]}
  2                 x
" class="math-display"  /></center>
<!--l. 348--><p class="nopar" > And we can use a quasi-Newton optimization algorithim to find the maximum likelihood
estimate of each the two parameters in the concentrated likelihood. These parameters are the
ones in the <span 
class="cmmib-10x-x-109">W</span> matrix and are parametrized as log(<span 
class="cmmi-10x-x-109">r</span>) and log(<span 
class="cmmi-10x-x-109">&#x03BA;</span>).
</p><!--l. 356--><p class="indent" >   To evaluate the likelihood function efficiently we need to compute the determinant <span 
class="cmsy-10x-x-109">|</span><span 
class="cmmib-10x-x-109">W</span><span 
class="cmsy-10x-x-109">| </span>and
<span 
class="cmmib-10x-x-109">W</span> itself. Both computations needs care. We have that <span 
class="cmmib-10x-x-109">W</span> <span 
class="cmr-10x-x-109">= (</span><span 
class="cmmi-10x-x-109">r</span><span 
class="cmmib-10x-x-109">I</span> <span 
class="cmr-10x-x-109">+ </span><span 
class="cmmi-10x-x-109">Q</span><span 
class="cmr-10x-x-109">(</span><span 
class="cmmi-10x-x-109">&#x03C4;</span><sup><span 
class="cmsy-8">&#x2032;</span></sup><span 
class="cmmi-10x-x-109">,&#x03BA;</span><span 
class="cmr-10x-x-109">))</span>.
</p><!--l. 362--><p class="indent" >   To evaluate the determinant, we use a matrix determinant lemma such that we
have
</p>
   <center class="math-display" >
<img 
src="spde-tutorial35x.png" alt="det(rI + AQA  &#x2032;) = det(Q + A &#x2032;rA )det(Q )det(rI).
" class="math-display"  /></center>
                                                                                 
                                                                                 
<!--l. 366--><p class="nopar" > We implement the following function to compute it
</p>
   <div class="fancyvrb" id="fancyvrb107"><a 
 id="x6-19002r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;function</span><span 
class="aett-10x-x-109">&#x00A0;(U,</span><span 
class="aett-10x-x-109">&#x00A0;Q,</span><span 
class="aett-10x-x-109">&#x00A0;r)</span><br class="fancyvrb" /><a 
 id="x6-19004r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;{</span><br class="fancyvrb" /><a 
 id="x6-19006r3"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;d1</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;determinant(crossprod(U/r,</span><span 
class="aett-10x-x-109">&#x00A0;U)</span><span 
class="aett-10x-x-109">&#x00A0;+</span><span 
class="aett-10x-x-109">&#x00A0;Q)$modulus</span>
<br class="fancyvrb" /><a 
 id="x6-19008r4"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;return(new("numeric",</span><span 
class="aett-10x-x-109">&#x00A0;(d1</span><span 
class="aett-10x-x-109">&#x00A0;-</span><span 
class="aett-10x-x-109">&#x00A0;determinant(Q)$modulus)</span><span 
class="aett-10x-x-109">&#x00A0;+</span><span 
class="aett-10x-x-109">&#x00A0;nrow(U)</span><span 
class="aett-10x-x-109">&#x00A0;*</span><br class="fancyvrb" /><a 
 id="x6-19010r5"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;log(r)))</span><br class="fancyvrb" /><a 
 id="x6-19012r6"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;}</span></div>
<!--l. 379--><p class="indent" >   The precision matrix can be evaluated using the Woodbury matrix identity. It says that for
<span 
class="cmmib-10x-x-109">C</span> and <span 
class="cmmib-10x-x-109">W</span> invertible matrices we have
</p>
   <center class="math-display" >
<img 
src="spde-tutorial36x.png" alt="(rI + AQA  &#x2032;)- 1 = r- 1I - r- 1IA (Q + Ar- 1A)- 1Ar - 1.
" class="math-display"  /></center>
<!--l. 385--><p class="nopar" > We implement it with the following function
</p>
   <div class="fancyvrb" id="fancyvrb108"><a 
 id="x6-19014r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;function</span><span 
class="aett-10x-x-109">&#x00A0;(U,</span><span 
class="aett-10x-x-109">&#x00A0;Q,</span><span 
class="aett-10x-x-109">&#x00A0;r)</span><br class="fancyvrb" /><a 
 id="x6-19016r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;{</span><br class="fancyvrb" /><a 
 id="x6-19018r3"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Bi</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;Diagonal(nrow(U),</span><span 
class="aett-10x-x-109">&#x00A0;rep(1/r,</span><span 
class="aett-10x-x-109">&#x00A0;nrow(U)))</span><br class="fancyvrb" /><a 
 id="x6-19020r4"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;VBi</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;crossprod(U,</span><span 
class="aett-10x-x-109">&#x00A0;Bi)</span>
<br class="fancyvrb" /><a 
 id="x6-19022r5"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;R</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;solve(Q</span><span 
class="aett-10x-x-109">&#x00A0;+</span><span 
class="aett-10x-x-109">&#x00A0;VBi</span><span 
class="aett-10x-x-109">&#x00A0;%*%</span><span 
class="aett-10x-x-109">&#x00A0;U,</span><span 
class="aett-10x-x-109">&#x00A0;VBi)</span><br class="fancyvrb" /><a 
 id="x6-19024r6"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;forceSymmetric(Bi</span><span 
class="aett-10x-x-109">&#x00A0;-</span><span 
class="aett-10x-x-109">&#x00A0;crossprod(VBi,</span><span 
class="aett-10x-x-109">&#x00A0;R))</span><br class="fancyvrb" /><a 
 id="x6-19026r7"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;}</span></div>
<!--l. 399--><p class="indent" >   Considering <span 
class="cmmi-10x-x-109">&#x03B8; </span>and log(<span 
class="cmmi-10x-x-109">&#x03C3;</span><sub><span 
class="cmmi-8">y</span></sub><sup><span 
class="cmr-8">2</span></sup>) as a three parameter vetor, we have the following negative of the
log likelihood function
</p>
   <div class="fancyvrb" id="fancyvrb109"><a 
 id="x6-19028r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;function</span><span 
class="aett-10x-x-109">&#x00A0;(pars,</span><span 
class="aett-10x-x-109">&#x00A0;X,</span><span 
class="aett-10x-x-109">&#x00A0;A,</span><span 
class="aett-10x-x-109">&#x00A0;y,</span><span 
class="aett-10x-x-109">&#x00A0;spde)</span><br class="fancyvrb" /><a 
 id="x6-19030r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;{</span><br class="fancyvrb" /><a 
 id="x6-19032r3"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;m</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;inla.spde2.precision(spde,</span><span 
class="aett-10x-x-109">&#x00A0;c(-pars[2]</span><span 
class="aett-10x-x-109">&#x00A0;-</span><span 
class="aett-10x-x-109">&#x00A0;1.265512,</span><span 
class="aett-10x-x-109">&#x00A0;pars[2]))</span>
<br class="fancyvrb" /><a 
 id="x6-19034r4"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;ldet</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;precDetFun(A,</span><span 
class="aett-10x-x-109">&#x00A0;m,</span><span 
class="aett-10x-x-109">&#x00A0;exp(pars[1]))</span><br class="fancyvrb" /><a 
 id="x6-19036r5"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;m</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;precFun(A,</span><span 
class="aett-10x-x-109">&#x00A0;m,</span><span 
class="aett-10x-x-109">&#x00A0;exp(pars[1]))</span>
<br class="fancyvrb" /><a 
 id="x6-19038r6"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Xm</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;crossprod(X,</span><span 
class="aett-10x-x-109">&#x00A0;m)</span><br class="fancyvrb" /><a 
 id="x6-19040r7"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;betah</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;drop(solve(Xm</span><span 
class="aett-10x-x-109">&#x00A0;%*%</span><span 
class="aett-10x-x-109">&#x00A0;X,</span><span 
class="aett-10x-x-109">&#x00A0;Xm</span><span 
class="aett-10x-x-109">&#x00A0;%*%</span><span 
class="aett-10x-x-109">&#x00A0;y))</span>
<br class="fancyvrb" /><a 
 id="x6-19042r8"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;z</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;drop(y</span><span 
class="aett-10x-x-109">&#x00A0;-</span><span 
class="aett-10x-x-109">&#x00A0;X</span><span 
class="aett-10x-x-109">&#x00A0;%*%</span><span 
class="aett-10x-x-109">&#x00A0;betah)</span><br class="fancyvrb" /><a 
 id="x6-19044r9"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;s2x.h</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;mean(crossprod(m,</span><span 
class="aett-10x-x-109">&#x00A0;z)</span><span 
class="aett-10x-x-109">&#x00A0;*</span><span 
class="aett-10x-x-109">&#x00A0;z)</span>
<br class="fancyvrb" /><a 
 id="x6-19046r10"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;return((ldet</span><span 
class="aett-10x-x-109">&#x00A0;+</span><span 
class="aett-10x-x-109">&#x00A0;nrow(m)</span><span 
class="aett-10x-x-109">&#x00A0;*</span><span 
class="aett-10x-x-109">&#x00A0;(1</span><span 
class="aett-10x-x-109">&#x00A0;+</span><span 
class="aett-10x-x-109">&#x00A0;log(2</span><span 
class="aett-10x-x-109">&#x00A0;*</span><span 
class="aett-10x-x-109">&#x00A0;pi</span><span 
class="aett-10x-x-109">&#x00A0;*</span><span 
class="aett-10x-x-109">&#x00A0;s2x.h)))/2)</span><br class="fancyvrb" /><a 
 id="x6-19048r11"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;}</span></div>
<!--l. 418--><p class="indent" >   We proceed the maximum likelihood estimation, for the toy example dataset and compare
with the results from <span 
class="aeb10-x-x-109">geoR </span>package of previous Chapter. We remember also the true parameter
values
</p>
   <div class="fancyvrb" id="fancyvrb110"><a 
 id="x6-19050r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;beta0</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;10;</span><span 
class="aesltt-10x-x-109">&#x00A0;sigma2e</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;0.3;</span><span 
class="aesltt-10x-x-109">&#x00A0;sigma2x</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;5;</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;7;</span><span 
class="aesltt-10x-x-109">&#x00A0;nu</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;1</span></div>
<!--l. 428--><p class="indent" >   We call the data
</p>
   <div class="fancyvrb" id="fancyvrb111"><a 
 id="x6-19052r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;data(SPDEtoy)</span></div>
<!--l. 434--><p class="noindent" >build the mesh (using the true scale parameter to determine the edge lengths and <span 
class="aett-10x-x-109">cutoff</span>), SPDE
model (with <span 
class="cmmi-10x-x-109">&#x03B1; </span><span 
class="cmr-10x-x-109">= 2</span>) and the projector matrix
</p>
   <div class="fancyvrb" id="fancyvrb112"><a 
 id="x6-19054r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xy</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;as.matrix(SPDEtoy[,1:2])</span><br class="fancyvrb" /><a 
 id="x6-19056r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;(mesh</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(xy,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(0.5,</span><span 
class="aesltt-10x-x-109">&#x00A0;1)/kappa,</span>
<br class="fancyvrb" /><a 
 id="x6-19058r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.1/kappa))$n</span></div>
<!--l. 444--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb113"><a 
 id="x6-19060r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;817</span></div>
<!--l. 447--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb114"><a 
 id="x6-19062r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;spde</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde2.matern(mesh)</span><br class="fancyvrb" /><a 
 id="x6-19064r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;A</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.project(mesh,</span><span 
class="aesltt-10x-x-109">&#x00A0;loc=xy)$A</span></div>
                                                                                 
                                                                                 
<!--l. 453--><p class="indent" >   The maximum likelihood estimation is done using the <span 
class="aett-10x-x-109">optim() </span>function. Using the default
Nelder-Mead method
</p>
   <div class="fancyvrb" id="fancyvrb115"><a 
 id="x6-19066r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;opt</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;optim(log(c(sigma2e/sigma2x,</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa)),</span><br class="fancyvrb" /><a 
 id="x6-19068r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;negLogLikFun,</span><span 
class="aesltt-10x-x-109">&#x00A0;hessian=TRUE,</span>
<br class="fancyvrb" /><a 
 id="x6-19070r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;X=matrix(1,nrow(xy)),</span><span 
class="aesltt-10x-x-109">&#x00A0;A=A,</span><br class="fancyvrb" /><a 
 id="x6-19072r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;y=SPDEtoy[,3],</span><span 
class="aesltt-10x-x-109">&#x00A0;spde=spde)</span></div>
<!--l. 465--><p class="indent" >   We also define a function to map the SPDE model parameters to the <span 
class="cmmi-10x-x-109">&#x03C3;</span><sub><span 
class="cmmi-8">x</span></sub><sup><span 
class="cmr-8">2</span></sup> and <span 
class="cmmi-10x-x-109">&#x03BA; </span>user
parameters. The function below recieves <span 
class="cmmi-10x-x-109">&#x03B8;</span>, log(<span 
class="cmmi-10x-x-109">&#x03C3;</span><sub><span 
class="cmmi-8">y</span></sub><sup><span 
class="cmr-8">2</span></sup>) and <span 
class="cmmi-10x-x-109">&#x03B2; </span>(regression parameters) and returns
<span 
class="cmmi-10x-x-109">&#x03C3;</span><sub><span 
class="cmmi-8">x</span></sub><sup><span 
class="cmr-8">2</span></sup>, <span 
class="cmmi-10x-x-109">&#x03BA;</span>, <span 
class="cmmi-10x-x-109">&#x03C3;</span><sub><span 
class="cmmi-8">y</span></sub><sup><span 
class="cmr-8">2</span></sup> and <span 
class="cmmi-10x-x-109">&#x03B2;</span>.
</p>
   <div class="fancyvrb" id="fancyvrb116"><a 
 id="x6-19074r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;function</span><span 
class="aett-10x-x-109">&#x00A0;(pars,</span><span 
class="aett-10x-x-109">&#x00A0;X,</span><span 
class="aett-10x-x-109">&#x00A0;A,</span><span 
class="aett-10x-x-109">&#x00A0;y,</span><span 
class="aett-10x-x-109">&#x00A0;spde)</span><br class="fancyvrb" /><a 
 id="x6-19076r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;{</span><br class="fancyvrb" /><a 
 id="x6-19078r3"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;m</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;inla.spde2.precision(spde,</span><span 
class="aett-10x-x-109">&#x00A0;c(-pars[2]</span><span 
class="aett-10x-x-109">&#x00A0;-</span><span 
class="aett-10x-x-109">&#x00A0;1.265512,</span><span 
class="aett-10x-x-109">&#x00A0;pars[2]))</span>
<br class="fancyvrb" /><a 
 id="x6-19080r4"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;m</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;precFun(A,</span><span 
class="aett-10x-x-109">&#x00A0;m,</span><span 
class="aett-10x-x-109">&#x00A0;exp(pars[1]))</span><br class="fancyvrb" /><a 
 id="x6-19082r5"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Xm</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;crossprod(X,</span><span 
class="aett-10x-x-109">&#x00A0;m)</span>
<br class="fancyvrb" /><a 
 id="x6-19084r6"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;beta</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;drop(solve(Xm</span><span 
class="aett-10x-x-109">&#x00A0;%*%</span><span 
class="aett-10x-x-109">&#x00A0;X,</span><span 
class="aett-10x-x-109">&#x00A0;Xm</span><span 
class="aett-10x-x-109">&#x00A0;%*%</span><span 
class="aett-10x-x-109">&#x00A0;y))</span>
<br class="fancyvrb" /><a 
 id="x6-19086r7"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;z</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;drop(y</span><span 
class="aett-10x-x-109">&#x00A0;-</span><span 
class="aett-10x-x-109">&#x00A0;X</span><span 
class="aett-10x-x-109">&#x00A0;%*%</span><span 
class="aett-10x-x-109">&#x00A0;beta)</span><br class="fancyvrb" /><a 
 id="x6-19088r8"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;s2x.h</span><span 
class="aett-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aett-10x-x-109">&#x00A0;mean(crossprod(m,</span><span 
class="aett-10x-x-109">&#x00A0;z)</span><span 
class="aett-10x-x-109">&#x00A0;*</span><span 
class="aett-10x-x-109">&#x00A0;z)</span>
<br class="fancyvrb" /><a 
 id="x6-19090r9"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;c(beta</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;beta,</span><span 
class="aett-10x-x-109">&#x00A0;s2e</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;exp(pars[1])</span><span 
class="aett-10x-x-109">&#x00A0;*</span><span 
class="aett-10x-x-109">&#x00A0;s2x.h,</span><span 
class="aett-10x-x-109">&#x00A0;s2x</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;s2x.h,</span><span 
class="aett-10x-x-109">&#x00A0;kappa</span><span 
class="aett-10x-x-109">&#x00A0;=</span><span 
class="aett-10x-x-109">&#x00A0;exp(pars[2]))</span><br class="fancyvrb" /><a 
 id="x6-19092r10"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;}</span></div>
<!--l. 487--><p class="indent" >   We use this function to compare the results with the results from the <span 
class="aett-10x-x-109">geoR </span>package
</p>
   <div class="fancyvrb" id="fancyvrb117"><a 
 id="x6-19094r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;require(geoR)</span><br class="fancyvrb" /><a 
 id="x6-19096r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;lkf</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;likfit(as.geodata(SPDEtoy),</span><br class="fancyvrb" /><a 
 id="x6-19098r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;ini=c(sigma2x,</span><span 
class="aesltt-10x-x-109">&#x00A0;1/kappa),</span>
<br class="fancyvrb" /><a 
 id="x6-19100r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa=1,</span><span 
class="aesltt-10x-x-109">&#x00A0;###</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;geoR</span><span 
class="aesltt-10x-x-109">&#x00A0;is</span><span 
class="aesltt-10x-x-109">&#x00A0;nu</span><br class="fancyvrb" /><a 
 id="x6-19102r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;nugget=sigma2e,</span><span 
class="aesltt-10x-x-109">&#x00A0;messages=FALSE)</span></div>
<!--l. 498--><p class="noindent" >and have similar results
</p>
   <div class="fancyvrb" id="fancyvrb118"><a 
 id="x6-19104r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;rbind(spde=par2user(opt$par,</span><span 
class="aesltt-10x-x-109">&#x00A0;matrix(1,</span><span 
class="aesltt-10x-x-109">&#x00A0;nrow(A)),</span><span 
class="aesltt-10x-x-109">&#x00A0;A,</span><span 
class="aesltt-10x-x-109">&#x00A0;SPDEtoy[,3],</span><span 
class="aesltt-10x-x-109">&#x00A0;spde),</span>
<br class="fancyvrb" /><a 
 id="x6-19106r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;geoR=c(lkf$beta,</span><span 
class="aesltt-10x-x-109">&#x00A0;lkf$nugget,</span><span 
class="aesltt-10x-x-109">&#x00A0;lkf$sigmasq,</span><span 
class="aesltt-10x-x-109">&#x00A0;1/lkf$phi),</span>
<br class="fancyvrb" /><a 
 id="x6-19108r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;true=c(beta0,</span><span 
class="aesltt-10x-x-109">&#x00A0;sigma2e,</span><span 
class="aesltt-10x-x-109">&#x00A0;sigma2x,</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa))</span></div>
<!--l. 505--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb119"><a 
 id="x6-19110r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;beta</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;s2e</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;s2x</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;kappa</span><br class="fancyvrb" /><a 
 id="x6-19112r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;spde</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;9.520085</span><span 
class="aett-10x-x-109">&#x00A0;0.2762273</span><span 
class="aett-10x-x-109">&#x00A0;3.194561</span><span 
class="aett-10x-x-109">&#x00A0;7.552244</span>
<br class="fancyvrb" /><a 
 id="x6-19114r3"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;geoR</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;9.534878</span><span 
class="aett-10x-x-109">&#x00A0;0.2708729</span><span 
class="aett-10x-x-109">&#x00A0;3.323400</span><span 
class="aett-10x-x-109">&#x00A0;8.653599</span><br class="fancyvrb" /><a 
 id="x6-19116r4"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;true</span><span 
class="aett-10x-x-109">&#x00A0;10.000000</span><span 
class="aett-10x-x-109">&#x00A0;0.3000000</span><span 
class="aett-10x-x-109">&#x00A0;5.000000</span><span 
class="aett-10x-x-109">&#x00A0;7.000000</span></div>
                                                                                 
                                                                                 
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="spde-tutorialch3.html" >next</a>] [<a 
href="spde-tutorialch1.html" >prev</a>] [<a 
href="spde-tutorialch1.html#tailspde-tutorialch1.html" >prev-tail</a>] [<a 
href="spde-tutorialch2.html" >front</a>] [<a 
href="spde-tutorial3.html#spde-tutorialch2.html" >up</a>] </p></div>
<!--l. 1--><p class="indent" >   <a 
 id="tailspde-tutorialch2.html"></a>  </p> 
</body></html> 
