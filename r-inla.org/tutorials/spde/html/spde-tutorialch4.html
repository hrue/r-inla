<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>4 Log-Cox point process and preferential sampling</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)" /> 
<!-- xhtml,html,frames,2 --> 
<meta name="src" content="spde-tutorial.tex" /> 
<link rel="stylesheet" type="text/css" href="spde-tutorial.css" /> 
</head><body 
>
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="spde-tutorialch5.html" >next</a>] [<a 
href="spde-tutorialch3.html" >prev</a>] [<a 
href="spde-tutorialch3.html#tailspde-tutorialch3.html" >prev-tail</a>] [<a 
href="#tailspde-tutorialch4.html">tail</a>] [<a 
href="spde-tutorial3.html#spde-tutorialch4.html" >up</a>] </p></div>
   <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;4</span><br /><a 
 id="x8-670004"></a>Log-Cox point process and preferential sampling</h2>
<!--l. 3--><p class="noindent" >This content is part of the book available at <a 
href="http://www.r-inla.org/spde-book" class="url" ><span 
class="aett-10x-x-109">http://www.r-inla.org/spde-book</span></a>, whose
Gitbook version is freely available along all the code and datasets.
</p>
   <h3 class="sectionHead"><span class="titlemark">4.1   </span> <a 
 id="x8-680004.1"></a>The <span class="cite">[<a 
href="spde-tutorialli2.html#Xsimpsonetal:2016">Simpson et&#x00A0;al., 2016</a>]</span> approach example</h3>
<!--l. 12--><p class="noindent" >Under the log-Cox model assumption, there is a latent Gaussian Random Field (LGRF) and the
inference can be done using <span 
class="aessbx-10x-x-109">INLA</span>, <span class="cite">[<a 
href="spde-tutorialli2.html#XmollerSW:1998">Møller et&#x00A0;al., 1998</a>]</span>. A common aproach to fit the log-Cox
process is to divide the study region into cells, that forms a lattice, and count the number of
points into each one, <span class="cite">[<a 
href="spde-tutorialli2.html#XmollerW:2003">Møller and Waagepetersen, 2003</a>]</span>. One can consider this counts and a
Poisson likelihood conditional to a LGRF and use INLA to fit the model, <span class="cite">[<a 
href="spde-tutorialli2.html#Xillianetal:2012">Illian et&#x00A0;al.,
2012</a>]</span>.
</p><!--l. 24--><p class="indent" >   An approach considering the SPDE approach was considerd in <span class="cite">[<a 
href="spde-tutorialli2.html#Xsimpsonetal:2016">Simpson et&#x00A0;al., 2016</a>]</span>. This
approach has a nice theoretical justification and considers a direct approximation of the log-Cox
point process model likelihood. The data is modeled considering its exact location instead of
binning it into cells. Along with the flexibility for defining a mesh, it can handle non-rectangular
areas avoiding to waste computational effort.
</p><!--l. 35--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.1.1   </span> <a 
 id="x8-690004.1.1"></a>Data simulation</h4>
<!--l. 37--><p class="noindent" >We will use the data simulated here later in Section&#x00A0;<a 
href="#x8-740004.2">4.2<!--tex4ht:ref: sec:lcoxcov --></a> and in Section&#x00A0;<a 
href="#x8-770004.3">4.3<!--tex4ht:ref: sec:prefsampl --></a>. To sample from a
log-Cox point process we will use the <span 
class="aett-10x-x-109">rLGCP() </span>function from the <span 
class="aessbx-10x-x-109">spatstat R </span>package. By default
that function do simulation on window over the <span 
class="cmr-10x-x-109">(0</span><span 
class="cmmi-10x-x-109">,</span><span 
class="cmr-10x-x-109">1) </span><span 
class="cmsy-10x-x-109">&#x00D7; </span><span 
class="cmr-10x-x-109">(0</span><span 
class="cmmi-10x-x-109">,</span><span 
class="cmr-10x-x-109">1) </span>square. We choose to do simulation
over the <span 
class="cmr-10x-x-109">(0</span><span 
class="cmmi-10x-x-109">,</span><span 
class="cmr-10x-x-109">3) </span><span 
class="cmsy-10x-x-109">&#x00D7; </span><span 
class="cmr-10x-x-109">(0</span><span 
class="cmmi-10x-x-109">,</span><span 
class="cmr-10x-x-109">3) </span>square.  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor8844"><span 
class="aett-10x-x-109">library</span></span><span id="textcolor8845"><span 
class="aett-10x-x-109">(spatstat)</span></span>
<br /><span id="textcolor8846"><span 
class="aett-10x-x-109">win</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8847"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8848"><span 
class="aett-10x-x-109">owin</span></span><span id="textcolor8849"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8850"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor8851"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8852"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor8853"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor8854"><span 
class="aett-10x-x-109">3</span></span><span id="textcolor8855"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8856"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor8857"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8858"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor8859"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor8860"><span 
class="aett-10x-x-109">3</span></span><span id="textcolor8861"><span 
class="aett-10x-x-109">))</span></span>
</div>
</div>
   </div>
<!--l. 55--><p class="indent" >   This function uses the <span 
class="aett-10x-x-109">GaussRF() </span>function from the <span 
class="aessbx-10x-x-109">RandomFields </span>package. The <span 
class="aett-10x-x-109">rLGCP </span>uses
the <span 
class="aett-10x-x-109">GaussRF() </span>function to do simulation of the LGRF over a grid on the provided window and
use it to do the point process simulation.
</p><!--l. 61--><p class="indent" >   There is an internal parameter to control the resolution of the grid. We change it to
</p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor8862"><span 
class="aett-10x-x-109">spatstat.options</span></span><span id="textcolor8863"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8864"><span 
class="aett-10x-x-109">npixel</span></span><span id="textcolor8865"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor8866"><span 
class="aett-10x-x-109">300</span></span><span id="textcolor8867"><span 
class="aett-10x-x-109">)</span></span>
</div>
</div>
                                                                                 
                                                                                 
   </div>
<!--l. 71--><p class="indent" >   First we define the model parameter for the model is the mean of the LGRF. This is directly
related to expected number of points of the spatial pattern. The expected number of points is its
exponential times the area fo the window. We use  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor8868"><span 
class="aett-10x-x-109">beta0</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8869"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8870"><span 
class="aett-10x-x-109">3</span></span>
</div>
</div>
   </div>
So, the expected number of points is  <div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor8871"><span 
class="aett-10x-x-109">exp</span></span><span id="textcolor8872"><span 
class="aett-10x-x-109">(beta0)</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8873"><span 
class="aett-10x-x-109">*</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8874"><span 
class="aett-10x-x-109">diff</span></span><span id="textcolor8875"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8876"><span 
class="aett-10x-x-109">range</span></span><span id="textcolor8877"><span 
class="aett-10x-x-109">(win</span></span><span id="textcolor8878"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor8879"><span 
class="aett-10x-x-109">x))</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8880"><span 
class="aett-10x-x-109">*</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8881"><span 
class="aett-10x-x-109">diff</span></span><span id="textcolor8882"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8883"><span 
class="aett-10x-x-109">range</span></span><span id="textcolor8884"><span 
class="aett-10x-x-109">(win</span></span><span id="textcolor8885"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor8886"><span 
class="aett-10x-x-109">y))</span></span>
</div>
</div>
                                                                                 
                                                                                 
   <div class="verbatim" id="verbatim-71">
##&#x00A0;[1]&#x00A0;180.7698
</div>
<!--l. 93--><p class="nopar" >
</p>
   </div>
Is also possible to use a functional, see Shapter&#x00A0;<a 
href="#x8-740004.2">4.2<!--tex4ht:ref: sec:lcoxcov --></a>.
<!--l. 99--><p class="indent" >   In the estimation process we use the Matern covariance function with <span 
class="cmmi-10x-x-109">&#x03BD; </span><span 
class="cmr-10x-x-109">= 1</span>. So,
here we just fix it on this value. The other parameters are the variance and scale
</p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor8887"><span 
class="aett-10x-x-109">sigma2x</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8888"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8889"><span 
class="aett-10x-x-109">0.2</span></span><span id="textcolor8890"><span 
class="aett-10x-x-109">;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;kappa</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8891"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8892"><span 
class="aett-10x-x-109">2</span></span>
</div>
</div>
   </div>
<!--l. 111--><p class="indent" >   Doing the simulation  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor8893"><span 
class="aett-10x-x-109">library</span></span><span id="textcolor8894"><span 
class="aett-10x-x-109">(RandomFields)</span></span>
<br /><span id="textcolor8895"><span 
class="aett-10x-x-109">set.seed</span></span><span id="textcolor8896"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8897"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor8898"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor8899"><span 
class="aett-10x-x-109">lg.s</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8900"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8901"><span 
class="aett-10x-x-109">rLGCP</span></span><span id="textcolor8902"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8903"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">matern</span><span 
class="tctt-1095">'</span></span><span id="textcolor8904"><span 
class="aett-10x-x-109">,</span><span 
class="aett-10x-x-109">&#x00A0;beta0,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8905"><span 
class="aett-10x-x-109">var</span></span><span id="textcolor8906"><span 
class="aett-10x-x-109">=sigma2x,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8907"><span 
class="aett-10x-x-109">scale</span></span><span id="textcolor8908"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor8909"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor8910"><span 
class="aett-10x-x-109">/</span></span><span id="textcolor8911"><span 
class="aett-10x-x-109">kappa,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8912"><span 
class="aett-10x-x-109">nu</span></span><span id="textcolor8913"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor8914"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor8915"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8916"><span 
class="aett-10x-x-109">win</span></span><span id="textcolor8917"><span 
class="aett-10x-x-109">=win)</span></span>
</div>
</div>
   </div>
<!--l. 123--><p class="indent" >   Both the LGRF and the point pattern are returned. We collect the point pattern locations
coordinates with  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor8918"><span 
class="aett-10x-x-109">xy</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8919"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8920"><span 
class="aett-10x-x-109">cbind</span></span><span id="textcolor8921"><span 
class="aett-10x-x-109">(lg.s</span></span><span id="textcolor8922"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor8923"><span 
class="aett-10x-x-109">x,</span><span 
class="aett-10x-x-109">&#x00A0;lg.s</span></span><span id="textcolor8924"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor8925"><span 
class="aett-10x-x-109">y)[,</span></span><span id="textcolor8926"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor8927"><span 
class="aett-10x-x-109">:</span></span><span id="textcolor8928"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor8929"><span 
class="aett-10x-x-109">]</span></span>
</div>
</div>
   </div>
and the number of points is  <div class="framedenv" id="kframe-1">
   <div class="alltt">
                                                                                 
                                                                                 
<div class="obeylines-v">
<span id="textcolor8930"><span 
class="aett-10x-x-109">(n</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8931"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8932"><span 
class="aett-10x-x-109">nrow</span></span><span id="textcolor8933"><span 
class="aett-10x-x-109">(xy))</span></span>
</div>
</div>
                                                                                 
                                                                                 
   <div class="verbatim" id="verbatim-72">
##&#x00A0;[1]&#x00A0;219
</div>
<!--l. 140--><p class="nopar" >
</p>
   </div>
<!--l. 144--><p class="indent" >   The exponential of simulated values of the LGRF are returned as the <span 
class="aett-10x-x-109">Lambda</span>
attribute of the object. We extract the <span 
class="cmr-10x-x-109">&#x039B; </span>and see a summary of the <span 
class="cmmi-10x-x-109">log</span><span 
class="cmr-10x-x-109">(&#x039B;) </span>below
</p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor8934"><span 
class="aett-10x-x-109">Lam</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8935"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8936"><span 
class="aett-10x-x-109">attr</span></span><span id="textcolor8937"><span 
class="aett-10x-x-109">(lg.s,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8938"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">Lambda</span><span 
class="tctt-1095">'</span></span><span id="textcolor8939"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor8940"><span 
class="aett-10x-x-109">summary</span></span><span id="textcolor8941"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8942"><span 
class="aett-10x-x-109">as.vector</span></span><span id="textcolor8943"><span 
class="aett-10x-x-109">(rf.s</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8944"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8945"><span 
class="aett-10x-x-109">log</span></span><span id="textcolor8946"><span 
class="aett-10x-x-109">(Lam</span></span><span id="textcolor8947"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor8948"><span 
class="aett-10x-x-109">v)))</span></span>
</div>
</div>
                                                                                 
                                                                                 
   <div class="verbatim" id="verbatim-73">
##&#x00A0;&#x00A0;&#x00A0;&#x00A0;Min.&#x00A0;1st&#x00A0;Qu.&#x00A0;&#x00A0;Median&#x00A0;&#x00A0;&#x00A0;&#x00A0;Mean&#x00A0;3rd&#x00A0;Qu.&#x00A0;&#x00A0;&#x00A0;&#x00A0;Max.
&#x00A0;<br />##&#x00A0;&#x00A0;&#x00A0;2.368&#x00A0;&#x00A0;&#x00A0;2.928&#x00A0;&#x00A0;&#x00A0;3.146&#x00A0;&#x00A0;&#x00A0;3.160&#x00A0;&#x00A0;&#x00A0;3.371&#x00A0;&#x00A0;&#x00A0;4.450
</div>
<!--l. 157--><p class="nopar" >
</p>
   </div>
<!--l. 161--><p class="indent" >   We can see the simulated LGRF over the grid and the point pattern simulated in
Figure&#x00A0;<a 
href="#x8-690004.1.1">4.1.1<!--tex4ht:ref: fig:lgrfpp --></a> produced with the following commands  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor8949"><span 
class="aett-10x-x-109">par</span></span><span id="textcolor8950"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8951"><span 
class="aett-10x-x-109">mfrow</span></span><span id="textcolor8952"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor8953"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor8954"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8955"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor8956"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor8957"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor8958"><span 
class="aett-10x-x-109">))</span></span>
<br /><span id="textcolor8959"><span 
class="aett-10x-x-109">library</span></span><span id="textcolor8960"><span 
class="aett-10x-x-109">(fields)</span></span>
<br /><span id="textcolor8961"><span 
class="aett-10x-x-109">image.plot</span></span><span id="textcolor8962"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8963"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor8964"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8965"><span 
class="aett-10x-x-109">x</span></span><span id="textcolor8966"><span 
class="aett-10x-x-109">=Lam</span></span><span id="textcolor8967"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor8968"><span 
class="aett-10x-x-109">yrow,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8969"><span 
class="aett-10x-x-109">y</span></span><span id="textcolor8970"><span 
class="aett-10x-x-109">=Lam</span></span><span id="textcolor8971"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor8972"><span 
class="aett-10x-x-109">xcol,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8973"><span 
class="aett-10x-x-109">z</span></span><span id="textcolor8974"><span 
class="aett-10x-x-109">=rf.s),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8975"><span 
class="aett-10x-x-109">main</span></span><span id="textcolor8976"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor8977"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">log-Lambda</span><span 
class="tctt-1095">'</span></span><span id="textcolor8978"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8979"><span 
class="aett-10x-x-109">asp</span></span><span id="textcolor8980"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor8981"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor8982"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor8983"><span 
class="aett-10x-x-109">points</span></span><span id="textcolor8984"><span 
class="aett-10x-x-109">(xy,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8985"><span 
class="aett-10x-x-109">pch</span></span><span id="textcolor8986"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor8987"><span 
class="aett-10x-x-109">19</span></span><span id="textcolor8988"><span 
class="aett-10x-x-109">)</span></span>
</div>
</div>
   </div>
<hr class="figure" /><div class="figure" 
>
                                                                                 
                                                                                 
<a 
 id="x8-690011"></a>
                                                                                 
                                                                                 
<!--l. 177--><p class="noindent" ><img 
src="spde-tutorial58x.png" alt="PIC" class="graphics" width="361" height="361"  /><!--tex4ht:graphics  
name="spde-tutorial58x.png" src="figs/prefsamplunnamed-chunk-4-1.eps"  
-->
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;4.1: </span><span  
class="content">Simulated intensity of the point process (left), simulated point pattern (right).</span></div><!--tex4ht:label?: x8-690011 -->
                                                                                 
                                                                                 
   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">4.1.2   </span> <a 
 id="x8-700004.1.2"></a>Inference</h4>
<!--l. 187--><p class="noindent" >Following <span class="cite">[<a 
href="spde-tutorialli2.html#Xsimpsonetal:2016">Simpson et&#x00A0;al., 2016</a>]</span> we can estimate the parameters of the log-Cox point process
model using few command lines.
</p><!--l. 190--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x8-710004.1.2"></a>The mesh and the weights</h5>
<!--l. 192--><p class="noindent" >To do inference for the log-Cox point process model we also need some care on building the
mesh and on using it.
</p><!--l. 195--><p class="indent" >   To do inference for the log Cox process, it is not necessarly better to have any location points
as any of the mesh nodes, as on the geostatistical analysis where it helps a bit for the estimation
of the nugget effect, see&#x00A0;<a 
href="spde-tutorialch1.html#x5-260001.2.7">1.2.7<!--tex4ht:ref: sec:meshcompare --></a>. We just need a mesh that covers the study region. So, we use the
<span 
class="aett-10x-x-109">loc.domain </span>argument to build the mesh.
</p><!--l. 202--><p class="indent" >   An additional thing is that we ignore the second outer extension and we use a small first
outer extension. This is because it is not necessary to have nodes out of the study region when it
recieves zero weights (see weight computation below).  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor8989"><span 
class="aett-10x-x-109">loc.d</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8990"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor8991"><span 
class="aett-10x-x-109">3</span></span><span id="textcolor8992"><span 
class="aett-10x-x-109">*</span></span><span id="textcolor8993"><span 
class="aett-10x-x-109">t</span></span><span id="textcolor8994"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8995"><span 
class="aett-10x-x-109">matrix</span></span><span id="textcolor8996"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8997"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor8998"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor8999"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9000"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9001"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9002"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9003"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9004"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9005"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9006"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9007"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9008"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9009"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9010"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9011"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9012"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9013"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9014"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9015"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9016"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9017"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9018"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9019"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9020"><span 
class="aett-10x-x-109">))</span></span>
<br /><span id="textcolor9021"><span 
class="aett-10x-x-109">(nv</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9022"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9023"><span 
class="aett-10x-x-109">(mesh</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9024"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9025"><span 
class="aett-10x-x-109">inla.mesh.2d</span></span><span id="textcolor9026"><span 
class="aett-10x-x-109">(</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9027"><span 
class="aett-10x-x-109">loc.domain</span></span><span id="textcolor9028"><span 
class="aett-10x-x-109">=loc.d,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9029"><span 
class="aett-10x-x-109">offset</span></span><span id="textcolor9030"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9031"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9032"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9033"><span 
class="aett-10x-x-109">.3</span></span><span id="textcolor9034"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9035"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9036"><span 
class="aett-10x-x-109">),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9037"><span 
class="aett-10x-x-109">max.edge</span></span><span id="textcolor9038"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9039"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9040"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9041"><span 
class="aett-10x-x-109">.3</span></span><span id="textcolor9042"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9043"><span 
class="aett-10x-x-109">0.7</span></span><span id="textcolor9044"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9045"><span 
class="aett-10x-x-109">cutoff</span></span><span id="textcolor9046"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9047"><span 
class="aett-10x-x-109">.05</span></span><span id="textcolor9048"><span 
class="aett-10x-x-109">))</span></span><span id="textcolor9049"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9050"><span 
class="aett-10x-x-109">n)</span></span>
</div>
</div>
                                                                                 
                                                                                 
   <div class="verbatim" id="verbatim-74">
##&#x00A0;[1]&#x00A0;485
</div>
<!--l. 216--><p class="nopar" >
</p>
   </div>
which is visualized at Figure&#x00A0;<a 
href="#x8-710004.1.2">4.1.2<!--tex4ht:ref: fig:ppmesh --></a> with following commands  <div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9051"><span 
class="aett-10x-x-109">par</span></span><span id="textcolor9052"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9053"><span 
class="aett-10x-x-109">mar</span></span><span id="textcolor9054"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9055"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9056"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9057"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9058"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9059"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9060"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9061"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9062"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9063"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9064"><span 
class="aett-10x-x-109">))</span></span>
<br /><span id="textcolor9065"><span 
class="aett-10x-x-109">plot</span></span><span id="textcolor9066"><span 
class="aett-10x-x-109">(mesh,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9067"><span 
class="aett-10x-x-109">asp</span></span><span id="textcolor9068"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9069"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9070"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9071"><span 
class="aett-10x-x-109">main</span></span><span id="textcolor9072"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9073"><span 
class="tctt-1095">''</span></span><span id="textcolor9074"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9075"><span 
class="aett-10x-x-109">points</span></span><span id="textcolor9076"><span 
class="aett-10x-x-109">(xy,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9077"><span 
class="aett-10x-x-109">col</span></span><span id="textcolor9078"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9079"><span 
class="aett-10x-x-109">4</span></span><span id="textcolor9080"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9081"><span 
class="aett-10x-x-109">pch</span></span><span id="textcolor9082"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9083"><span 
class="aett-10x-x-109">19</span></span><span id="textcolor9084"><span 
class="aett-10x-x-109">);</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9085"><span 
class="aett-10x-x-109">lines</span></span><span id="textcolor9086"><span 
class="aett-10x-x-109">(loc.d,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9087"><span 
class="aett-10x-x-109">col</span></span><span id="textcolor9088"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9089"><span 
class="aett-10x-x-109">3</span></span><span id="textcolor9090"><span 
class="aett-10x-x-109">)</span></span>
</div>
</div>
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                                 
                                                                                 
<a 
 id="x8-710012"></a>
                                                                                 
                                                                                 
<!--l. 234--><p class="noindent" ><img 
src="spde-tutorial59x.png" alt="PIC" class="graphics" width="361" height="361"  /><!--tex4ht:graphics  
name="spde-tutorial59x.png" src="figs/prefsamplunnamed-chunk-5-1.eps"  
-->
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;4.2: </span><span  
class="content">Mesh used to inference for the log-Cox process.</span></div><!--tex4ht:label?: x8-710012 -->
                                                                                 
                                                                                 
   </div><hr class="endfigure" />
<!--l. 240--><p class="indent" >   Defining the SPDE model considering the PC-prior derived in <span class="cite">[<a 
href="spde-tutorialli2.html#Xfuglstadetal:2017">Fuglstad et&#x00A0;al., 2017</a>]</span> for the
model parameters as the practical range, <img 
src="spde-tutorial60x.png" alt="&#x221A; ---
  8&#x03BD;"  class="sqrt"  /><span 
class="cmmi-10x-x-109">&#x2215;&#x03BA;</span>, and the marginal standard deviation.
</p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9091"><span 
class="aett-10x-x-109">spde</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9092"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9093"><span 
class="aett-10x-x-109">inla.spde2.pcmatern</span></span><span id="textcolor9094"><span 
class="aett-10x-x-109">(</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9095"><span 
class="aett-10x-x-109">mesh</span></span><span id="textcolor9096"><span 
class="aett-10x-x-109">=mesh,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9097"><span 
class="aett-10x-x-109">alpha</span></span><span id="textcolor9098"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9099"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9100"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9101"><span 
class="aeitt-10x-x-109">###</span><span 
class="aeitt-10x-x-109">&#x00A0;mesh</span><span 
class="aeitt-10x-x-109">&#x00A0;and</span><span 
class="aeitt-10x-x-109">&#x00A0;smoothness</span><span 
class="aeitt-10x-x-109">&#x00A0;parameter</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9102"><span 
class="aett-10x-x-109">prior.range</span></span><span id="textcolor9103"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9104"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9105"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9106"><span 
class="aett-10x-x-109">0.05</span></span><span id="textcolor9107"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9108"><span 
class="aett-10x-x-109">0.01</span></span><span id="textcolor9109"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9110"><span 
class="aeitt-10x-x-109">###</span><span 
class="aeitt-10x-x-109">&#x00A0;P(practic.range&#x003C;0.05)=0.01</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9111"><span 
class="aett-10x-x-109">prior.sigma</span></span><span id="textcolor9112"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9113"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9114"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9115"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9116"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9117"><span 
class="aett-10x-x-109">0.01</span></span><span id="textcolor9118"><span 
class="aett-10x-x-109">))</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9119"><span 
class="aeitt-10x-x-109">###</span><span 
class="aeitt-10x-x-109">&#x00A0;P(sigma&#x003E;1)=0.01</span></span>
</div>
</div>
   </div>
<!--l. 255--><p class="indent" >   The SPDE approach defines the model on the nodes of the mesh. To fit the the log-Cox
point process model these points are considered the integration points. The method in
<span class="cite">[<a 
href="spde-tutorialli2.html#Xsimpsonetal:2016">Simpson et&#x00A0;al., 2016</a>]</span> defines the expected number of events to be proportional to the
polygons volume of the dual mesh. It means that at the node on the mesh with has the
larger edges we have larger expected value. The <span 
class="aett-10x-x-109">diag(spde$param.inla$M0) </span>gives this
value for every mesh node. However, the mesh has nodes out of the domain implying
</p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9120"><span 
class="aett-10x-x-109">sum</span></span><span id="textcolor9121"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9122"><span 
class="aett-10x-x-109">diag</span></span><span id="textcolor9123"><span 
class="aett-10x-x-109">(spde</span></span><span id="textcolor9124"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9125"><span 
class="aett-10x-x-109">param.inla</span></span><span id="textcolor9126"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9127"><span 
class="aett-10x-x-109">M0))</span></span>
</div>
</div>
                                                                                 
                                                                                 
   <div class="verbatim" id="verbatim-75">
##&#x00A0;[1]&#x00A0;30.06906
</div>
<!--l. 273--><p class="nopar" >
</p>
   </div>
to be larger than the domain area.
<!--l. 278--><p class="indent" >   We can use these values for the nodes on the inner domain and compute
the intersection between the dual mesh polygons and the study domain
polygon. To do that we have the function <span 
class="aett-10x-x-109">inla.mesh.dual()</span>, available in
<a 
href="http://inla.r-inla-download.org/r-inla.org/tutorials/spde/R/spde-tutorial-functions.R" class="url" ><span 
class="aett-10x-x-109">http://inla.r-inla-download.org/r-inla.org/tutorials/spde/R/spde-tutorial-functions.R</span></a>
This function considers a mesh and return the dual mesh in the <span 
class="aett-10x-x-109">SpatialPolygons </span>class.
</p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9128"><span 
class="aett-10x-x-109">dmesh</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9129"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9130"><span 
class="aett-10x-x-109">inla.mesh.dual</span></span><span id="textcolor9131"><span 
class="aett-10x-x-109">(mesh)</span></span>
</div>
</div>
   </div>
We can see it in Figure&#x00A0;<a 
href="#x8-710004.1.2">4.1.2<!--tex4ht:ref: fig:dualmesh --></a>.
<!--l. 295--><p class="indent" >   We can convert the domain polygon into a <span 
class="aett-10x-x-109">SpatialPolygons </span>class with  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9132"><span 
class="aett-10x-x-109">domainSP</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9133"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9134"><span 
class="aett-10x-x-109">SpatialPolygons</span></span><span id="textcolor9135"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9136"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9137"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9138"><span 
class="aett-10x-x-109">Polygons</span></span><span id="textcolor9139"><span 
class="aett-10x-x-109">(</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9140"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9141"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9142"><span 
class="aett-10x-x-109">Polygon</span></span><span id="textcolor9143"><span 
class="aett-10x-x-109">(loc.d)),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9144"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">0</span><span 
class="tctt-1095">'</span></span><span id="textcolor9145"><span 
class="aett-10x-x-109">)))</span></span>
</div>
</div>
   </div>
Them, we can have the intersection with each polygon from the mesh dual using the functions
<span 
class="aett-10x-x-109">gIntersection() </span>from the <span 
class="aessbx-10x-x-109">rgeos </span>package  <div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9146"><span 
class="aett-10x-x-109">library</span></span><span id="textcolor9147"><span 
class="aett-10x-x-109">(rgeos)</span></span>
<br /><span id="textcolor9148"><span 
class="aett-10x-x-109">sum</span></span><span id="textcolor9149"><span 
class="aett-10x-x-109">(w</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9150"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9151"><span 
class="aett-10x-x-109">sapply</span></span><span id="textcolor9152"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9153"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9154"><span 
class="aett-10x-x-109">:</span></span><span id="textcolor9155"><span 
class="aett-10x-x-109">length</span></span><span id="textcolor9156"><span 
class="aett-10x-x-109">(dmesh),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9157"><span 
class="aett-10x-x-109">function</span></span><span id="textcolor9158"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9159"><span 
class="aett-10x-x-109">i</span></span><span id="textcolor9160"><span 
class="aett-10x-x-109">)</span><span 
class="aett-10x-x-109">&#x00A0;{</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9161"><span 
class="aett-10x-x-109">if</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9162"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9163"><span 
class="aett-10x-x-109">gIntersects</span></span><span id="textcolor9164"><span 
class="aett-10x-x-109">(dmesh[i,],</span><span 
class="aett-10x-x-109">&#x00A0;domainSP))</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9165"><span 
class="aett-10x-x-109">return</span></span><span id="textcolor9166"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9167"><span 
class="aett-10x-x-109">gArea</span></span><span id="textcolor9168"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9169"><span 
class="aett-10x-x-109">gIntersection</span></span><span id="textcolor9170"><span 
class="aett-10x-x-109">(dmesh[i,],</span><span 
class="aett-10x-x-109">&#x00A0;domainSP)))</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9171"><span 
class="aett-10x-x-109">else</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9172"><span 
class="aett-10x-x-109">return</span></span><span id="textcolor9173"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9174"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9175"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9176"><span 
class="aett-10x-x-109">}))</span></span>
</div>
</div>
                                                                                 
                                                                                 
   <div class="verbatim" id="verbatim-76">
##&#x00A0;[1]&#x00A0;9
</div>
<!--l. 321--><p class="nopar" >
</p>
   </div>
And we chan check that there are integration points with zero weight.  <div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9177"><span 
class="aett-10x-x-109">table</span></span><span id="textcolor9178"><span 
class="aett-10x-x-109">(w</span></span><span id="textcolor9179"><span 
class="aett-10x-x-109">&#x003E;</span></span><span id="textcolor9180"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9181"><span 
class="aett-10x-x-109">)</span></span>
</div>
</div>
                                                                                 
                                                                                 
   <div class="verbatim" id="verbatim-77">
##
&#x00A0;<br />##&#x00A0;FALSE&#x00A0;&#x00A0;TRUE
&#x00A0;<br />##&#x00A0;&#x00A0;&#x00A0;197&#x00A0;&#x00A0;&#x00A0;288
</div>
<!--l. 335--><p class="nopar" >
</p>
   </div>
These are identified in red in Figure&#x00A0;<a 
href="#x8-710004.1.2">4.1.2<!--tex4ht:ref: fig:dualmesh --></a>.  <div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9182"><span 
class="aett-10x-x-109">par</span></span><span id="textcolor9183"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9184"><span 
class="aett-10x-x-109">mar</span></span><span id="textcolor9185"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9186"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9187"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9188"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9189"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9190"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9191"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9192"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9193"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9194"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9195"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9196"><span 
class="aett-10x-x-109">mgp</span></span><span id="textcolor9197"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9198"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9199"><span 
class="aett-10x-x-109">:</span></span><span id="textcolor9200"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9201"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9202"><span 
class="aett-10x-x-109">plot</span></span><span id="textcolor9203"><span 
class="aett-10x-x-109">(mesh</span></span><span id="textcolor9204"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9205"><span 
class="aett-10x-x-109">loc,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9206"><span 
class="aett-10x-x-109">asp</span></span><span id="textcolor9207"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9208"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9209"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9210"><span 
class="aett-10x-x-109">col</span></span><span id="textcolor9211"><span 
class="aett-10x-x-109">=(w</span></span><span id="textcolor9212"><span 
class="aett-10x-x-109">==</span></span><span id="textcolor9213"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9214"><span 
class="aett-10x-x-109">)</span></span><span id="textcolor9215"><span 
class="aett-10x-x-109">+</span></span><span id="textcolor9216"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9217"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9218"><span 
class="aett-10x-x-109">pch</span></span><span id="textcolor9219"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9220"><span 
class="aett-10x-x-109">19</span></span><span id="textcolor9221"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9222"><span 
class="aett-10x-x-109">xlab</span></span><span id="textcolor9223"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9224"><span 
class="tctt-1095">''</span></span><span id="textcolor9225"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9226"><span 
class="aett-10x-x-109">ylab</span></span><span id="textcolor9227"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9228"><span 
class="tctt-1095">''</span></span><span id="textcolor9229"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9230"><span 
class="aett-10x-x-109">plot</span></span><span id="textcolor9231"><span 
class="aett-10x-x-109">(dmesh,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9232"><span 
class="aett-10x-x-109">add</span></span><span id="textcolor9233"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9234"><span 
class="aett-10x-x-109">TRUE</span></span><span id="textcolor9235"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9236"><span 
class="aett-10x-x-109">lines</span></span><span id="textcolor9237"><span 
class="aett-10x-x-109">(loc.d,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9238"><span 
class="aett-10x-x-109">col</span></span><span id="textcolor9239"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9240"><span 
class="aett-10x-x-109">3</span></span><span id="textcolor9241"><span 
class="aett-10x-x-109">)</span></span>
</div>
</div>
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                                 
                                                                                 
<a 
 id="x8-710023"></a>
                                                                                 
                                                                                 
<!--l. 354--><p class="noindent" ><img 
src="spde-tutorial61x.png" alt="PIC" class="graphics" width="361" height="361"  /><!--tex4ht:graphics  
name="spde-tutorial61x.png" src="figs/prefsamplunnamed-chunk-7-1.eps"  
-->
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;4.3: </span><span  
class="content">Voronoy polygons for the mesh used to inference for the log-Cox process.</span></div><!--tex4ht:label?: x8-710023 -->
                                                                                 
                                                                                 
   </div><hr class="endfigure" />
   <h5 class="subsubsectionHead"><a 
 id="x8-720004.1.2"></a>The data and projector matrices</h5>
<!--l. 362--><p class="noindent" >This vector is just what we need to use as the exposure (expected) for the Poisson likelihood and
is related to the augumented data that we need to fit using the Poisson likelihood. We can
specify that the first observations (number of nodes) are zero and the last are ones (number of
events).  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9242"><span 
class="aett-10x-x-109">y.pp</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9243"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9244"><span 
class="aett-10x-x-109">rep</span></span><span id="textcolor9245"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9246"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9247"><span 
class="aett-10x-x-109">:</span></span><span id="textcolor9248"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9249"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9250"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9251"><span 
class="aett-10x-x-109">(nv,</span><span 
class="aett-10x-x-109">&#x00A0;n))</span></span>
</div>
</div>
   </div>
So, the expected vector can be defined by  <div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9252"><span 
class="aett-10x-x-109">e.pp</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9253"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9254"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9255"><span 
class="aett-10x-x-109">(w,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9256"><span 
class="aett-10x-x-109">rep</span></span><span id="textcolor9257"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9258"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9259"><span 
class="aett-10x-x-109">,</span><span 
class="aett-10x-x-109">&#x00A0;n))</span></span>
</div>
</div>
   </div>
<!--l. 383--><p class="indent" >   We must have to define the projector matrix to do inference using the SPDE approach,
<span class="cite">[<a 
href="spde-tutorialli2.html#Xlindgren:2012">Lindgren, 2012</a>]</span>. For the observed points locations we have  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9260"><span 
class="aett-10x-x-109">lmat</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9261"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9262"><span 
class="aett-10x-x-109">inla.spde.make.A</span></span><span id="textcolor9263"><span 
class="aett-10x-x-109">(mesh,</span><span 
class="aett-10x-x-109">&#x00A0;xy)</span></span>
</div>
</div>
   </div>
We need also a projector matrix for the integration points and this is just a diagonal matrix
because this locations are just the mesh vertices.  <div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9264"><span 
class="aett-10x-x-109">imat</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9265"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9266"><span 
class="aett-10x-x-109">Diagonal</span></span><span id="textcolor9267"><span 
class="aett-10x-x-109">(nv,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9268"><span 
class="aett-10x-x-109">rep</span></span><span id="textcolor9269"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9270"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9271"><span 
class="aett-10x-x-109">,</span><span 
class="aett-10x-x-109">&#x00A0;nv))</span></span>
</div>
</div>
   </div>
So, the entire projector matrix is  <div class="framedenv" id="kframe-1">
   <div class="alltt">
                                                                                 
                                                                                 
<div class="obeylines-v">
<span id="textcolor9272"><span 
class="aett-10x-x-109">A.pp</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9273"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9274"><span 
class="aett-10x-x-109">rBind</span></span><span id="textcolor9275"><span 
class="aett-10x-x-109">(imat,</span><span 
class="aett-10x-x-109">&#x00A0;lmat)</span></span>
</div>
</div>
   </div>
<!--l. 413--><p class="indent" >   The data stack can be made by  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9276"><span 
class="aett-10x-x-109">stk.pp</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9277"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9278"><span 
class="aett-10x-x-109">inla.stack</span></span><span id="textcolor9279"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9280"><span 
class="aett-10x-x-109">data</span></span><span id="textcolor9281"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9282"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9283"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9284"><span 
class="aett-10x-x-109">y</span></span><span id="textcolor9285"><span 
class="aett-10x-x-109">=y.pp,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9286"><span 
class="aett-10x-x-109">e</span></span><span id="textcolor9287"><span 
class="aett-10x-x-109">=e.pp),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9288"><span 
class="aett-10x-x-109">A</span></span><span id="textcolor9289"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9290"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9291"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9292"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9293"><span 
class="aett-10x-x-109">,A.pp),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9294"><span 
class="aett-10x-x-109">tag</span></span><span id="textcolor9295"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9296"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">pp</span><span 
class="tctt-1095">'</span></span><span id="textcolor9297"><span 
class="aett-10x-x-109">,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9298"><span 
class="aett-10x-x-109">effects</span></span><span id="textcolor9299"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9300"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9301"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9302"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9303"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9304"><span 
class="aett-10x-x-109">b0</span></span><span id="textcolor9305"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9306"><span 
class="aett-10x-x-109">rep</span></span><span id="textcolor9307"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9308"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9309"><span 
class="aett-10x-x-109">,nv</span></span><span id="textcolor9310"><span 
class="aett-10x-x-109">+</span></span><span id="textcolor9311"><span 
class="aett-10x-x-109">n)),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9312"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9313"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9314"><span 
class="aett-10x-x-109">i</span></span><span id="textcolor9315"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9316"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9317"><span 
class="aett-10x-x-109">:</span></span><span id="textcolor9318"><span 
class="aett-10x-x-109">nv)))</span></span>
</div>
</div>
   </div>
<!--l. 424--><p class="noindent" >
</p>
   <h5 class="subsubsectionHead"><a 
 id="x8-730004.1.2"></a>Posterior marginals</h5>
<!--l. 426--><p class="noindent" >The posterior marginals for the parameters are obtained with  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9319"><span 
class="aett-10x-x-109">pp.res</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9320"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9321"><span 
class="aett-10x-x-109">inla</span></span><span id="textcolor9322"><span 
class="aett-10x-x-109">(y</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9323"><span 
class="aett-10x-x-109">~</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9324"><span 
class="aett-10x-x-109">0</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9325"><span 
class="aett-10x-x-109">+</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9326"><span 
class="aett-10x-x-109">b0</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9327"><span 
class="aett-10x-x-109">+</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9328"><span 
class="aett-10x-x-109">f</span></span><span id="textcolor9329"><span 
class="aett-10x-x-109">(i,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9330"><span 
class="aett-10x-x-109">model</span></span><span id="textcolor9331"><span 
class="aett-10x-x-109">=spde),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9332"><span 
class="aett-10x-x-109">family</span></span><span id="textcolor9333"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9334"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">poisson</span><span 
class="tctt-1095">'</span></span><span id="textcolor9335"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9336"><span 
class="aett-10x-x-109">data</span></span><span id="textcolor9337"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9338"><span 
class="aett-10x-x-109">inla.stack.data</span></span><span id="textcolor9339"><span 
class="aett-10x-x-109">(stk.pp),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9340"><span 
class="aett-10x-x-109">control.predictor</span></span><span id="textcolor9341"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9342"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9343"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9344"><span 
class="aett-10x-x-109">A</span></span><span id="textcolor9345"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9346"><span 
class="aett-10x-x-109">inla.stack.A</span></span><span id="textcolor9347"><span 
class="aett-10x-x-109">(stk.pp)),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9348"><span 
class="aett-10x-x-109">E</span></span><span id="textcolor9349"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9350"><span 
class="aett-10x-x-109">inla.stack.data</span></span><span id="textcolor9351"><span 
class="aett-10x-x-109">(stk.pp)</span></span><span id="textcolor9352"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9353"><span 
class="aett-10x-x-109">e)</span></span>
</div>
</div>
<!--l. 438--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in inla.inlaprogram.has.crashed(): The inla-program exited with an</span>
<span 
class="aett-10x-x-109">error. Unless you interupted it yourself, please rerun with verbose=TRUE and</span>
<span 
class="aett-10x-x-109">check the output carefully.</span><br 
class="newline" /><span 
class="aett-10x-x-109">##</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;If this does not help, please contact the developers at &#x003C;help@r-inla.org&#x003E;.</span>
</p>
   </div>
<!--l. 441--><p class="indent" >   We can see the summary for the practical range and standard deviation of the lateng
Gaussian random field with  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9354"><span 
class="aett-10x-x-109">round</span></span><span id="textcolor9355"><span 
class="aett-10x-x-109">(pp.res</span></span><span id="textcolor9356"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9357"><span 
class="aett-10x-x-109">summary.hyperpar,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9358"><span 
class="aett-10x-x-109">4</span></span><span id="textcolor9359"><span 
class="aett-10x-x-109">)</span></span>
                                                                                 
                                                                                 
</div>
</div>
<!--l. 450--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in eval(expr, envir, enclos): object &#8217;pp.res&#8217; not found</span>
</p>
   </div>
<!--l. 453--><p class="indent" >   The posterior distribution of the log-Cox model parameters are visualized on the
Figure&#x00A0;<a 
href="#x8-730004.1.2">4.1.2<!--tex4ht:ref: fig:pppost --></a>.  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9360"><span 
class="aett-10x-x-109">par</span></span><span id="textcolor9361"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9362"><span 
class="aett-10x-x-109">mfrow</span></span><span id="textcolor9363"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9364"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9365"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9366"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9367"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9368"><span 
class="aett-10x-x-109">3</span></span><span id="textcolor9369"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9370"><span 
class="aett-10x-x-109">mar</span></span><span id="textcolor9371"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9372"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9373"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9374"><span 
class="aett-10x-x-109">3</span></span><span id="textcolor9375"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9376"><span 
class="aett-10x-x-109">3</span></span><span id="textcolor9377"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9378"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9379"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9380"><span 
class="aett-10x-x-109">0.3</span></span><span id="textcolor9381"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9382"><span 
class="aett-10x-x-109">mgp</span></span><span id="textcolor9383"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9384"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9385"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9386"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9387"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9388"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9389"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9390"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9391"><span 
class="aett-10x-x-109">))</span></span>
<br /><span id="textcolor9392"><span 
class="aett-10x-x-109">plot</span></span><span id="textcolor9393"><span 
class="aett-10x-x-109">(pp.res</span></span><span id="textcolor9394"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9395"><span 
class="aett-10x-x-109">marginals.fix[[</span></span><span id="textcolor9396"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9397"><span 
class="aett-10x-x-109">]],</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9398"><span 
class="aett-10x-x-109">type</span></span><span id="textcolor9399"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9400"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">l</span><span 
class="tctt-1095">'</span></span><span id="textcolor9401"><span 
class="aett-10x-x-109">,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9402"><span 
class="aett-10x-x-109">xlab</span></span><span id="textcolor9403"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9404"><span 
class="aett-10x-x-109">expression</span></span><span id="textcolor9405"><span 
class="aett-10x-x-109">(beta[</span></span><span id="textcolor9406"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9407"><span 
class="aett-10x-x-109">]),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9408"><span 
class="aett-10x-x-109">ylab</span></span><span id="textcolor9409"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9410"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">Density</span><span 
class="tctt-1095">'</span></span><span id="textcolor9411"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9412"><span 
class="aett-10x-x-109">abline</span></span><span id="textcolor9413"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9414"><span 
class="aett-10x-x-109">v</span></span><span id="textcolor9415"><span 
class="aett-10x-x-109">=beta0,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9416"><span 
class="aett-10x-x-109">col</span></span><span id="textcolor9417"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9418"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9419"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9420"><span 
class="aett-10x-x-109">plot</span></span><span id="textcolor9421"><span 
class="aett-10x-x-109">(pp.res</span></span><span id="textcolor9422"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9423"><span 
class="aett-10x-x-109">marginals.hyperpar[[</span></span><span id="textcolor9424"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9425"><span 
class="aett-10x-x-109">]],</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9426"><span 
class="aett-10x-x-109">type</span></span><span id="textcolor9427"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9428"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">l</span><span 
class="tctt-1095">'</span></span><span id="textcolor9429"><span 
class="aett-10x-x-109">,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9430"><span 
class="aett-10x-x-109">xlab</span></span><span id="textcolor9431"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9432"><span 
class="aett-10x-x-109">expression</span></span><span id="textcolor9433"><span 
class="aett-10x-x-109">(sigma</span></span><span id="textcolor9434"><span 
class="aett-10x-x-109">^</span></span><span id="textcolor9435"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9436"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9437"><span 
class="aett-10x-x-109">ylab</span></span><span id="textcolor9438"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9439"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">Density</span><span 
class="tctt-1095">'</span></span><span id="textcolor9440"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9441"><span 
class="aett-10x-x-109">abline</span></span><span id="textcolor9442"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9443"><span 
class="aett-10x-x-109">v</span></span><span id="textcolor9444"><span 
class="aett-10x-x-109">=sigma2x,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9445"><span 
class="aett-10x-x-109">col</span></span><span id="textcolor9446"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9447"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9448"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9449"><span 
class="aett-10x-x-109">plot</span></span><span id="textcolor9450"><span 
class="aett-10x-x-109">(pp.res</span></span><span id="textcolor9451"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9452"><span 
class="aett-10x-x-109">marginals.hyperpar[[</span></span><span id="textcolor9453"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9454"><span 
class="aett-10x-x-109">]],</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9455"><span 
class="aett-10x-x-109">type</span></span><span id="textcolor9456"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9457"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">l</span><span 
class="tctt-1095">'</span></span><span id="textcolor9458"><span 
class="aett-10x-x-109">,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9459"><span 
class="aett-10x-x-109">xlab</span></span><span id="textcolor9460"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9461"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">Nominal</span><span 
class="aett-10x-x-109">&#x00A0;range</span><span 
class="tctt-1095">'</span></span><span id="textcolor9462"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9463"><span 
class="aett-10x-x-109">ylab</span></span><span id="textcolor9464"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9465"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">Density</span><span 
class="tctt-1095">'</span></span><span id="textcolor9466"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9467"><span 
class="aett-10x-x-109">abline</span></span><span id="textcolor9468"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9469"><span 
class="aett-10x-x-109">v</span></span><span id="textcolor9470"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9471"><span 
class="aett-10x-x-109">sqrt</span></span><span id="textcolor9472"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9473"><span 
class="aett-10x-x-109">8</span></span><span id="textcolor9474"><span 
class="aett-10x-x-109">*</span></span><span id="textcolor9475"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9476"><span 
class="aett-10x-x-109">)</span></span><span id="textcolor9477"><span 
class="aett-10x-x-109">/</span></span><span id="textcolor9478"><span 
class="aett-10x-x-109">kappa,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9479"><span 
class="aett-10x-x-109">col</span></span><span id="textcolor9480"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9481"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9482"><span 
class="aett-10x-x-109">)</span></span>
</div>
</div>
   </div>
<hr class="figure" /><div class="figure" 
>
                                                                                 
                                                                                 
<a 
 id="x8-730014"></a>
                                                                                 
                                                                                 
<div class="framedenv" id="kframe-1">
<!--l. 477--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in plot(pp.res$marginals.fix[[1]], type = "l", xlab = expression(beta[0]),</span>
<span 
class="aett-10x-x-109">: object &#8217;pp.res&#8217; not found</span>
</p><!--l. 479--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p><!--l. 481--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in plot(pp.res$marginals.hyperpar[[2]], type = "l", xlab =</span>
<span 
class="aett-10x-x-109">expression(sigma^2), : object &#8217;pp.res&#8217; not found</span>
</p><!--l. 483--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p><!--l. 485--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in plot(pp.res$marginals.hyperpar[[1]], type = "l", xlab = "Nominal</span>
<span 
class="aett-10x-x-109">range", : object &#8217;pp.res&#8217; not found</span>
</p><!--l. 487--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p>
</div>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;4.4: </span><span  
class="content">Posterior distribution for the parameters of the log-Cox model <span 
class="cmmi-10x-x-109">&#x03C3;</span><sup><span 
class="cmr-8">2</span></sup>  (left), <span 
class="cmmi-10x-x-109">&#x03BA;</span>
(mid) and the nominal range (right)</span></div><!--tex4ht:label?: x8-730014 -->
                                                                                 
                                                                                 
   </div><hr class="endfigure" />
   <h3 class="sectionHead"><span class="titlemark">4.2   </span> <a 
 id="x8-740004.2"></a>Including a covariate on the log-Cox process</h3>
<!--l. 497--><p class="noindent" >In the previous example we have done simulation considering the underline intensity as just the
exponential of a realization of a Gaussian random field. In this chapter we consider that we have
an additional effect, which is treated as a covariate. In order to fit the model, it is
needed the covariate value everywhere, at the location points and at the integration
points.
</p><!--l. 505--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.2.1   </span> <a 
 id="x8-750004.2.1"></a>Covariate everywhere</h4>
<!--l. 507--><p class="noindent" >The simulation is done considering that the covariate effect is available at the same grid points
where the Gaussian process is simulated. So, first we create an artificial covariate at the grid
</p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9483"><span 
class="aett-10x-x-109">y0</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9484"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9485"><span 
class="aett-10x-x-109">x0</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9486"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9487"><span 
class="aett-10x-x-109">seq</span></span><span id="textcolor9488"><span 
class="aett-10x-x-109">(win</span></span><span id="textcolor9489"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9490"><span 
class="aett-10x-x-109">xrange[</span></span><span id="textcolor9491"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9492"><span 
class="aett-10x-x-109">],</span><span 
class="aett-10x-x-109">&#x00A0;win</span></span><span id="textcolor9493"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9494"><span 
class="aett-10x-x-109">xrange[</span></span><span id="textcolor9495"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9496"><span 
class="aett-10x-x-109">],</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9497"><span 
class="aett-10x-x-109">length</span></span><span id="textcolor9498"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9499"><span 
class="aett-10x-x-109">spatstat.options</span></span><span id="textcolor9500"><span 
class="aett-10x-x-109">()</span></span><span id="textcolor9501"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9502"><span 
class="aett-10x-x-109">npixel)</span></span>
<br /><span id="textcolor9503"><span 
class="aett-10x-x-109">gridcov</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9504"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9505"><span 
class="aett-10x-x-109">outer</span></span><span id="textcolor9506"><span 
class="aett-10x-x-109">(x0,</span><span 
class="aett-10x-x-109">&#x00A0;y0,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9507"><span 
class="aett-10x-x-109">function</span></span><span id="textcolor9508"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9509"><span 
class="aett-10x-x-109">x</span></span><span id="textcolor9510"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9511"><span 
class="aett-10x-x-109">y</span></span><span id="textcolor9512"><span 
class="aett-10x-x-109">)</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9513"><span 
class="aett-10x-x-109">cos</span></span><span id="textcolor9514"><span 
class="aett-10x-x-109">(x)</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9515"><span 
class="aett-10x-x-109">-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9516"><span 
class="aett-10x-x-109">sin</span></span><span id="textcolor9517"><span 
class="aett-10x-x-109">(y</span></span><span id="textcolor9518"><span 
class="aett-10x-x-109">-</span></span><span id="textcolor9519"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9520"><span 
class="aett-10x-x-109">))</span></span>
</div>
</div>
   </div>
Now, the expected number of points is function of the covariate  <div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9521"><span 
class="aett-10x-x-109">beta1</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9522"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9523"><span 
class="aett-10x-x-109">-</span></span><span id="textcolor9524"><span 
class="aett-10x-x-109">0.5</span></span>
<br /><span id="textcolor9525"><span 
class="aett-10x-x-109">sum</span></span><span id="textcolor9526"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9527"><span 
class="aett-10x-x-109">exp</span></span><span id="textcolor9528"><span 
class="aett-10x-x-109">(beta0</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9529"><span 
class="aett-10x-x-109">+</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9530"><span 
class="aett-10x-x-109">beta1</span></span><span id="textcolor9531"><span 
class="aett-10x-x-109">*</span></span><span id="textcolor9532"><span 
class="aett-10x-x-109">gridcov)</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9533"><span 
class="aett-10x-x-109">*</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9534"><span 
class="aett-10x-x-109">diff</span></span><span id="textcolor9535"><span 
class="aett-10x-x-109">(x0[</span></span><span id="textcolor9536"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9537"><span 
class="aett-10x-x-109">:</span></span><span id="textcolor9538"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9539"><span 
class="aett-10x-x-109">])</span></span><span id="textcolor9540"><span 
class="aett-10x-x-109">*</span></span><span id="textcolor9541"><span 
class="aett-10x-x-109">diff</span></span><span id="textcolor9542"><span 
class="aett-10x-x-109">(y0[</span></span><span id="textcolor9543"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9544"><span 
class="aett-10x-x-109">:</span></span><span id="textcolor9545"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9546"><span 
class="aett-10x-x-109">]))</span></span>
</div>
</div>
                                                                                 
                                                                                 
   <div class="verbatim" id="verbatim-78">
##&#x00A0;[1]&#x00A0;169.1388
</div>
<!--l. 528--><p class="nopar" >
</p>
   </div>
<!--l. 532--><p class="indent" >   Doing the simulation  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9547"><span 
class="aett-10x-x-109">set.seed</span></span><span id="textcolor9548"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9549"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9550"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9551"><span 
class="aett-10x-x-109">lg.s.c</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9552"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9553"><span 
class="aett-10x-x-109">rLGCP</span></span><span id="textcolor9554"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9555"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">matern</span><span 
class="tctt-1095">'</span></span><span id="textcolor9556"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9557"><span 
class="aett-10x-x-109">im</span></span><span id="textcolor9558"><span 
class="aett-10x-x-109">(beta0</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9559"><span 
class="aett-10x-x-109">+</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9560"><span 
class="aett-10x-x-109">beta1</span></span><span id="textcolor9561"><span 
class="aett-10x-x-109">*</span></span><span id="textcolor9562"><span 
class="aett-10x-x-109">gridcov,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9563"><span 
class="aett-10x-x-109">xcol</span></span><span id="textcolor9564"><span 
class="aett-10x-x-109">=x0,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9565"><span 
class="aett-10x-x-109">yrow</span></span><span id="textcolor9566"><span 
class="aett-10x-x-109">=y0),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9567"><span 
class="aett-10x-x-109">var</span></span><span id="textcolor9568"><span 
class="aett-10x-x-109">=sigma2x,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9569"><span 
class="aett-10x-x-109">scale</span></span><span id="textcolor9570"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9571"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9572"><span 
class="aett-10x-x-109">/</span></span><span id="textcolor9573"><span 
class="aett-10x-x-109">kappa,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9574"><span 
class="aett-10x-x-109">nu</span></span><span id="textcolor9575"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9576"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9577"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9578"><span 
class="aett-10x-x-109">win</span></span><span id="textcolor9579"><span 
class="aett-10x-x-109">=win)</span></span>
</div>
</div>
   </div>
<!--l. 543--><p class="indent" >   Both, the LGRF and the point pattern, are returned. The point pattern locations are
</p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9580"><span 
class="aett-10x-x-109">(n.c</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9581"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9582"><span 
class="aett-10x-x-109">nrow</span></span><span id="textcolor9583"><span 
class="aett-10x-x-109">(xy.c</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9584"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9585"><span 
class="aett-10x-x-109">cbind</span></span><span id="textcolor9586"><span 
class="aett-10x-x-109">(lg.s.c</span></span><span id="textcolor9587"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9588"><span 
class="aett-10x-x-109">x,</span><span 
class="aett-10x-x-109">&#x00A0;lg.s.c</span></span><span id="textcolor9589"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9590"><span 
class="aett-10x-x-109">y)[,</span></span><span id="textcolor9591"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9592"><span 
class="aett-10x-x-109">:</span></span><span id="textcolor9593"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9594"><span 
class="aett-10x-x-109">]))</span></span>
</div>
</div>
                                                                                 
                                                                                 
   <div class="verbatim" id="verbatim-79">
##&#x00A0;[1]&#x00A0;190
</div>
<!--l. 552--><p class="nopar" >
</p>
   </div>
<!--l. 556--><p class="indent" >   We can see the covariate values and the simulated LGRF over the grid in Figure&#x00A0;<a 
href="#x8-750004.2.1">4.2.1<!--tex4ht:ref: fig:lgrfppc --></a> with
the following commands  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9595"><span 
class="aett-10x-x-109">library</span></span><span id="textcolor9596"><span 
class="aett-10x-x-109">(fields)</span></span>
<br /><span id="textcolor9597"><span 
class="aett-10x-x-109">par</span></span><span id="textcolor9598"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9599"><span 
class="aett-10x-x-109">mfrow</span></span><span id="textcolor9600"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9601"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9602"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9603"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9604"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9605"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9606"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9607"><span 
class="aett-10x-x-109">mar</span></span><span id="textcolor9608"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9609"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9610"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9611"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9612"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9613"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9614"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9615"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9616"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9617"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9618"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9619"><span 
class="aett-10x-x-109">mgp</span></span><span id="textcolor9620"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9621"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9622"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9623"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9624"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9625"><span 
class="aett-10x-x-109">0.5</span></span><span id="textcolor9626"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9627"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9628"><span 
class="aett-10x-x-109">))</span></span>
<br /><span id="textcolor9629"><span 
class="aett-10x-x-109">image.plot</span></span><span id="textcolor9630"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9631"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9632"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9633"><span 
class="aett-10x-x-109">x</span></span><span id="textcolor9634"><span 
class="aett-10x-x-109">=x0,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9635"><span 
class="aett-10x-x-109">y</span></span><span id="textcolor9636"><span 
class="aett-10x-x-109">=y0,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9637"><span 
class="aett-10x-x-109">z</span></span><span id="textcolor9638"><span 
class="aett-10x-x-109">=gridcov),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9639"><span 
class="aett-10x-x-109">main</span></span><span id="textcolor9640"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9641"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">Covariate</span><span 
class="tctt-1095">'</span></span><span id="textcolor9642"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9643"><span 
class="aett-10x-x-109">asp</span></span><span id="textcolor9644"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9645"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9646"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9647"><span 
class="aett-10x-x-109">image.plot</span></span><span id="textcolor9648"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9649"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9650"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9651"><span 
class="aett-10x-x-109">x</span></span><span id="textcolor9652"><span 
class="aett-10x-x-109">=x0,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9653"><span 
class="aett-10x-x-109">y</span></span><span id="textcolor9654"><span 
class="aett-10x-x-109">=y0,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9655"><span 
class="aett-10x-x-109">z</span></span><span id="textcolor9656"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9657"><span 
class="aett-10x-x-109">log</span></span><span id="textcolor9658"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9659"><span 
class="aett-10x-x-109">attr</span></span><span id="textcolor9660"><span 
class="aett-10x-x-109">(lg.s.c,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9661"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">Lambda</span><span 
class="tctt-1095">'</span></span><span id="textcolor9662"><span 
class="aett-10x-x-109">)</span></span><span id="textcolor9663"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9664"><span 
class="aett-10x-x-109">v)),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9665"><span 
class="aett-10x-x-109">main</span></span><span id="textcolor9666"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9667"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">log-Lambda</span><span 
class="tctt-1095">'</span></span><span id="textcolor9668"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9669"><span 
class="aett-10x-x-109">asp</span></span><span id="textcolor9670"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9671"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9672"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9673"><span 
class="aett-10x-x-109">points</span></span><span id="textcolor9674"><span 
class="aett-10x-x-109">(xy.c,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9675"><span 
class="aett-10x-x-109">pch</span></span><span id="textcolor9676"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9677"><span 
class="aett-10x-x-109">19</span></span><span id="textcolor9678"><span 
class="aett-10x-x-109">)</span></span>
</div>
</div>
   </div>
   <hr class="figure" /><div class="figure" 
>
                                                                                 
                                                                                 
<a 
 id="x8-750015"></a>
                                                                                 
                                                                                 
<!--l. 575--><p class="noindent" ><img 
src="spde-tutorial62x.png" alt="PIC" class="graphics" width="426" height="213"  /><!--tex4ht:graphics  
name="spde-tutorial62x.png" src="figs/prefsamplunnamed-chunk-9-1.eps"  
-->
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;4.5: </span><span  
class="content">Covariate (left), simulated intensity of the point process (mid), simulated
point pattern (right).</span></div><!--tex4ht:label?: x8-750015 -->
                                                                                 
                                                                                 
   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">4.2.2   </span> <a 
 id="x8-760004.2.2"></a>Inference</h4>
<!--l. 584--><p class="noindent" >We have to include the covariate values to do the inference. We need to collect it at the point
pattern locations and at the mesh nodes from the grid.
</p><!--l. 588--><p class="indent" >   We collect the covariate with the command below  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9679"><span 
class="aett-10x-x-109">covariate</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9680"><span 
class="aett-10x-x-109">=</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9681"><span 
class="aett-10x-x-109">gridcov[</span></span><span id="textcolor9682"><span 
class="aett-10x-x-109">Reduce</span></span><span id="textcolor9683"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9684"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">cbind</span><span 
class="tctt-1095">'</span></span><span id="textcolor9685"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9686"><span 
class="aett-10x-x-109">nearest.pixel</span></span><span id="textcolor9687"><span 
class="aett-10x-x-109">(</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9688"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9689"><span 
class="aett-10x-x-109">(mesh</span></span><span id="textcolor9690"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9691"><span 
class="aett-10x-x-109">loc[,</span></span><span id="textcolor9692"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9693"><span 
class="aett-10x-x-109">],</span><span 
class="aett-10x-x-109">&#x00A0;xy.c[,</span></span><span id="textcolor9694"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9695"><span 
class="aett-10x-x-109">]),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9696"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9697"><span 
class="aett-10x-x-109">(mesh</span></span><span id="textcolor9698"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9699"><span 
class="aett-10x-x-109">loc[,</span></span><span id="textcolor9700"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9701"><span 
class="aett-10x-x-109">],</span><span 
class="aett-10x-x-109">&#x00A0;xy.c[,</span></span><span id="textcolor9702"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9703"><span 
class="aett-10x-x-109">]),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9704"><span 
class="aett-10x-x-109">im</span></span><span id="textcolor9705"><span 
class="aett-10x-x-109">(gridcov,</span><span 
class="aett-10x-x-109">&#x00A0;x0,</span><span 
class="aett-10x-x-109">&#x00A0;y0)))]</span></span>
</div>
</div>
   </div>
<!--l. 599--><p class="indent" >   The augumented response data is created in same way as before.  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9706"><span 
class="aett-10x-x-109">y.pp.c</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9707"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9708"><span 
class="aett-10x-x-109">rep</span></span><span id="textcolor9709"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9710"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9711"><span 
class="aett-10x-x-109">:</span></span><span id="textcolor9712"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9713"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9714"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9715"><span 
class="aett-10x-x-109">(nv,</span><span 
class="aett-10x-x-109">&#x00A0;n.c))</span></span>
<br /><span id="textcolor9716"><span 
class="aett-10x-x-109">e.pp.c</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9717"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9718"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9719"><span 
class="aett-10x-x-109">(w,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9720"><span 
class="aett-10x-x-109">rep</span></span><span id="textcolor9721"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9722"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9723"><span 
class="aett-10x-x-109">,</span><span 
class="aett-10x-x-109">&#x00A0;n.c))</span></span>
</div>
</div>
   </div>
<!--l. 609--><p class="indent" >   The projector matrix for the observed points locations  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9724"><span 
class="aett-10x-x-109">lmat.c</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9725"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9726"><span 
class="aett-10x-x-109">inla.spde.make.A</span></span><span id="textcolor9727"><span 
class="aett-10x-x-109">(mesh,</span><span 
class="aett-10x-x-109">&#x00A0;xy.c)</span></span>
</div>
</div>
   </div>
The entire projector matrix, using the previous for the integration points, is  <div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9728"><span 
class="aett-10x-x-109">A.pp.c</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9729"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9730"><span 
class="aett-10x-x-109">rBind</span></span><span id="textcolor9731"><span 
class="aett-10x-x-109">(imat,</span><span 
class="aett-10x-x-109">&#x00A0;lmat.c)</span></span>
</div>
</div>
   </div>
<!--l. 627--><p class="indent" >   The data stack is  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
                                                                                 
                                                                                 
<div class="obeylines-v">
<span id="textcolor9732"><span 
class="aett-10x-x-109">stk.pp.c</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9733"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9734"><span 
class="aett-10x-x-109">inla.stack</span></span><span id="textcolor9735"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9736"><span 
class="aett-10x-x-109">data</span></span><span id="textcolor9737"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9738"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9739"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9740"><span 
class="aett-10x-x-109">y</span></span><span id="textcolor9741"><span 
class="aett-10x-x-109">=y.pp.c,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9742"><span 
class="aett-10x-x-109">e</span></span><span id="textcolor9743"><span 
class="aett-10x-x-109">=e.pp.c),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9744"><span 
class="aett-10x-x-109">A</span></span><span id="textcolor9745"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9746"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9747"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9748"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9749"><span 
class="aett-10x-x-109">,</span><span 
class="aett-10x-x-109">&#x00A0;A.pp.c),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9750"><span 
class="aett-10x-x-109">tag</span></span><span id="textcolor9751"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9752"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">pp.c</span><span 
class="tctt-1095">'</span></span><span id="textcolor9753"><span 
class="aett-10x-x-109">,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9754"><span 
class="aett-10x-x-109">effects</span></span><span id="textcolor9755"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9756"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9757"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9758"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9759"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9760"><span 
class="aett-10x-x-109">b0</span></span><span id="textcolor9761"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9762"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9763"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9764"><span 
class="aett-10x-x-109">covariate</span></span><span id="textcolor9765"><span 
class="aett-10x-x-109">=covariate),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9766"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9767"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9768"><span 
class="aett-10x-x-109">i</span></span><span id="textcolor9769"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9770"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9771"><span 
class="aett-10x-x-109">:</span></span><span id="textcolor9772"><span 
class="aett-10x-x-109">nv)))</span></span>
</div>
</div>
   </div>
<!--l. 639--><p class="indent" >   The model is fitted by  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9773"><span 
class="aett-10x-x-109">pp.c.res</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9774"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9775"><span 
class="aett-10x-x-109">inla</span></span><span id="textcolor9776"><span 
class="aett-10x-x-109">(y</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9777"><span 
class="aett-10x-x-109">~</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9778"><span 
class="aett-10x-x-109">0</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9779"><span 
class="aett-10x-x-109">+</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9780"><span 
class="aett-10x-x-109">b0</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9781"><span 
class="aett-10x-x-109">+</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9782"><span 
class="aett-10x-x-109">covariate</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9783"><span 
class="aett-10x-x-109">+</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9784"><span 
class="aett-10x-x-109">f</span></span><span id="textcolor9785"><span 
class="aett-10x-x-109">(i,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9786"><span 
class="aett-10x-x-109">model</span></span><span id="textcolor9787"><span 
class="aett-10x-x-109">=spde),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9788"><span 
class="aett-10x-x-109">family</span></span><span id="textcolor9789"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9790"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">poisson</span><span 
class="tctt-1095">'</span></span><span id="textcolor9791"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9792"><span 
class="aett-10x-x-109">data</span></span><span id="textcolor9793"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9794"><span 
class="aett-10x-x-109">inla.stack.data</span></span><span id="textcolor9795"><span 
class="aett-10x-x-109">(stk.pp.c),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9796"><span 
class="aett-10x-x-109">control.predictor</span></span><span id="textcolor9797"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9798"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor9799"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9800"><span 
class="aett-10x-x-109">A</span></span><span id="textcolor9801"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9802"><span 
class="aett-10x-x-109">inla.stack.A</span></span><span id="textcolor9803"><span 
class="aett-10x-x-109">(stk.pp.c)),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9804"><span 
class="aett-10x-x-109">E</span></span><span id="textcolor9805"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9806"><span 
class="aett-10x-x-109">inla.stack.data</span></span><span id="textcolor9807"><span 
class="aett-10x-x-109">(stk.pp.c)</span></span><span id="textcolor9808"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9809"><span 
class="aett-10x-x-109">e)</span></span>
</div>
</div>
<!--l. 650--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in inla.inlaprogram.has.crashed(): The inla-program exited with an</span>
<span 
class="aett-10x-x-109">error. Unless you interupted it yourself, please rerun with verbose=TRUE and</span>
<span 
class="aett-10x-x-109">check the output carefully.</span><br 
class="newline" /><span 
class="aett-10x-x-109">##</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;If this does not help, please contact the developers at &#x003C;help@r-inla.org&#x003E;.</span>
</p>
   </div>
<!--l. 653--><p class="indent" >   Summary of the model parameters  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9810"><span 
class="aett-10x-x-109">round</span></span><span id="textcolor9811"><span 
class="aett-10x-x-109">(pp.c.res</span></span><span id="textcolor9812"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9813"><span 
class="aett-10x-x-109">summary.hyperpar,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9814"><span 
class="aett-10x-x-109">4</span></span><span id="textcolor9815"><span 
class="aett-10x-x-109">)</span></span>
</div>
</div>
<!--l. 661--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in eval(expr, envir, enclos): object &#8217;pp.c.res&#8217; not found</span>
</p>
   </div>
<!--l. 664--><p class="indent" >   The posterior distribution of the log-Cox model parameters are visualized on the
Figure&#x00A0;<a 
href="#x8-760004.2.2">4.2.2<!--tex4ht:ref: fig:pppostc --></a>.
</p>
   <div class="framedenv" id="kframe-1">
   <div class="alltt">
                                                                                 
                                                                                 
<div class="obeylines-v">
<span id="textcolor9816"><span 
class="aett-10x-x-109">par</span></span><span id="textcolor9817"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9818"><span 
class="aett-10x-x-109">mfrow</span></span><span id="textcolor9819"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9820"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9821"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9822"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9823"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9824"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9825"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9826"><span 
class="aett-10x-x-109">mar</span></span><span id="textcolor9827"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9828"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9829"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9830"><span 
class="aett-10x-x-109">3</span></span><span id="textcolor9831"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9832"><span 
class="aett-10x-x-109">3</span></span><span id="textcolor9833"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9834"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9835"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9836"><span 
class="aett-10x-x-109">0.3</span></span><span id="textcolor9837"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9838"><span 
class="aett-10x-x-109">mgp</span></span><span id="textcolor9839"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9840"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor9841"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9842"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9843"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9844"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9845"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor9846"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9847"><span 
class="aett-10x-x-109">))</span></span>
<br /><span id="textcolor9848"><span 
class="aett-10x-x-109">plot</span></span><span id="textcolor9849"><span 
class="aett-10x-x-109">(pp.c.res</span></span><span id="textcolor9850"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9851"><span 
class="aett-10x-x-109">marginals.fix[[</span></span><span id="textcolor9852"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9853"><span 
class="aett-10x-x-109">]],</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9854"><span 
class="aett-10x-x-109">type</span></span><span id="textcolor9855"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9856"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">l</span><span 
class="tctt-1095">'</span></span><span id="textcolor9857"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9858"><span 
class="aett-10x-x-109">ylab</span></span><span id="textcolor9859"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9860"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">Density</span><span 
class="tctt-1095">'</span></span><span id="textcolor9861"><span 
class="aett-10x-x-109">,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9862"><span 
class="aett-10x-x-109">xlab</span></span><span id="textcolor9863"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9864"><span 
class="aett-10x-x-109">expression</span></span><span id="textcolor9865"><span 
class="aett-10x-x-109">(beta[</span></span><span id="textcolor9866"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor9867"><span 
class="aett-10x-x-109">]));</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9868"><span 
class="aett-10x-x-109">abline</span></span><span id="textcolor9869"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9870"><span 
class="aett-10x-x-109">v</span></span><span id="textcolor9871"><span 
class="aett-10x-x-109">=beta0,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9872"><span 
class="aett-10x-x-109">col</span></span><span id="textcolor9873"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9874"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9875"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9876"><span 
class="aett-10x-x-109">plot</span></span><span id="textcolor9877"><span 
class="aett-10x-x-109">(pp.c.res</span></span><span id="textcolor9878"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9879"><span 
class="aett-10x-x-109">marginals.fix[[</span></span><span id="textcolor9880"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9881"><span 
class="aett-10x-x-109">]],</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9882"><span 
class="aett-10x-x-109">type</span></span><span id="textcolor9883"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9884"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">l</span><span 
class="tctt-1095">'</span></span><span id="textcolor9885"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9886"><span 
class="aett-10x-x-109">ylab</span></span><span id="textcolor9887"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9888"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">Density</span><span 
class="tctt-1095">'</span></span><span id="textcolor9889"><span 
class="aett-10x-x-109">,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9890"><span 
class="aett-10x-x-109">xlab</span></span><span id="textcolor9891"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9892"><span 
class="aett-10x-x-109">expression</span></span><span id="textcolor9893"><span 
class="aett-10x-x-109">(beta[</span></span><span id="textcolor9894"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9895"><span 
class="aett-10x-x-109">]));</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9896"><span 
class="aett-10x-x-109">abline</span></span><span id="textcolor9897"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9898"><span 
class="aett-10x-x-109">v</span></span><span id="textcolor9899"><span 
class="aett-10x-x-109">=beta1,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9900"><span 
class="aett-10x-x-109">col</span></span><span id="textcolor9901"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9902"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9903"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9904"><span 
class="aett-10x-x-109">plot</span></span><span id="textcolor9905"><span 
class="aett-10x-x-109">(pp.c.res</span></span><span id="textcolor9906"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9907"><span 
class="aett-10x-x-109">marginals.hyperpar[[</span></span><span id="textcolor9908"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9909"><span 
class="aett-10x-x-109">]],</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9910"><span 
class="aett-10x-x-109">type</span></span><span id="textcolor9911"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9912"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">l</span><span 
class="tctt-1095">'</span></span><span id="textcolor9913"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9914"><span 
class="aett-10x-x-109">ylab</span></span><span id="textcolor9915"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9916"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">Density</span><span 
class="tctt-1095">'</span></span><span id="textcolor9917"><span 
class="aett-10x-x-109">,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9918"><span 
class="aett-10x-x-109">xlab</span></span><span id="textcolor9919"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9920"><span 
class="aett-10x-x-109">expression</span></span><span id="textcolor9921"><span 
class="aett-10x-x-109">(sigma));</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9922"><span 
class="aett-10x-x-109">abline</span></span><span id="textcolor9923"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9924"><span 
class="aett-10x-x-109">v</span></span><span id="textcolor9925"><span 
class="aett-10x-x-109">=sigma2x</span></span><span id="textcolor9926"><span 
class="aett-10x-x-109">^</span></span><span id="textcolor9927"><span 
class="aett-10x-x-109">0.5</span></span><span id="textcolor9928"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9929"><span 
class="aett-10x-x-109">col</span></span><span id="textcolor9930"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9931"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9932"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9933"><span 
class="aett-10x-x-109">plot</span></span><span id="textcolor9934"><span 
class="aett-10x-x-109">(pp.c.res</span></span><span id="textcolor9935"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9936"><span 
class="aett-10x-x-109">marginals.hyperpar[[</span></span><span id="textcolor9937"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9938"><span 
class="aett-10x-x-109">]],</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9939"><span 
class="aett-10x-x-109">type</span></span><span id="textcolor9940"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9941"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">l</span><span 
class="tctt-1095">'</span></span><span id="textcolor9942"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9943"><span 
class="aett-10x-x-109">ylab</span></span><span id="textcolor9944"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9945"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">Density</span><span 
class="tctt-1095">'</span></span><span id="textcolor9946"><span 
class="aett-10x-x-109">,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9947"><span 
class="aett-10x-x-109">xlab</span></span><span id="textcolor9948"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9949"><span 
class="aett-10x-x-109">expression</span></span><span id="textcolor9950"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9951"><span 
class="aett-10x-x-109">sqrt</span></span><span id="textcolor9952"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9953"><span 
class="aett-10x-x-109">8</span></span><span id="textcolor9954"><span 
class="aett-10x-x-109">)</span></span><span id="textcolor9955"><span 
class="aett-10x-x-109">/</span></span><span id="textcolor9956"><span 
class="aett-10x-x-109">kappa));</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9957"><span 
class="aett-10x-x-109">abline</span></span><span id="textcolor9958"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9959"><span 
class="aett-10x-x-109">v</span></span><span id="textcolor9960"><span 
class="aett-10x-x-109">=kappa,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9961"><span 
class="aett-10x-x-109">col</span></span><span id="textcolor9962"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor9963"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9964"><span 
class="aett-10x-x-109">)</span></span>
</div>
</div>
   </div>
<hr class="figure" /><div class="figure" 
>
                                                                                 
                                                                                 
<a 
 id="x8-760016"></a>
                                                                                 
                                                                                 
<div class="framedenv" id="kframe-1">
<!--l. 688--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in plot(pp.c.res$marginals.fix[[1]], type = "l", ylab = "Density", :</span>
<span 
class="aett-10x-x-109">object &#8217;pp.c.res&#8217; not found</span>
</p><!--l. 690--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p><!--l. 692--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in plot(pp.c.res$marginals.fix[[2]], type = "l", ylab = "Density", :</span>
<span 
class="aett-10x-x-109">object &#8217;pp.c.res&#8217; not found</span>
</p><!--l. 694--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p><!--l. 696--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in plot(pp.c.res$marginals.hyperpar[[2]], type = "l", ylab = "Density",</span>
<span 
class="aett-10x-x-109">: object &#8217;pp.c.res&#8217; not found</span>
</p><!--l. 698--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p><!--l. 700--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in plot(pp.c.res$marginals.hyperpar[[1]], type = "l", ylab = "Density",</span>
<span 
class="aett-10x-x-109">: object &#8217;pp.c.res&#8217; not found</span>
</p><!--l. 702--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p>
</div>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;4.6: </span><span  
class="content">Posterior distribution for the intercept (top left), coefficient of the covariate
(top right) and the parameters of the log-Cox model <span 
class="cmmi-10x-x-109">&#x03C3;</span><sup><span 
class="cmr-8">2</span></sup> (bottom left), <span 
class="cmmi-10x-x-109">&#x03BA; </span>(bottom right)</span></div><!--tex4ht:label?: x8-760016 -->
                                                                                 
                                                                                 
   </div><hr class="endfigure" />
   <h3 class="sectionHead"><span class="titlemark">4.3   </span> <a 
 id="x8-770004.3"></a>Geostatistical inference under preferential sampling</h3>
<!--l. 712--><p class="noindent" >In some cases the effort on sampling depends on the response. For example, is more common to
have stations collecting data about pollution on industrial area than on rural ones. To make
inference in this case, we can test if we have a preferential sampling problem in our data. One
approach is to build a joint model considering a log-Cox model for the point pattern (the
locations) and the response, <span class="cite">[<a 
href="spde-tutorialli2.html#Xdiggleetal:2010">Diggle et&#x00A0;al., 2010</a>]</span>. So, we need also to make inference for a point
process model jointly.
</p><!--l. 723--><p class="indent" >   This approach assumes a linear predictor for the point process as
</p>
   <center class="math-display" >
<img 
src="spde-tutorial63x.png" alt="&#x03B2;0 + random  field
" class="math-display"  /></center>
<!--l. 724--><p class="nopar" > and for the observations a linear predictor which is function of the latent Gaussian random field
for the point process
</p>
   <center class="math-display" >
<img 
src="spde-tutorial64x.png" alt=" y
&#x03B2;0 + &#x03B2;random field
" class="math-display"  /></center>
<!--l. 727--><p class="nopar" > where <span 
class="cmmi-10x-x-109">&#x03B2;</span><sub><span 
class="cmr-8">0</span></sub><sup><span 
class="cmmi-8">y</span></sup> is an intercept for the observations and <span 
class="cmmi-10x-x-109">&#x03B2; </span>is a sharing parameter.
</p><!--l. 731--><p class="indent" >   An illustration of the use <span 
class="aessbx-10x-x-109">INLA </span>for the preferential sampling problem is on the case studies section
of the <span 
class="aessbx-10x-x-109">INLA </span>web page, precisely on <a 
href="http://www.r-inla.org/examples/case-studies/diggle09" class="url" ><span 
class="aett-10x-x-109">http://www.r-inla.org/examples/case-studies/diggle09</span></a>.
This example uses the two dimentional random walk model for the latent random field. Here, we
show geoestatistical inference under preferencial sampling using SPDE.
</p><!--l. 740--><p class="indent" >   We now will use the values of the latent GRF considered in the simulation of the point
process to define an outcome at the location points. We just take the values of closest grid
centers to each location of the point pattern. The values of the LGRF is collected (and a
summary) at closest grid centers with  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9965"><span 
class="aett-10x-x-109">summary</span></span><span id="textcolor9966"><span 
class="aett-10x-x-109">(z</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9967"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9968"><span 
class="aett-10x-x-109">log</span></span><span id="textcolor9969"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9970"><span 
class="aett-10x-x-109">t</span></span><span id="textcolor9971"><span 
class="aett-10x-x-109">(Lam</span></span><span id="textcolor9972"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor9973"><span 
class="aett-10x-x-109">v)[</span></span><span id="textcolor9974"><span 
class="aett-10x-x-109">Reduce</span></span><span id="textcolor9975"><span 
class="aett-10x-x-109">(</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9976"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">cbind</span><span 
class="tctt-1095">'</span></span><span id="textcolor9977"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9978"><span 
class="aett-10x-x-109">nearest.pixel</span></span><span id="textcolor9979"><span 
class="aett-10x-x-109">(xy[,</span></span><span id="textcolor9980"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor9981"><span 
class="aett-10x-x-109">],</span><span 
class="aett-10x-x-109">&#x00A0;xy[,</span></span><span id="textcolor9982"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9983"><span 
class="aett-10x-x-109">],</span><span 
class="aett-10x-x-109">&#x00A0;Lam))]))</span></span>
</div>
</div>
                                                                                 
                                                                                 
   <div class="verbatim" id="verbatim-80">
##&#x00A0;&#x00A0;&#x00A0;&#x00A0;Min.&#x00A0;1st&#x00A0;Qu.&#x00A0;&#x00A0;Median&#x00A0;&#x00A0;&#x00A0;&#x00A0;Mean&#x00A0;3rd&#x00A0;Qu.&#x00A0;&#x00A0;&#x00A0;&#x00A0;Max.
&#x00A0;<br />##&#x00A0;&#x00A0;&#x00A0;2.528&#x00A0;&#x00A0;&#x00A0;2.960&#x00A0;&#x00A0;&#x00A0;3.244&#x00A0;&#x00A0;&#x00A0;3.250&#x00A0;&#x00A0;&#x00A0;3.487&#x00A0;&#x00A0;&#x00A0;4.388
</div>
<!--l. 756--><p class="nopar" >
</p>
   </div>
<!--l. 760--><p class="indent" >   These values are the latent field with zero mean plus the defined intercept. We define the
response as a different intercept <span 
class="cmmi-10x-x-109">&#x03B2;</span><sub><span 
class="cmmi-8">y</span></sub> and multiply the zero mean random field with a <span 
class="cmr-10x-x-109">1</span><span 
class="cmmi-10x-x-109">&#x2215;&#x03B2;</span>, where
<span 
class="cmmi-10x-x-109">&#x03B2; </span>is the parameter as the sharing parameter between the intensity of the point process locations
and the response.  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor9984"><span 
class="aett-10x-x-109">beta0.y</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9985"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9986"><span 
class="aett-10x-x-109">10</span></span><span id="textcolor9987"><span 
class="aett-10x-x-109">;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;beta</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9988"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9989"><span 
class="aett-10x-x-109">-</span></span><span id="textcolor9990"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9991"><span 
class="aett-10x-x-109">;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;prec.y</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9992"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor9993"><span 
class="aett-10x-x-109">16</span></span>
<br /><span id="textcolor9994"><span 
class="aett-10x-x-109">set.seed</span></span><span id="textcolor9995"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor9996"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor9997"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor9998"><span 
class="aett-10x-x-109">summary</span></span><span id="textcolor9999"><span 
class="aett-10x-x-109">(resp</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10000"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10001"><span 
class="aett-10x-x-109">beta0.y</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10002"><span 
class="aett-10x-x-109">+</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10003"><span 
class="aett-10x-x-109">(z</span></span><span id="textcolor10004"><span 
class="aett-10x-x-109">-</span></span><span id="textcolor10005"><span 
class="aett-10x-x-109">beta0)</span></span><span id="textcolor10006"><span 
class="aett-10x-x-109">/</span></span><span id="textcolor10007"><span 
class="aett-10x-x-109">beta</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10008"><span 
class="aett-10x-x-109">+</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10009"><span 
class="aett-10x-x-109">rnorm</span></span><span id="textcolor10010"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10011"><span 
class="aett-10x-x-109">length</span></span><span id="textcolor10012"><span 
class="aett-10x-x-109">(z),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10013"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor10014"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10015"><span 
class="aett-10x-x-109">sqrt</span></span><span id="textcolor10016"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10017"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10018"><span 
class="aett-10x-x-109">/</span></span><span id="textcolor10019"><span 
class="aett-10x-x-109">prec.y)))</span></span>
</div>
</div>
                                                                                 
                                                                                 
   <div class="verbatim" id="verbatim-81">
##&#x00A0;&#x00A0;&#x00A0;&#x00A0;Min.&#x00A0;1st&#x00A0;Qu.&#x00A0;&#x00A0;Median&#x00A0;&#x00A0;&#x00A0;&#x00A0;Mean&#x00A0;3rd&#x00A0;Qu.&#x00A0;&#x00A0;&#x00A0;&#x00A0;Max.
&#x00A0;<br />##&#x00A0;&#x00A0;&#x00A0;8.969&#x00A0;&#x00A0;&#x00A0;9.616&#x00A0;&#x00A0;&#x00A0;9.898&#x00A0;&#x00A0;&#x00A0;9.878&#x00A0;&#x00A0;10.105&#x00A0;&#x00A0;10.585
</div>
<!--l. 776--><p class="nopar" >
</p>
   </div>
Considering <span 
class="cmmi-10x-x-109">&#x03B2; &#x003C; </span><span 
class="cmr-10x-x-109">0</span>, it means that the response values is inversly proportional to the point
process density.
<!--l. 783--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">4.3.1   </span> <a 
 id="x8-780004.3.1"></a>Fitting the usual model</h4>
<!--l. 785--><p class="noindent" >Here, we just fit the geoestatistical model using the usual approach. In this approach we just use
the locations as fixed. We use the mesh of the previous Chapter.
</p>
   <div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor10020"><span 
class="aett-10x-x-109">stk.u</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10021"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10022"><span 
class="aett-10x-x-109">inla.stack</span></span><span id="textcolor10023"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10024"><span 
class="aett-10x-x-109">data</span></span><span id="textcolor10025"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10026"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor10027"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10028"><span 
class="aett-10x-x-109">y</span></span><span id="textcolor10029"><span 
class="aett-10x-x-109">=resp),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10030"><span 
class="aett-10x-x-109">A</span></span><span id="textcolor10031"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10032"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor10033"><span 
class="aett-10x-x-109">(lmat,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10034"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10035"><span 
class="aett-10x-x-109">),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10036"><span 
class="aett-10x-x-109">effects</span></span><span id="textcolor10037"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10038"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor10039"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10040"><span 
class="aett-10x-x-109">i</span></span><span id="textcolor10041"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10042"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10043"><span 
class="aett-10x-x-109">:</span></span><span id="textcolor10044"><span 
class="aett-10x-x-109">nv,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10045"><span 
class="aett-10x-x-109">b0</span></span><span id="textcolor10046"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10047"><span 
class="aett-10x-x-109">rep</span></span><span id="textcolor10048"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10049"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10050"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor10051"><span 
class="aett-10x-x-109">length</span></span><span id="textcolor10052"><span 
class="aett-10x-x-109">(resp))))</span></span>
<br /><span id="textcolor10053"><span 
class="aett-10x-x-109">u.res</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10054"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10055"><span 
class="aett-10x-x-109">inla</span></span><span id="textcolor10056"><span 
class="aett-10x-x-109">(y</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10057"><span 
class="aett-10x-x-109">~</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10058"><span 
class="aett-10x-x-109">0</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10059"><span 
class="aett-10x-x-109">+</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10060"><span 
class="aett-10x-x-109">b0</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10061"><span 
class="aett-10x-x-109">+</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10062"><span 
class="aett-10x-x-109">f</span></span><span id="textcolor10063"><span 
class="aett-10x-x-109">(i,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10064"><span 
class="aett-10x-x-109">model</span></span><span id="textcolor10065"><span 
class="aett-10x-x-109">=spde),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10066"><span 
class="aett-10x-x-109">data</span></span><span id="textcolor10067"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10068"><span 
class="aett-10x-x-109">inla.stack.data</span></span><span id="textcolor10069"><span 
class="aett-10x-x-109">(stk.u),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10070"><span 
class="aett-10x-x-109">control.predictor</span></span><span id="textcolor10071"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10072"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor10073"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10074"><span 
class="aett-10x-x-109">A</span></span><span id="textcolor10075"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10076"><span 
class="aett-10x-x-109">inla.stack.A</span></span><span id="textcolor10077"><span 
class="aett-10x-x-109">(stk.u)))</span></span>
</div>
</div>
<!--l. 800--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in inla.inlaprogram.has.crashed(): The inla-program exited with an</span>
<span 
class="aett-10x-x-109">error. Unless you interupted it yourself, please rerun with verbose=TRUE and</span>
<span 
class="aett-10x-x-109">check the output carefully.</span><br 
class="newline" /><span 
class="aett-10x-x-109">##</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;If this does not help, please contact the developers at &#x003C;help@r-inla.org&#x003E;.</span></p><div class="alltt">
<div class="obeylines-v">
<span id="textcolor10078"><span 
class="aett-10x-x-109">round</span></span><span id="textcolor10079"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10080"><span 
class="aett-10x-x-109">cbind</span></span><span id="textcolor10081"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10082"><span 
class="aett-10x-x-109">True</span></span><span id="textcolor10083"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10084"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor10085"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10086"><span 
class="aett-10x-x-109">beta0y</span></span><span id="textcolor10087"><span 
class="aett-10x-x-109">=beta0.y,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10088"><span 
class="aett-10x-x-109">prec.y</span></span><span id="textcolor10089"><span 
class="aett-10x-x-109">=prec.y),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10090"><span 
class="aett-10x-x-109">rbind</span></span><span id="textcolor10091"><span 
class="aett-10x-x-109">(u.res</span></span><span id="textcolor10092"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor10093"><span 
class="aett-10x-x-109">summary.fix[,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10094"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10095"><span 
class="aett-10x-x-109">:</span></span><span id="textcolor10096"><span 
class="aett-10x-x-109">6</span></span><span id="textcolor10097"><span 
class="aett-10x-x-109">],</span><span 
class="aett-10x-x-109">&#x00A0;u.res</span></span><span id="textcolor10098"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor10099"><span 
class="aett-10x-x-109">summary.hy[</span></span><span id="textcolor10100"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10101"><span 
class="aett-10x-x-109">,])),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10102"><span 
class="aett-10x-x-109">4</span></span><span id="textcolor10103"><span 
class="aett-10x-x-109">)</span></span>
</div>
</div>
<!--l. 806--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in rbind(u.res$summary.fix[, 1:6], u.res$summary.hy[1, ]): object</span>
<span 
class="aett-10x-x-109">&#8217;u.res&#8217; not found</span>
</p>
   </div>
<!--l. 809--><p class="indent" >   We can see the posterior distribution marginals for the model parameters in the
Figure&#x00A0;<a 
href="#x8-780004.3.1">4.3.1<!--tex4ht:ref: fig:upost --></a>, produced with the following code  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
                                                                                 
                                                                                 
<div class="obeylines-v">
<span id="textcolor10104"><span 
class="aett-10x-x-109">par</span></span><span id="textcolor10105"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10106"><span 
class="aett-10x-x-109">mfrow</span></span><span id="textcolor10107"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10108"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor10109"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10110"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10111"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor10112"><span 
class="aett-10x-x-109">3</span></span><span id="textcolor10113"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10114"><span 
class="aett-10x-x-109">mar</span></span><span id="textcolor10115"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10116"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor10117"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10118"><span 
class="aett-10x-x-109">3</span></span><span id="textcolor10119"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10120"><span 
class="aett-10x-x-109">3</span></span><span id="textcolor10121"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10122"><span 
class="aett-10x-x-109">0.3</span></span><span id="textcolor10123"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10124"><span 
class="aett-10x-x-109">0.3</span></span><span id="textcolor10125"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10126"><span 
class="aett-10x-x-109">mgp</span></span><span id="textcolor10127"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10128"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor10129"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10130"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor10131"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor10132"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10133"><span 
class="aett-10x-x-109">,</span></span><span id="textcolor10134"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor10135"><span 
class="aett-10x-x-109">))</span></span>
<br /><span id="textcolor10136"><span 
class="aett-10x-x-109">plot</span></span><span id="textcolor10137"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10138"><span 
class="aett-10x-x-109">inla.tmarginal</span></span><span id="textcolor10139"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10140"><span 
class="aett-10x-x-109">function</span></span><span id="textcolor10141"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10142"><span 
class="aett-10x-x-109">x</span></span><span id="textcolor10143"><span 
class="aett-10x-x-109">)</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10144"><span 
class="aett-10x-x-109">sqrt</span></span><span id="textcolor10145"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10146"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10147"><span 
class="aett-10x-x-109">/</span></span><span id="textcolor10148"><span 
class="aett-10x-x-109">x),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10149"><span 
class="aett-10x-x-109">u.res</span></span><span id="textcolor10150"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor10151"><span 
class="aett-10x-x-109">marginals.hyperpar[[</span></span><span id="textcolor10152"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10153"><span 
class="aett-10x-x-109">]]),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10154"><span 
class="aett-10x-x-109">type</span></span><span id="textcolor10155"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10156"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">l</span><span 
class="tctt-1095">'</span></span><span id="textcolor10157"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10158"><span 
class="aett-10x-x-109">ylab</span></span><span id="textcolor10159"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10160"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">Density</span><span 
class="tctt-1095">'</span></span><span id="textcolor10161"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10162"><span 
class="aett-10x-x-109">xlab</span></span><span id="textcolor10163"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10164"><span 
class="aett-10x-x-109">expression</span></span><span id="textcolor10165"><span 
class="aett-10x-x-109">(sigma))</span></span>
<br /><span id="textcolor10166"><span 
class="aett-10x-x-109">abline</span></span><span id="textcolor10167"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10168"><span 
class="aett-10x-x-109">v</span></span><span id="textcolor10169"><span 
class="aett-10x-x-109">=prec.y</span></span><span id="textcolor10170"><span 
class="aett-10x-x-109">^-</span></span><span id="textcolor10171"><span 
class="aett-10x-x-109">0.5</span></span><span id="textcolor10172"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10173"><span 
class="aett-10x-x-109">col</span></span><span id="textcolor10174"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10175"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor10176"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor10177"><span 
class="aett-10x-x-109">plot</span></span><span id="textcolor10178"><span 
class="aett-10x-x-109">(u.res</span></span><span id="textcolor10179"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor10180"><span 
class="aett-10x-x-109">marginals.hyperpar[[</span></span><span id="textcolor10181"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor10182"><span 
class="aett-10x-x-109">]],</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10183"><span 
class="aett-10x-x-109">type</span></span><span id="textcolor10184"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10185"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">l</span><span 
class="tctt-1095">'</span></span><span id="textcolor10186"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10187"><span 
class="aett-10x-x-109">ylab</span></span><span id="textcolor10188"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10189"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">Density</span><span 
class="tctt-1095">'</span></span><span id="textcolor10190"><span 
class="aett-10x-x-109">,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10191"><span 
class="aett-10x-x-109">xlab</span></span><span id="textcolor10192"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10193"><span 
class="aett-10x-x-109">expression</span></span><span id="textcolor10194"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10195"><span 
class="aett-10x-x-109">sqrt</span></span><span id="textcolor10196"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10197"><span 
class="aett-10x-x-109">8</span></span><span id="textcolor10198"><span 
class="aett-10x-x-109">)</span></span><span id="textcolor10199"><span 
class="aett-10x-x-109">/</span></span><span id="textcolor10200"><span 
class="aett-10x-x-109">kappa));</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10201"><span 
class="aett-10x-x-109">abline</span></span><span id="textcolor10202"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10203"><span 
class="aett-10x-x-109">v</span></span><span id="textcolor10204"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10205"><span 
class="aett-10x-x-109">sqrt</span></span><span id="textcolor10206"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10207"><span 
class="aett-10x-x-109">8</span></span><span id="textcolor10208"><span 
class="aett-10x-x-109">)</span></span><span id="textcolor10209"><span 
class="aett-10x-x-109">/</span></span><span id="textcolor10210"><span 
class="aett-10x-x-109">kappa,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10211"><span 
class="aett-10x-x-109">col</span></span><span id="textcolor10212"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10213"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor10214"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor10215"><span 
class="aett-10x-x-109">plot</span></span><span id="textcolor10216"><span 
class="aett-10x-x-109">(u.res</span></span><span id="textcolor10217"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor10218"><span 
class="aett-10x-x-109">marginals.hyperpar[[</span></span><span id="textcolor10219"><span 
class="aett-10x-x-109">3</span></span><span id="textcolor10220"><span 
class="aett-10x-x-109">]],</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10221"><span 
class="aett-10x-x-109">type</span></span><span id="textcolor10222"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10223"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">l</span><span 
class="tctt-1095">'</span></span><span id="textcolor10224"><span 
class="aett-10x-x-109">,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10225"><span 
class="aett-10x-x-109">xlab</span></span><span id="textcolor10226"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10227"><span 
class="aett-10x-x-109">expression</span></span><span id="textcolor10228"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10229"><span 
class="aett-10x-x-109">sqrt</span></span><span id="textcolor10230"><span 
class="aett-10x-x-109">(sigma</span></span><span id="textcolor10231"><span 
class="aett-10x-x-109">^</span></span><span id="textcolor10232"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor10233"><span 
class="aett-10x-x-109">[x])),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10234"><span 
class="aett-10x-x-109">ylab</span></span><span id="textcolor10235"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10236"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">Density</span><span 
class="tctt-1095">'</span></span><span id="textcolor10237"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor10238"><span 
class="aett-10x-x-109">abline</span></span><span id="textcolor10239"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10240"><span 
class="aett-10x-x-109">v</span></span><span id="textcolor10241"><span 
class="aett-10x-x-109">=sigma2x</span></span><span id="textcolor10242"><span 
class="aett-10x-x-109">^</span></span><span id="textcolor10243"><span 
class="aett-10x-x-109">0.5</span></span><span id="textcolor10244"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10245"><span 
class="aett-10x-x-109">col</span></span><span id="textcolor10246"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10247"><span 
class="aett-10x-x-109">2</span></span><span id="textcolor10248"><span 
class="aett-10x-x-109">)</span></span>
</div>
</div>
   </div>
<hr class="figure" /><div class="figure" 
>
                                                                                 
                                                                                 
<a 
 id="x8-780017"></a>
                                                                                 
                                                                                 
<div class="framedenv" id="kframe-1">
<!--l. 834--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in inla.tmarginal(function(x) sqrt(1/x), u.res$marginals.hyperpar[[1]]):</span>
<span 
class="aett-10x-x-109">object &#8217;u.res&#8217; not found</span>
</p><!--l. 836--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p><!--l. 838--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in plot(u.res$marginals.hyperpar[[2]], type = "l", ylab = "Density", :</span>
<span 
class="aett-10x-x-109">object &#8217;u.res&#8217; not found</span>
</p><!--l. 840--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p><!--l. 842--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in plot(u.res$marginals.hyperpar[[3]], type = "l", xlab =</span>
<span 
class="aett-10x-x-109">expression(sqrt(sigma^2[x])), : object &#8217;u.res&#8217; not found</span>
</p><!--l. 844--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p>
</div>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;4.7: </span><span  
class="content">Posterior distribution for <span 
class="cmmi-10x-x-109">&#x03C3;</span><sup><span 
class="cmr-8">2</span></sup>, <span 
class="cmmi-10x-x-109">&#x03BA; </span>and the nominal range just using the response.</span></div><!--tex4ht:label?: x8-780017 -->
                                                                                 
                                                                                 
   </div><hr class="endfigure" />
   <h4 class="subsectionHead"><span class="titlemark">4.3.2   </span> <a 
 id="x8-790004.3.2"></a>Model fitting under preferential sampling</h4>
<!--l. 852--><p class="noindent" >In this situation we fit the model where a LGRF is considered to model both point pattern and
the response. Using <span 
class="aessbx-10x-x-109">INLA </span>it can be done using two likelihoods, one for the point pattern and
another for the response. To do it we need a matrix response and a new index set to specify the
model for the LGRF. It is more easy by using the <span 
class="aett-10x-x-109">inla.stack() </span>following previous examples for
two likelihood models.
</p><!--l. 861--><p class="indent" >   We consider the point pattern &#8217;observation&#8217; on the first column and the response values on
the second column. So, we just redefine the stack for the response and also for the point process.
We put the response on the first column and the Poisson data for the point process as the
second column. Also, to avoid the expected number of cases as NA for the Poisson
likelihood, we set it as zero on the response data stack. For the SPDE effect on the point
process part we have to model it as a copy of the SPDE effect at response part. We do
it by defining a index set with different name and use it on the copy feature later.
</p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor10249"><span 
class="aett-10x-x-109">stk2.y</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10250"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10251"><span 
class="aett-10x-x-109">inla.stack</span></span><span id="textcolor10252"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10253"><span 
class="aett-10x-x-109">data</span></span><span id="textcolor10254"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10255"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor10256"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10257"><span 
class="aett-10x-x-109">y</span></span><span id="textcolor10258"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10259"><span 
class="aett-10x-x-109">cbind</span></span><span id="textcolor10260"><span 
class="aett-10x-x-109">(resp,</span></span><span id="textcolor10261"><span 
class="aett-10x-x-109">NA</span></span><span id="textcolor10262"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10263"><span 
class="aett-10x-x-109">e</span></span><span id="textcolor10264"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10265"><span 
class="aett-10x-x-109">rep</span></span><span id="textcolor10266"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10267"><span 
class="aett-10x-x-109">0</span></span><span id="textcolor10268"><span 
class="aett-10x-x-109">,n)),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10269"><span 
class="aett-10x-x-109">A</span></span><span id="textcolor10270"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10271"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor10272"><span 
class="aett-10x-x-109">(lmat,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10273"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10274"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10275"><span 
class="aett-10x-x-109">tag</span></span><span id="textcolor10276"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10277"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">resp2</span><span 
class="tctt-1095">'</span></span><span id="textcolor10278"><span 
class="aett-10x-x-109">,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10279"><span 
class="aett-10x-x-109">effects</span></span><span id="textcolor10280"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10281"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor10282"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10283"><span 
class="aett-10x-x-109">i</span></span><span id="textcolor10284"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10285"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10286"><span 
class="aett-10x-x-109">:</span></span><span id="textcolor10287"><span 
class="aett-10x-x-109">nv,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10288"><span 
class="aett-10x-x-109">b0.y</span></span><span id="textcolor10289"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10290"><span 
class="aett-10x-x-109">rep</span></span><span id="textcolor10291"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10292"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10293"><span 
class="aett-10x-x-109">,n)))</span></span>
<br /><span id="textcolor10294"><span 
class="aett-10x-x-109">stk2.pp</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10295"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10296"><span 
class="aett-10x-x-109">inla.stack</span></span><span id="textcolor10297"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10298"><span 
class="aett-10x-x-109">data</span></span><span id="textcolor10299"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10300"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor10301"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10302"><span 
class="aett-10x-x-109">y</span></span><span id="textcolor10303"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10304"><span 
class="aett-10x-x-109">cbind</span></span><span id="textcolor10305"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10306"><span 
class="aett-10x-x-109">NA</span></span><span id="textcolor10307"><span 
class="aett-10x-x-109">,y.pp),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10308"><span 
class="aett-10x-x-109">e</span></span><span id="textcolor10309"><span 
class="aett-10x-x-109">=e.pp),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10310"><span 
class="aett-10x-x-109">A</span></span><span id="textcolor10311"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10312"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor10313"><span 
class="aett-10x-x-109">(A.pp,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10314"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10315"><span 
class="aett-10x-x-109">),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10316"><span 
class="aett-10x-x-109">tag</span></span><span id="textcolor10317"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10318"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">pp2</span><span 
class="tctt-1095">'</span></span><span id="textcolor10319"><span 
class="aett-10x-x-109">,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10320"><span 
class="aett-10x-x-109">effects</span></span><span id="textcolor10321"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10322"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor10323"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10324"><span 
class="aett-10x-x-109">j</span></span><span id="textcolor10325"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10326"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10327"><span 
class="aett-10x-x-109">:</span></span><span id="textcolor10328"><span 
class="aett-10x-x-109">nv,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10329"><span 
class="aett-10x-x-109">b0.pp</span></span><span id="textcolor10330"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10331"><span 
class="aett-10x-x-109">rep</span></span><span id="textcolor10332"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10333"><span 
class="aett-10x-x-109">1</span></span><span id="textcolor10334"><span 
class="aett-10x-x-109">,nv</span></span><span id="textcolor10335"><span 
class="aett-10x-x-109">+</span></span><span id="textcolor10336"><span 
class="aett-10x-x-109">n)))</span></span>
<br /><span id="textcolor10337"><span 
class="aett-10x-x-109">j.stk</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10338"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10339"><span 
class="aett-10x-x-109">inla.stack</span></span><span id="textcolor10340"><span 
class="aett-10x-x-109">(stk2.y,</span><span 
class="aett-10x-x-109">&#x00A0;stk2.pp)</span></span>
</div>
</div>
   </div>
<!--l. 890--><p class="indent" >   Now, we fit the geostatistical model under preferential sampling. To put the LGRF on both
likelihood, we have to use the copy strategy.  </p><div class="framedenv" id="kframe-1">
   <div class="alltt">
<div class="obeylines-v">
<span id="textcolor10341"><span 
class="aett-10x-x-109">jform</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10342"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10343"><span 
class="aett-10x-x-109">y</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10344"><span 
class="aett-10x-x-109">~</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10345"><span 
class="aett-10x-x-109">0</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10346"><span 
class="aett-10x-x-109">+</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10347"><span 
class="aett-10x-x-109">b0.pp</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10348"><span 
class="aett-10x-x-109">+</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10349"><span 
class="aett-10x-x-109">b0.y</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10350"><span 
class="aett-10x-x-109">+</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10351"><span 
class="aett-10x-x-109">f</span></span><span id="textcolor10352"><span 
class="aett-10x-x-109">(i,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10353"><span 
class="aett-10x-x-109">model</span></span><span id="textcolor10354"><span 
class="aett-10x-x-109">=spde)</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10355"><span 
class="aett-10x-x-109">+</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10356"><span 
class="aett-10x-x-109">f</span></span><span id="textcolor10357"><span 
class="aett-10x-x-109">(j,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10358"><span 
class="aett-10x-x-109">copy</span></span><span id="textcolor10359"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10360"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">i</span><span 
class="tctt-1095">'</span></span><span id="textcolor10361"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10362"><span 
class="aett-10x-x-109">fixed</span></span><span id="textcolor10363"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10364"><span 
class="aett-10x-x-109">FALSE</span></span><span id="textcolor10365"><span 
class="aett-10x-x-109">)</span></span>
<br /><span id="textcolor10366"><span 
class="aett-10x-x-109">j.res</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10367"><span 
class="aett-10x-x-109">&#x003C;-</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10368"><span 
class="aett-10x-x-109">inla</span></span><span id="textcolor10369"><span 
class="aett-10x-x-109">(jform,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10370"><span 
class="aett-10x-x-109">family</span></span><span id="textcolor10371"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10372"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor10373"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10374"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">gaussian</span><span 
class="tctt-1095">'</span></span><span id="textcolor10375"><span 
class="aett-10x-x-109">,</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10376"><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">poisson</span><span 
class="tctt-1095">'</span></span><span id="textcolor10377"><span 
class="aett-10x-x-109">),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10378"><span 
class="aett-10x-x-109">data</span></span><span id="textcolor10379"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10380"><span 
class="aett-10x-x-109">inla.stack.data</span></span><span id="textcolor10381"><span 
class="aett-10x-x-109">(j.stk),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10382"><span 
class="aett-10x-x-109">E</span></span><span id="textcolor10383"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10384"><span 
class="aett-10x-x-109">inla.stack.data</span></span><span id="textcolor10385"><span 
class="aett-10x-x-109">(j.stk)</span></span><span id="textcolor10386"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor10387"><span 
class="aett-10x-x-109">e,</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10388"><span 
class="aett-10x-x-109">control.predictor</span></span><span id="textcolor10389"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10390"><span 
class="aett-10x-x-109">list</span></span><span id="textcolor10391"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10392"><span 
class="aett-10x-x-109">A</span></span><span id="textcolor10393"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10394"><span 
class="aett-10x-x-109">inla.stack.A</span></span><span id="textcolor10395"><span 
class="aett-10x-x-109">(j.stk)))</span></span>
</div>
</div>
<!--l. 904--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in inla.inlaprogram.has.crashed(): The inla-program exited with an</span>
<span 
class="aett-10x-x-109">error. Unless you interupted it yourself, please rerun with verbose=TRUE and</span>
<span 
class="aett-10x-x-109">check the output carefully.</span><br 
class="newline" /><span 
class="aett-10x-x-109">##</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;If this does not help, please contact the developers at &#x003C;help@r-inla.org&#x003E;.</span></p><div class="alltt">
                                                                                 
                                                                                 
<div class="obeylines-v">
<span id="textcolor10396"><span 
class="aett-10x-x-109">round</span></span><span id="textcolor10397"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10398"><span 
class="aett-10x-x-109">cbind</span></span><span id="textcolor10399"><span 
class="aett-10x-x-109">(</span></span><span id="textcolor10400"><span 
class="aett-10x-x-109">True</span></span><span id="textcolor10401"><span 
class="aett-10x-x-109">=</span></span><span id="textcolor10402"><span 
class="aett-10x-x-109">c</span></span><span id="textcolor10403"><span 
class="aett-10x-x-109">(beta0,</span><span 
class="aett-10x-x-109">&#x00A0;beta0.y),</span></span>
<br /><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10404"><span 
class="aett-10x-x-109">j.res</span></span><span id="textcolor10405"><span 
class="aett-10x-x-109">$</span></span><span id="textcolor10406"><span 
class="aett-10x-x-109">summary.fix),</span></span><span 
class="aett-10x-x-109">&#x00A0;</span><span id="textcolor10407"><span 
class="aett-10x-x-109">4</span></span><span id="textcolor10408"><span 
class="aett-10x-x-109">)</span></span>
</div>
</div>
<!--l. 910--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in cbind(True = c(beta0, beta0.y), j.res$summary.fix): object &#8217;j.res&#8217;</span>
<span 
class="aett-10x-x-109">not found</span>
</p>
   </div>
<!--l. 913--><p class="indent" >   We can visualize the posterior marginal distributions for the model parameters from the
result considering only the point process (PP), only the observations/marks (<span 
class="cmbx-10x-x-109">Y</span>) and jointly in
Figure&#x00A0;<a 
href="#x8-790004.3.2">4.3.2<!--tex4ht:ref: fig:jpars --></a>. Notice that for the <span 
class="cmmi-10x-x-109">&#x03B2;</span><sub><span 
class="cmr-8">0</span></sub> parameter we only have results considering only the PP and
joint, for <span 
class="cmmi-10x-x-109">&#x03B2;</span><sub><span 
class="cmmi-8">o</span></sub><sup><span 
class="cmmi-8">y</span></sup> we only have results considering only <span 
class="cmbx-10x-x-109">Y </span>and joint, and for <span 
class="cmmi-10x-x-109">&#x03B2; </span>(fitted using copy) we
only have result from the joint model. Only for the random field parameters we do have results
from the three results.
</p>
   <hr class="figure" /><div class="figure" 
>
                                                                                 
                                                                                 
<a 
 id="x8-790018"></a>
                                                                                 
                                                                                 
<div class="framedenv" id="kframe-1">
<!--l. 932--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in plot(j.res$marginals.fix[[1]], type = "l", ylab = "Density", :</span>
<span 
class="aett-10x-x-109">object &#8217;j.res&#8217; not found</span>
</p><!--l. 934--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in lines(pp.res$marginals.fix[[1]], lty = 2, lwd = 2): object &#8217;pp.res&#8217;</span>
<span 
class="aett-10x-x-109">not found</span>
</p><!--l. 936--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p><!--l. 938--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in plot(j.res$marginals.fix[[2]], type = "l", ylab = "Density", :</span>
<span 
class="aett-10x-x-109">object &#8217;j.res&#8217; not found</span>
</p><!--l. 940--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in lines(u.res$marginals.fix[[1]], lty = 3, lwd = 5): object &#8217;u.res&#8217;</span>
<span 
class="aett-10x-x-109">not found</span>
</p><!--l. 942--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p><!--l. 944--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in inla.tmarginal(function(x) 1/x, j.res$marginals.hy[[1]]): object</span>
<span 
class="aett-10x-x-109">&#8217;j.res&#8217; not found</span>
</p><!--l. 946--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in inla.tmarginal(function(x) 1/x, u.res$marginals.hy[[1]]): object</span>
<span 
class="aett-10x-x-109">&#8217;u.res&#8217; not found</span>
</p><!--l. 948--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p><!--l. 950--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in plot(j.res$marginals.hyperpar[[2]], type = "l", xlim = c(0, 10), :</span>
<span 
class="aett-10x-x-109">object &#8217;j.res&#8217; not found</span>
</p><!--l. 952--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in lines(pp.res$marginals.hyperpar[[1]], lty = 2, lwd = 2): object</span>
<span 
class="aett-10x-x-109">&#8217;pp.res&#8217; not found</span>
</p><!--l. 954--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in lines(u.res$marginals.hyperpar[[2]], lty = 3, lwd = 5): object</span>
<span 
class="aett-10x-x-109">&#8217;u.res&#8217; not found</span>
</p><!--l. 956--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p><!--l. 958--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in plot(j.res$marginals.hyperpar[[3]], type = "l", lwd = 2, xlim = c(0,</span>
<span 
class="aett-10x-x-109">: object &#8217;j.res&#8217; not found</span>
</p><!--l. 960--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in lines(pp.res$marginals.hyperpar[[2]], lty = 2, lwd = 2): object</span>
<span 
class="aett-10x-x-109">&#8217;pp.res&#8217; not found</span>
</p><!--l. 962--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in lines(u.res$marginals.hyperpar[[3]], lty = 3, lwd = 5): object</span>
<span 
class="aett-10x-x-109">&#8217;u.res&#8217; not found</span>
</p><!--l. 964--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p><!--l. 966--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in plot(j.res$marginals.hy[[4]], type = "l", xlab = expression(beta), :</span>
<span 
class="aett-10x-x-109">object &#8217;j.res&#8217; not found</span>
</p><!--l. 968--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in int_abline(a = a, b = b, h = h, v = v, untf = untf, ...): plot.new</span>
<span 
class="aett-10x-x-109">has not been called yet</span>
</p><!--l. 970--><p class="noindent" ><span 
class="aett-10x-x-109">## Error in strwidth(legend, units = "user", cex = cex, font = text.font):</span>
<span 
class="aett-10x-x-109">plot.new has not been called yet</span>
</p>
</div>
<br /><div class="caption" 
><span class="id">Figure&#x00A0;4.8: </span><span  
class="content">Posterior marginal distribution for: intercept for the point process <span 
class="cmmi-10x-x-109">&#x03B2;</span><sub><span 
class="cmr-8">0</span></sub>, intercept
for  the  observations  <span 
class="cmmi-10x-x-109">&#x03B2;</span><sub><span 
class="cmr-8">0</span></sub><sup><span 
class="cmmi-8">y</span></sup>,  noise  variance  in  the  observations  <span 
class="cmmi-10x-x-109">&#x03C3;</span><sub><span 
class="cmmi-8">y</span></sub><sup><span 
class="cmr-8">2</span></sup>,  the  practical  range
parametrized as <img 
src="spde-tutorial65x.png" alt="&#x221A; --
  8"  class="sqrt"  /><span 
class="cmmi-10x-x-109">&#x2215;&#x03BA;</span>, the marginal standard deviation for the random field <span 
class="cmmi-10x-x-109">&#x03C3;</span><sub><span 
class="cmmi-8">x</span></sub><sup><span 
class="cmr-8">2</span></sup> and the
sharing coefficient <span 
class="cmmi-10x-x-109">&#x03B2;</span>.</span></div><!--tex4ht:label?: x8-790018 -->
                                                                                 
                                                                                 
   </div><hr class="endfigure" />
                                                                                 
                                                                                 
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="spde-tutorialch5.html" >next</a>] [<a 
href="spde-tutorialch3.html" >prev</a>] [<a 
href="spde-tutorialch3.html#tailspde-tutorialch3.html" >prev-tail</a>] [<a 
href="spde-tutorialch4.html" >front</a>] [<a 
href="spde-tutorial3.html#spde-tutorialch4.html" >up</a>] </p></div>
<!--l. 1--><p class="indent" >   <a 
 id="tailspde-tutorialch4.html"></a>   </p> 
</body></html> 
