<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>11 Lowering resolution of a spatio-temporal model</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<!-- xhtml,html,frames,2 --> 
<meta name="src" content="spde-tutorial.tex" /> 
<meta name="date" content="2017-01-22 14:18:00" /> 
<link rel="stylesheet" type="text/css" href="spde-tutorial.css" /> 
</head><body 
>
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="spde-tutorialch12.html" >next</a>] [<a 
href="spde-tutorialch10.html" >prev</a>] [<a 
href="spde-tutorialch10.html#tailspde-tutorialch10.html" >prev-tail</a>] [<a 
href="#tailspde-tutorialch11.html">tail</a>] [<a 
href="spde-tutorial3.html#spde-tutorialch11.html" >up</a>] </p></div>
   <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;11</span><br /><a 
 id="x15-7600011"></a>Lowering resolution of a spatio-temporal model</h2>
<!--l. 6--><p class="noindent" >It can be challenging when dealing with large data sets. In this chapter we want to show how to
fit a model using some dimention reduction.
</p><!--l. 10--><p class="indent" >   Before starting, the spatial mesh and the SPDE model is built with the following
code.
</p>
   <div class="fancyvrb" id="fancyvrb494"><a 
 id="x15-76002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;data(PRprec)</span><br class="fancyvrb" /><a 
 id="x15-76004r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;bound</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.nonconvex.hull(as.matrix(PRprec[,1:2]),</span><span 
class="aesltt-10x-x-109">&#x00A0;.2,</span><span 
class="aesltt-10x-x-109">&#x00A0;.2,</span><span 
class="aesltt-10x-x-109">&#x00A0;resol=50)</span>
<br class="fancyvrb" /><a 
 id="x15-76006r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh.s</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(bound=bound,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(1,2),</span>
<br class="fancyvrb" /><a 
 id="x15-76008r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;offset=c(.0001,0.7),</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.5)</span><br class="fancyvrb" /><a 
 id="x15-76010r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;spde.s</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde2.matern(mesh.s)</span></div>
   <h3 class="sectionHead"><span class="titlemark">11.1   </span> <a 
 id="x15-7700011.1"></a>Data temporal aggregation</h3>
<!--l. 23--><p class="noindent" >The data we are going to analyse is the daily rainfall in Paraná. We have rainfall at 616 location
points observed over 365 days.
</p>
   <div class="fancyvrb" id="fancyvrb495"><a 
 id="x15-77002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;dim(PRprec)</span></div>
<!--l. 29--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb496"><a 
 id="x15-77004r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;616</span><span 
class="aett-10x-x-109">&#x00A0;368</span></div>
<!--l. 32--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb497"><a 
 id="x15-77006r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;PRprec[1:2,</span><span 
class="aesltt-10x-x-109">&#x00A0;1:7]</span></div>
<!--l. 35--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb498"><a 
 id="x15-77008r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Longitude</span><span 
class="aett-10x-x-109">&#x00A0;Latitude</span><span 
class="aett-10x-x-109">&#x00A0;Altitude</span><span 
class="aett-10x-x-109">&#x00A0;d0101</span><span 
class="aett-10x-x-109">&#x00A0;d0102</span><span 
class="aett-10x-x-109">&#x00A0;d0103</span><span 
class="aett-10x-x-109">&#x00A0;d0104</span>
<br class="fancyvrb" /><a 
 id="x15-77010r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;-50.8744</span><span 
class="aett-10x-x-109">&#x00A0;-22.8511</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;365</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span>
<br class="fancyvrb" /><a 
 id="x15-77012r3"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;3</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;-50.7711</span><span 
class="aett-10x-x-109">&#x00A0;-22.9597</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;344</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span></div>
<!--l. 42--><p class="indent" >   To this example we are going to analyse the probability of rain. So we only consider if the
value where bigger than <span 
class="cmr-10x-x-109">0</span><span 
class="cmmi-10x-x-109">.</span><span 
class="cmr-10x-x-109">1 </span>or not.
</p><!--l. 45--><p class="indent" >   To reduce the time dimension of the data, we aggregate it summing every five days. At end
we have two data matrix, one with the number of days without NA in each station and another
with the number of raining days on such stations.
</p>
   <div class="fancyvrb" id="fancyvrb499"><a 
 id="x15-77014r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;table(table(id5</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;0:364%/%5</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;1))</span></div>
<!--l. 53--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb500"><a 
 id="x15-77016r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;5</span><br class="fancyvrb" /><a 
 id="x15-77018r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;73</span></div>
<!--l. 57--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb501"><a 
 id="x15-77020r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;n5</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;t(apply(!is.na(PRprec[,3+1:365]),</span><span 
class="aesltt-10x-x-109">&#x00A0;1,</span><span 
class="aesltt-10x-x-109">&#x00A0;tapply,</span><span 
class="aesltt-10x-x-109">&#x00A0;id5,</span><span 
class="aesltt-10x-x-109">&#x00A0;sum))</span>
<br class="fancyvrb" /><a 
 id="x15-77022r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;y5</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;t(apply(PRprec[,3+1:365]&#x003E;0.1,</span><span 
class="aesltt-10x-x-109">&#x00A0;1,</span><span 
class="aesltt-10x-x-109">&#x00A0;tapply,</span><span 
class="aesltt-10x-x-109">&#x00A0;id5,</span><span 
class="aesltt-10x-x-109">&#x00A0;sum,</span><span 
class="aesltt-10x-x-109">&#x00A0;na.rm=TRUE))</span>
<br class="fancyvrb" /><a 
 id="x15-77024r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;k</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;ncol(n5);</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;table(as.vector(n5))</span></div>
                                                                                 
                                                                                 
<!--l. 62--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb502"><a 
 id="x15-77026r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;2</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;3</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;4</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;5</span><br class="fancyvrb" /><a 
 id="x15-77028r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;3563</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;77</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;72</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;95</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;172</span><span 
class="aett-10x-x-109">&#x00A0;40989</span></div>
<!--l. 67--><p class="noindent" >From now, our data has 73 time points.
</p><!--l. 69--><p class="indent" >   From the above table, we can see that there were 3563 periods of five days with no data
recorded. The first approach can be removing such pairs data, both <span 
class="cmmi-10x-x-109">y </span>and <span 
class="cmmi-10x-x-109">n</span>. If we do
not remove it, we have to assign NA to <span 
class="cmmi-10x-x-109">y </span>when <span 
class="cmmi-10x-x-109">n </span><span 
class="cmr-10x-x-109">= 0</span>. However, we have to assign
a positive value, five for example, for such <span 
class="cmmi-10x-x-109">n </span>and it will be treated as a prediction
scenario.
</p>
   <div class="fancyvrb" id="fancyvrb503"><a 
 id="x15-77030r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;y5[n5==0]</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;NA;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;n5[n5==0]</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;5</span></div>
<!--l. 81--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">11.2   </span> <a 
 id="x15-7800011.2"></a>Lowering temporal model resolution</h3>
<!--l. 83--><p class="noindent" >This approach is better expained in<span class="cite">[<a 
href="spde-tutorialli2.html#XblangiardoC:2015">Blangiardo and Cameletti, 2015</a>]</span>. The main idea is to place
some knots over the time window and define a model on such knots. Them project the model
into the data time points as we do using the Finite Element Method in the SPDE
approach.
</p><!--l. 89--><p class="indent" >   We choose to place knots at each 6 time points of the temporally aggregated data, which has
73 time points. So, we en up with only 12 knots over time.
</p>
   <div class="fancyvrb" id="fancyvrb504"><a 
 id="x15-78002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;bt</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;6;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;gtime</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;seq(1+bt,</span><span 
class="aesltt-10x-x-109">&#x00A0;k,</span><span 
class="aesltt-10x-x-109">&#x00A0;length=round(k/bt))-bt/2</span><br class="fancyvrb" /><a 
 id="x15-78004r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh.t</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.1d(gtime,</span><span 
class="aesltt-10x-x-109">&#x00A0;degree=1)</span>
<br class="fancyvrb" /><a 
 id="x15-78006r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;table(igr</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;apply(abs(outer(mesh.t$loc,</span><span 
class="aesltt-10x-x-109">&#x00A0;1:k,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">-</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)),</span><span 
class="aesltt-10x-x-109">&#x00A0;2,</span><span 
class="aesltt-10x-x-109">&#x00A0;which.min))</span></div>
<!--l. 99--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb505"><a 
 id="x15-78008r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;2</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;3</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;4</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;5</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;6</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;7</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;8</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;9</span><span 
class="aett-10x-x-109">&#x00A0;10</span><span 
class="aett-10x-x-109">&#x00A0;11</span><span 
class="aett-10x-x-109">&#x00A0;12</span><br class="fancyvrb" /><a 
 id="x15-78010r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;7</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;6</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;6</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;6</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;6</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;6</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;6</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;6</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;6</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;6</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;6</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;6</span></div>
<!--l. 104--><p class="noindent" >The fist knot is closer to 7 time blocks and the others to 6.
</p><!--l. 106--><p class="indent" >   The model dimention is then
</p>
   <div class="fancyvrb" id="fancyvrb506"><a 
 id="x15-78012r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;spde.s$n.spde*mesh.t$n</span></div>
<!--l. 111--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb507"><a 
 id="x15-78014r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;1152</span></div>
<!--l. 116--><p class="indent" >   To built the spatial projector matrix, we need to replicate the spatial coordinates
as
</p>
   <div class="fancyvrb" id="fancyvrb508"><a 
 id="x15-78016r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;n</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;nrow(PRprec)</span><br class="fancyvrb" /><a 
 id="x15-78018r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;st.sloc</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;cbind(rep(PRprec[,1],</span><span 
class="aesltt-10x-x-109">&#x00A0;k),</span><span 
class="aesltt-10x-x-109">&#x00A0;rep(PRprec[,2],</span><span 
class="aesltt-10x-x-109">&#x00A0;k))</span></div>
<!--l. 124--><p class="noindent" >and then to consider the temporal mesh considering the group index in the scale of the data to be
analised.
</p>
   <div class="fancyvrb" id="fancyvrb509"><a 
 id="x15-78020r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;Ast</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde.make.A(mesh=mesh.s,</span><span 
class="aesltt-10x-x-109">&#x00A0;loc=st.sloc,</span>
<br class="fancyvrb" /><a 
 id="x15-78022r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;group.mesh=mesh.t,</span><span 
class="aesltt-10x-x-109">&#x00A0;group=rep(1:k,</span><span 
class="aesltt-10x-x-109">&#x00A0;each=n))</span></div>
                                                                                 
                                                                                 
<!--l. 133--><p class="indent" >   The index set and the stack is built as usual
</p>
   <div class="fancyvrb" id="fancyvrb510"><a 
 id="x15-78024r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;idx.st</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde.make.index(</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">i</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;n.spde=spde.s$n.spde,</span>
<br class="fancyvrb" /><a 
 id="x15-78026r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;n.group=mesh.t$n)</span>
<br class="fancyvrb" /><a 
 id="x15-78028r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;dat</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.stack(data=list(yy=as.vector(y5),</span><span 
class="aesltt-10x-x-109">&#x00A0;nn=as.vector(n5)),</span><br class="fancyvrb" /><a 
 id="x15-78030r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;A=list(Ast,</span><span 
class="aesltt-10x-x-109">&#x00A0;1),</span>
<br class="fancyvrb" /><a 
 id="x15-78032r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;effects=list(idx.st,</span><br class="fancyvrb" /><a 
 id="x15-78034r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;data.frame(mu0=1,</span>
<br class="fancyvrb" /><a 
 id="x15-78036r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;altitude=rep(PRprec$Alt/1e3,</span><span 
class="aesltt-10x-x-109">&#x00A0;k))))</span></div>
<!--l. 146--><p class="indent" >   The formula is also as the usual for the separable spatio temporal model
</p>
   <div class="fancyvrb" id="fancyvrb511"><a 
 id="x15-78038r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;form</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;yy</span><span 
class="aesltt-10x-x-109">&#x00A0;~</span><span 
class="aesltt-10x-x-109">&#x00A0;0</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;mu0</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;altitude</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><br class="fancyvrb" /><a 
 id="x15-78040r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;f(i,</span><span 
class="aesltt-10x-x-109">&#x00A0;model=spde.s,</span><span 
class="aesltt-10x-x-109">&#x00A0;group=i.group,</span>
<br class="fancyvrb" /><a 
 id="x15-78042r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.group=list(model=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">ar1</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">))</span></div>
<!--l. 155--><p class="indent" >   To "fit" the model as fast as possible, we use the &#8217;gaussian&#8217; approximation and the Empirical
Bayes (&#8217;eb&#8217;) integration strategy over the hyperparameters. We also fixed the mode at the values
we have find in previous analisys.
</p>
   <div class="fancyvrb" id="fancyvrb512"><a 
 id="x15-78044r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;result</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla(form,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">binomial</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;data=inla.stack.data(dat),</span>
<br class="fancyvrb" /><a 
 id="x15-78046r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;Ntrials=inla.stack.data(dat)$nn,</span>
<br class="fancyvrb" /><a 
 id="x15-78048r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.predictor=list(A=inla.stack.A(dat)),</span>
<br class="fancyvrb" /><a 
 id="x15-78050r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.mode=list(theta=c(-0.48,</span><span 
class="aesltt-10x-x-109">&#x00A0;-0.9,</span><span 
class="aesltt-10x-x-109">&#x00A0;2.52)),</span><span 
class="aesltt-10x-x-109">&#x00A0;###restart=TRUE),</span>
<br class="fancyvrb" /><a 
 id="x15-78052r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.inla=list(strategy=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">gaussian</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;int.strategy=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">eb</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">))</span></div>
<!--l. 169--><p class="indent" >   We can plot the fitted spatial effect for each temporal knot and overlay the proportion
raining days considering the data closest to the time knots.
</p><!--l. 173--><p class="indent" >   Defining a grid to project
</p>
   <div class="fancyvrb" id="fancyvrb513"><a 
 id="x15-78054r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;data(PRborder)</span><br class="fancyvrb" /><a 
 id="x15-78056r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;r0</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;diff(range(PRborder[,1]))/diff(range(PRborder[,2]))</span>
<br class="fancyvrb" /><a 
 id="x15-78058r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;prj</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.projector(mesh.s,</span><span 
class="aesltt-10x-x-109">&#x00A0;xlim=range(PRborder[,1]),</span>
<br class="fancyvrb" /><a 
 id="x15-78060r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;ylim=range(PRborder[,2]),</span><span 
class="aesltt-10x-x-109">&#x00A0;dims=c(100*r0,</span><span 
class="aesltt-10x-x-109">&#x00A0;100))</span>
<br class="fancyvrb" /><a 
 id="x15-78062r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;in.pr</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inout(prj$lattice$loc,</span><span 
class="aesltt-10x-x-109">&#x00A0;PRborder)</span></div>
<!--l. 184--><p class="indent" >   Project the posterior mean fitted at each time knot
</p>
   <div class="fancyvrb" id="fancyvrb514"><a 
 id="x15-78064r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;mu.spat</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;lapply(1:mesh.t$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;function(j)</span><span 
class="aesltt-10x-x-109">&#x00A0;{</span>
<br class="fancyvrb" /><a 
 id="x15-78066r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;r</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.project(prj,</span><span 
class="aesltt-10x-x-109">&#x00A0;field=result$summary.ran$i$mean[</span>
<br class="fancyvrb" /><a 
 id="x15-78068r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;1:spde.s$n.spde</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;(j-1)*spde.s$n.spde])</span>
<br class="fancyvrb" /><a 
 id="x15-78070r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;r[!in.pr]</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;NA;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;return(r)})</span></div>
<!--l. 194--><p class="indent" >   The images in Figure&#x00A0;<a 
href="#x15-780871">11.1<!--tex4ht:ref: fig:lowstres --></a> were made using the following commands
</p>
   <div class="fancyvrb" id="fancyvrb515"><a 
 id="x15-78072r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mfrow=c(4,3),</span><span 
class="aesltt-10x-x-109">&#x00A0;mar=c(0,0,0,0))</span><br class="fancyvrb" /><a 
 id="x15-78074r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;zlm</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;range(unlist(mu.spat),</span><span 
class="aesltt-10x-x-109">&#x00A0;na.rm=TRUE)</span>
<br class="fancyvrb" /><a 
 id="x15-78076r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;for</span><span 
class="aesltt-10x-x-109">&#x00A0;(j</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;1:mesh.t$n)</span><span 
class="aesltt-10x-x-109">&#x00A0;{</span><br class="fancyvrb" /><a 
 id="x15-78078r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;image.plot(x=prj$x,</span><span 
class="aesltt-10x-x-109">&#x00A0;y=prj$y,</span><span 
class="aesltt-10x-x-109">&#x00A0;z=mu.spat[[j]],</span><span 
class="aesltt-10x-x-109">&#x00A0;asp=1,</span><span 
class="aesltt-10x-x-109">&#x00A0;axes=FALSE,</span><span 
class="aesltt-10x-x-109">&#x00A0;zlim=zlm)</span>
<br class="fancyvrb" /><a 
 id="x15-78080r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;lines(PRborder)</span><br class="fancyvrb" /><a 
 id="x15-78082r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;points(PRprec[,</span><span 
class="aesltt-10x-x-109">&#x00A0;1:2],</span>
<br class="fancyvrb" /><a 
 id="x15-78084r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;cex=rowSums(y5[,</span><span 
class="aesltt-10x-x-109">&#x00A0;j==igr],</span><span 
class="aesltt-10x-x-109">&#x00A0;na.rm=TRUE)/rowSums(n5[,j==igr]))</span><br class="fancyvrb" /><a 
 id="x15-78086r8"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;}</span></div>
                                                                                 
                                                                                 
<hr class="figure" /><div class="figure" 
><a 
 id="x15-780871"></a><img 
src="spde-tutorial90x.png" alt="PIC" class="graphics" width="422.52936pt" height="367.36697pt"  /><!--tex4ht:graphics  
name="spde-tutorial90x.png" src="figs/lowst-lowstres.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;11.1: </span><span  
class="content">Spatial effect at each time knots.</span></div><!--tex4ht:label?: x15-780871 -->
   </div><hr class="endfigure" />
                                                                                 
                                                                                 
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="spde-tutorialch12.html" >next</a>] [<a 
href="spde-tutorialch10.html" >prev</a>] [<a 
href="spde-tutorialch10.html#tailspde-tutorialch10.html" >prev-tail</a>] [<a 
href="spde-tutorialch11.html" >front</a>] [<a 
href="spde-tutorial3.html#spde-tutorialch11.html" >up</a>] </p></div>
<!--l. 1--><p class="indent" >   <a 
 id="tailspde-tutorialch11.html"></a>  </p> 
</body></html> 
