<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>10 Space-time examples</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<!-- xhtml,html,frames,2 --> 
<meta name="src" content="spde-tutorial.tex" /> 
<meta name="date" content="2017-01-22 14:18:00" /> 
<link rel="stylesheet" type="text/css" href="spde-tutorial.css" /> 
</head><body 
>
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="spde-tutorialch11.html" >next</a>] [<a 
href="spde-tutorialch9.html" >prev</a>] [<a 
href="spde-tutorialch9.html#tailspde-tutorialch9.html" >prev-tail</a>] [<a 
href="#tailspde-tutorialch10.html">tail</a>] [<a 
href="spde-tutorial3.html#spde-tutorialch10.html" >up</a>] </p></div>
   <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;10</span><br /><a 
 id="x14-6500010"></a>Space-time examples</h2>
<!--l. 5--><p class="noindent" >In this chapter we show an example on fitting a space-time model. This model is a separable one
described on <span class="cite">[<a 
href="spde-tutorialli2.html#Xcameletti:2012">Cameletti et&#x00A0;al., 2012</a>]</span>. Basically the model is defined as a SPDE model
for the spatial domain and an AR(<span 
class="cmr-10x-x-109">1</span>) model for the time dimention. The space-time
separable model is defined by the kronecker product between the precision of these two
models.
</p><!--l. 13--><p class="indent" >   We provide two examples, one for discrete time domain and another when the
time is discretized over a set of knots. Basically the difference appears only in the
simulation process, wich is not that important. The main difference in the fitting process is
that in the continuous time case we have to select time knots and build the projector
matrix considering it. However, both cases allows to have different locations at different
times.
</p>
   <h3 class="sectionHead"><span class="titlemark">10.1   </span> <a 
 id="x14-6600010.1"></a>Discrete time domain</h3>
<!--l. 22--><p class="noindent" >In this section we show how to fit a space-time separable model, as in <span class="cite">[<a 
href="spde-tutorialli2.html#Xcameletti:2012">Cameletti et&#x00A0;al., 2012</a>]</span>.
Additionally, we show the use of a categorical covariate.
</p><!--l. 26--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">10.1.1   </span> <a 
 id="x14-6700010.1.1"></a>Data simulation</h4>
<!--l. 28--><p class="noindent" >We use the Paraná state border, available on <span 
class="aeb10-x-x-109">INLA </span>package, as the domain.
</p>
   <div class="fancyvrb" id="fancyvrb439"><a 
 id="x14-67002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;data(PRborder)</span></div>
<!--l. 35--><p class="noindent" >We start by defining the spatial model. Because we need that the example run faster, we use the low
resolution mesh for Paraná state border created on the section&#x00A0;<a 
href="spde-tutorialch2.html#x6-100002.2">2.2<!--tex4ht:ref: ch:mesh --></a>.
</p><!--l. 41--><p class="indent" >   There is two options to simulate from Cameletti&#8217;s model. One is based on the marginal
distribution of the latent field and another is on the conditional distribution at each time. The
second one is easy for us by use the function defined on the section&#x00A0;<a 
href="spde-tutorialch2.html#x6-180002.5">2.5<!--tex4ht:ref: sec:simula --></a> to simulate an
independent random field realization each time.
</p><!--l. 51--><p class="indent" >   First we set <span 
class="cmmi-10x-x-109">k </span><span 
class="cmr-10x-x-109">= 12</span>, the time dimention
</p>
   <div class="fancyvrb" id="fancyvrb440"><a 
 id="x14-67004r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;k</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;12</span></div>
<!--l. 57--><p class="noindent" >and consider the location points from the <span 
class="aett-10x-x-109">PRprec </span>data in a random order
</p>
   <div class="fancyvrb" id="fancyvrb441"><a 
 id="x14-67006r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;data(PRprec)</span><br class="fancyvrb" /><a 
 id="x14-67008r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;coords</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;as.matrix(PRprec[sample(1:nrow(PRprec)),</span><span 
class="aesltt-10x-x-109">&#x00A0;1:2])</span></div>
<!--l. 65--><p class="indent" >   In the following simulation step we will use the <span 
class="aett-10x-x-109">rspde() </span>function
defined in Section&#x00A0;<a 
href="spde-tutorialch2.html#x6-180002.5">2.5<!--tex4ht:ref: sec:simula --></a>. This function is available in the file at
<a 
href="http://www.math.ntnu.no/inla/r-inla.org/tutorials/spde/spde-tutorial-functions.R" class="url" ><span 
class="aett-10x-x-109">http://www.math.ntnu.no/inla/r-_inla.org/tutorials/spde/spde-_tutorial-_functions.R</span></a>.
The <span 
class="cmmi-10x-x-109">k </span>independent realizations can be done by
</p>
   <div class="fancyvrb" id="fancyvrb442"><a 
 id="x14-67010r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;params</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;c(variance=1,</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa=1/2)</span><br class="fancyvrb" /><a 
 id="x14-67012r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;set.seed(1)</span><br class="fancyvrb" /><a 
 id="x14-67014r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;x.k</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;rspde(coords,</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa=1/2,</span><span 
class="aesltt-10x-x-109">&#x00A0;n=k,</span>
<br class="fancyvrb" /><a 
 id="x14-67016r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh=prmesh1,</span><span 
class="aesltt-10x-x-109">&#x00A0;return.attributes=TRUE)</span><br class="fancyvrb" /><a 
 id="x14-67018r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;dim(x.k)</span></div>
<!--l. 78--><p class="noindent" >
                                                                                 
                                                                                 
</p>
   <div class="fancyvrb" id="fancyvrb443"><a 
 id="x14-67020r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;616</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;12</span></div>
<!--l. 83--><p class="indent" >   Now, we define the autoregressive parameter <span 
class="cmmi-10x-x-109">&#x03C1;</span>
</p>
   <div class="fancyvrb" id="fancyvrb444"><a 
 id="x14-67022r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;rho</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;0.7</span></div>
<!--l. 89--><p class="noindent" >and get the correlated sample over time using
</p>
   <div class="fancyvrb" id="fancyvrb445"><a 
 id="x14-67024r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;x</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;x.k</span><br class="fancyvrb" /><a 
 id="x14-67026r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;for</span><span 
class="aesltt-10x-x-109">&#x00A0;(j</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;2:k)</span><br class="fancyvrb" /><a 
 id="x14-67028r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;x[,j]</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;rho*x[,j-1]</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;sqrt(1-rho^2)*x.k[,j]</span></div>
<!--l. 97--><p class="noindent" >where the <img 
src="spde-tutorial84x.png" alt="&#x2218; -
  ("  class="sqrt"  /><span 
class="cmr-10x-x-109">1 </span><span 
class="cmsy-10x-x-109">- </span><span 
class="cmmi-10x-x-109">&#x03C1;</span><sup><span 
class="cmr-8">2</span></sup><span 
class="cmr-10x-x-109">) </span>term is added as we would like to consider that the innovation noise
follows the stationary distribution, see <span class="cite">[<a 
href="spde-tutorialli2.html#XRueHeld:2005">Rue and Held, 2005</a>]</span> and <span class="cite">[<a 
href="spde-tutorialli2.html#Xcameletti:2012">Cameletti et&#x00A0;al.,
2012</a>]</span>.
</p><!--l. 102--><p class="indent" >   We can visualize the realization at the figure&#x00A0;<a 
href="#x14-670391">10.1<!--tex4ht:ref: fig:timevisual --></a> with commands bellow
</p>
   <div class="fancyvrb" id="fancyvrb446"><a 
 id="x14-67030r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;c100</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;rainbow(101)</span><br class="fancyvrb" /><a 
 id="x14-67032r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mfrow=c(4,3),</span><span 
class="aesltt-10x-x-109">&#x00A0;mar=c(0,0,0,0))</span><br class="fancyvrb" /><a 
 id="x14-67034r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;for</span><span 
class="aesltt-10x-x-109">&#x00A0;(j</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;1:k)</span>
<br class="fancyvrb" /><a 
 id="x14-67036r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(coords,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=c100[round(100*(x[,j]-min(x[,j]))/diff(range(x[,j])))],</span>
<br class="fancyvrb" /><a 
 id="x14-67038r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;axes=FALSE,</span><span 
class="aesltt-10x-x-109">&#x00A0;asp=1,</span><span 
class="aesltt-10x-x-109">&#x00A0;pch=19,</span><span 
class="aesltt-10x-x-109">&#x00A0;cex=0.5)</span></div>
<hr class="figure" /><div class="figure" 
><a 
 id="x14-670391"></a><img 
src="spde-tutorial85x.png" alt="PIC" class="graphics" width="422.52936pt" height="394.37744pt"  /><!--tex4ht:graphics  
name="spde-tutorial85x.png" src="figs/spacetime-ftimevisual.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;10.1: </span><span  
class="content">Realization of the space-time random field.</span></div><!--tex4ht:label?: x14-670391 -->
   </div><hr class="endfigure" />
<!--l. 121--><p class="indent" >   In this example we need to show the use of a categorical covariate. First we do the simulation
of the covariate as
                                                                                 
                                                                                 
</p>
   <div class="fancyvrb" id="fancyvrb447"><a 
 id="x14-67041r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;n</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;nrow(coords)</span><br class="fancyvrb" /><a 
 id="x14-67043r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;set.seed(2)</span><br class="fancyvrb" /><a 
 id="x14-67045r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;table(ccov</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;factor(sample(LETTERS[1:3],</span><span 
class="aesltt-10x-x-109">&#x00A0;n*k,</span><span 
class="aesltt-10x-x-109">&#x00A0;replace=TRUE))</span><span 
class="aesltt-10x-x-109">&#x00A0;)</span></div>
<!--l. 130--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb448"><a 
 id="x14-67047r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;A</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;B</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;C</span><br class="fancyvrb" /><a 
 id="x14-67049r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;2458</span><span 
class="aett-10x-x-109">&#x00A0;2438</span><span 
class="aett-10x-x-109">&#x00A0;2496</span></div>
<!--l. 135--><p class="noindent" >and the regression parameters as
</p>
   <div class="fancyvrb" id="fancyvrb449"><a 
 id="x14-67051r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;beta</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;-1:1</span></div>
<!--l. 142--><p class="indent" >   The response is
</p>
   <div class="fancyvrb" id="fancyvrb450"><a 
 id="x14-67053r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;y</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;beta[unclass(ccov)]</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;x</span><br class="fancyvrb" /><a 
 id="x14-67055r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;tapply(y,</span><span 
class="aesltt-10x-x-109">&#x00A0;ccov,</span><span 
class="aesltt-10x-x-109">&#x00A0;mean)</span></div>
<!--l. 148--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb451"><a 
 id="x14-67057r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;A</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;B</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;C</span><br class="fancyvrb" /><a 
 id="x14-67059r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;-1.8539499</span><span 
class="aett-10x-x-109">&#x00A0;-0.9105227</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0.1388517</span></div>
<!--l. 154--><p class="indent" >   To show that is allowed to have different locations on different times, we drop some of the
observations. We do it by just selecting a half of the simulated data. We do it by creating a
index for the selected observations
</p>
   <div class="fancyvrb" id="fancyvrb452"><a 
 id="x14-67061r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;isel</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;sample(1:(n*k),</span><span 
class="aesltt-10x-x-109">&#x00A0;n*k/2)</span></div>
<!--l. 165--><p class="noindent" >and we organize the data on a <span 
class="aett-10x-x-109">data.frame</span>
</p>
   <div class="fancyvrb" id="fancyvrb453"><a 
 id="x14-67063r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;dat</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;data.frame(y=as.vector(y),</span><span 
class="aesltt-10x-x-109">&#x00A0;w=ccov,</span><br class="fancyvrb" /><a 
 id="x14-67065r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;time=rep(1:k,</span><span 
class="aesltt-10x-x-109">&#x00A0;each=n),</span>
<br class="fancyvrb" /><a 
 id="x14-67067r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xcoo=rep(coords[,1],</span><span 
class="aesltt-10x-x-109">&#x00A0;k),</span><br class="fancyvrb" /><a 
 id="x14-67069r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;ycoo=rep(coords[,2],</span><span 
class="aesltt-10x-x-109">&#x00A0;k))[isel,</span><span 
class="aesltt-10x-x-109">&#x00A0;]</span></div>
<!--l. 175--><p class="indent" >   In real applications some times we have completely missaligned locations between different
times. The code provided here to fit the model still work on this situation.
</p><!--l. 180--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">10.1.2   </span> <a 
 id="x14-6800010.1.2"></a>Data stack preparation</h4>
<!--l. 182--><p class="noindent" >Now, we need the data preparation to build the space-time model. The index set is made
taking into account the number of weights on the SPDE model and the number of
groups
</p>
   <div class="fancyvrb" id="fancyvrb454"><a 
 id="x14-68002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;spde</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;attr(x.k,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">spde</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)</span><br class="fancyvrb" /><a 
 id="x14-68004r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;iset</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde.make.index(</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">i</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;n.spde=spde$n.spde,</span><span 
class="aesltt-10x-x-109">&#x00A0;n.group=k)</span></div>
<!--l. 193--><p class="noindent" >Notice that the index set for the latent field is not depending on the data set locations. It only
depends on the SPDE model size and on the time dimention.
</p><!--l. 198--><p class="indent" >   The projector matrix must be defined considering the coordinates of the observed data. We
have to inform the time index for the group to build the projector matrix. This also must be
defined on the <span 
class="aett-10x-x-109">inla.spde.make.A() </span>function
</p>
   <div class="fancyvrb" id="fancyvrb455"><a 
 id="x14-68006r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;A</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde.make.A(mesh=prmesh1,</span><br class="fancyvrb" /><a 
 id="x14-68008r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;loc=cbind(dat$xcoo,</span><span 
class="aesltt-10x-x-109">&#x00A0;dat$ycoo),</span>
<br class="fancyvrb" /><a 
 id="x14-68010r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;group=dat$time)</span></div>
                                                                                 
                                                                                 
<!--l. 212--><p class="indent" >   The effects on the stack are a list with two elements, one is the index set and another the
categorical covariate. The stack data is defined as
</p>
   <div class="fancyvrb" id="fancyvrb456"><a 
 id="x14-68012r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;sdat</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.stack(tag=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">stdata</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;data=list(y=dat$y),</span>
<br class="fancyvrb" /><a 
 id="x14-68014r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;A=list(A,1),</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;effects=list(iset,</span><span 
class="aesltt-10x-x-109">&#x00A0;w=dat$w))</span></div>
<!--l. 222--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">10.1.3   </span> <a 
 id="x14-6900010.1.3"></a>Fitting the model and some results</h4>
<!--l. 224--><p class="noindent" >We set the prior on the temporal autoregressive parameter with zero mean and variance equals
5, and define the initial value equals the true with
</p>
   <div class="fancyvrb" id="fancyvrb457"><a 
 id="x14-69002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;h.spec</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;list(theta=list(initial=0.7,</span><span 
class="aesltt-10x-x-109">&#x00A0;param=c(0,</span><span 
class="aesltt-10x-x-109">&#x00A0;5)))</span></div>
<!--l. 233--><p class="indent" >   The likelihood hyperparameter is fixed on a hight precision, just because we haven&#8217;t noise.
To deal with the categorical covariate we need to set <span 
class="aett-10x-x-109">expand.factor.strategy=&#8217;inla&#8217; </span>on the
<span 
class="aett-10x-x-109">control.fixed </span>argument list.
</p>
   <div class="fancyvrb" id="fancyvrb458"><a 
 id="x14-69004r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;formulae</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;y</span><span 
class="aesltt-10x-x-109">&#x00A0;~</span><span 
class="aesltt-10x-x-109">&#x00A0;0</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;w</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><br class="fancyvrb" /><a 
 id="x14-69006r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;f(i,</span><span 
class="aesltt-10x-x-109">&#x00A0;model=spde,</span><span 
class="aesltt-10x-x-109">&#x00A0;group=i.group,</span>
<br class="fancyvrb" /><a 
 id="x14-69008r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.group=list(model=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">ar1</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;hyper=h.spec))</span>
<br class="fancyvrb" /><a 
 id="x14-69010r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;res</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla(formulae,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;data=inla.stack.data(sdat),</span>
<br class="fancyvrb" /><a 
 id="x14-69012r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.predictor=list(compute=TRUE,</span><span 
class="aesltt-10x-x-109">&#x00A0;A=inla.stack.A(sdat)),</span>
<br class="fancyvrb" /><a 
 id="x14-69014r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.family=list(initial=10,</span><span 
class="aesltt-10x-x-109">&#x00A0;fixed=TRUE),</span>
<br class="fancyvrb" /><a 
 id="x14-69016r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.fixed=list(expand.factor.strategy=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">inla</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">))</span></div>
<!--l. 250--><p class="indent" >   Summary for the trhee intercepts (and the observed mean for each covariate level)
</p>
   <div class="fancyvrb" id="fancyvrb459"><a 
 id="x14-69018r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;round(cbind(observed=tapply(dat$y,</span><span 
class="aesltt-10x-x-109">&#x00A0;dat$w,</span><span 
class="aesltt-10x-x-109">&#x00A0;mean),</span><span 
class="aesltt-10x-x-109">&#x00A0;res$summary.fixed),</span><span 
class="aesltt-10x-x-109">&#x00A0;4)</span></div>
<!--l. 256--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb460"><a 
 id="x14-69020r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;observed</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;mean</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;sd</span><span 
class="aett-10x-x-109">&#x00A0;0.025quant</span><span 
class="aett-10x-x-109">&#x00A0;0.5quant</span><span 
class="aett-10x-x-109">&#x00A0;0.975quant</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;mode</span><span 
class="aett-10x-x-109">&#x00A0;kld</span>
<br class="fancyvrb" /><a 
 id="x14-69022r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;A</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;-1.8592</span><span 
class="aett-10x-x-109">&#x00A0;-2.1560</span><span 
class="aett-10x-x-109">&#x00A0;1.1414</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;-4.4299</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;-2.1555</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0.1122</span><span 
class="aett-10x-x-109">&#x00A0;-2.1543</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span>
<br class="fancyvrb" /><a 
 id="x14-69024r3"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;B</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;-0.8654</span><span 
class="aett-10x-x-109">&#x00A0;-1.1560</span><span 
class="aett-10x-x-109">&#x00A0;1.1414</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;-3.4299</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;-1.1555</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1.1122</span><span 
class="aett-10x-x-109">&#x00A0;-1.1543</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span>
<br class="fancyvrb" /><a 
 id="x14-69026r4"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;C</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0.1507</span><span 
class="aett-10x-x-109">&#x00A0;-0.1561</span><span 
class="aett-10x-x-109">&#x00A0;1.1414</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;-2.4300</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;-0.1555</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;2.1121</span><span 
class="aett-10x-x-109">&#x00A0;-0.1544</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span></div>
<!--l. 264--><p class="indent" >   The summary for the posterior marginal distribution of the temporal correlation
</p>
   <div class="fancyvrb" id="fancyvrb461"><a 
 id="x14-69028r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;round(res$summary.hy[3,],</span><span 
class="aesltt-10x-x-109">&#x00A0;5)</span></div>
<!--l. 270--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb462"><a 
 id="x14-69030r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;mean</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;sd</span><span 
class="aett-10x-x-109">&#x00A0;0.025quant</span><span 
class="aett-10x-x-109">&#x00A0;0.5quant</span><span 
class="aett-10x-x-109">&#x00A0;0.975quant</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;mode</span>
<br class="fancyvrb" /><a 
 id="x14-69032r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;GroupRho</span><span 
class="aett-10x-x-109">&#x00A0;for</span><span 
class="aett-10x-x-109">&#x00A0;i</span><span 
class="aett-10x-x-109">&#x00A0;0.72795</span><span 
class="aett-10x-x-109">&#x00A0;0.01606</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0.69542</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0.7283</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0.75846</span><span 
class="aett-10x-x-109">&#x00A0;0.72897</span></div>
<!--l. 276--><p class="indent" >   Getting the marginals distributions for random field parameters on the user scale
</p>
   <div class="fancyvrb" id="fancyvrb463"><a 
 id="x14-69034r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;rf</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde2.result(res,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">i</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;attr(x.k,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">spde</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">),</span><span 
class="aesltt-10x-x-109">&#x00A0;do.transf=TRUE)</span></div>
                                                                                 
                                                                                 
<!--l. 283--><p class="noindent" >and we see these distributions, also the marginal ditribution for the temporal correlation, on the
Figure&#x00A0;<a 
href="#x14-690612">10.2<!--tex4ht:ref: fig:rfst --></a> with the commands bellow
</p>
   <div class="fancyvrb" id="fancyvrb464"><a 
 id="x14-69036r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mfrow=c(2,2),</span><span 
class="aesltt-10x-x-109">&#x00A0;mar=c(3,3,1,0.1),</span><span 
class="aesltt-10x-x-109">&#x00A0;mgp=2:0)</span><br class="fancyvrb" /><a 
 id="x14-69038r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(res$marginals.hyper[[3]],</span><span 
class="aesltt-10x-x-109">&#x00A0;type=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">l</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span>
<br class="fancyvrb" /><a 
 id="x14-69040r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xlab=expression(beta),</span><span 
class="aesltt-10x-x-109">&#x00A0;ylab=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">Density</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)</span><br class="fancyvrb" /><a 
 id="x14-69042r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;abline(v=rho,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=2)</span>
<br class="fancyvrb" /><a 
 id="x14-69044r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(rf$marginals.variance.nominal[[1]],</span><span 
class="aesltt-10x-x-109">&#x00A0;type=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">l</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span>
<br class="fancyvrb" /><a 
 id="x14-69046r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xlab=expression(sigma[x]),</span><span 
class="aesltt-10x-x-109">&#x00A0;ylab=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">Density</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)</span><br class="fancyvrb" /><a 
 id="x14-69048r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;abline(v=params[1],</span><span 
class="aesltt-10x-x-109">&#x00A0;col=2)</span>
<br class="fancyvrb" /><a 
 id="x14-69050r8"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(rf$marginals.kappa[[1]],</span><span 
class="aesltt-10x-x-109">&#x00A0;type=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">l</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><br class="fancyvrb" /><a 
 id="x14-69052r9"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xlab=expression(kappa),</span><span 
class="aesltt-10x-x-109">&#x00A0;ylab=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">Density</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)</span>
<br class="fancyvrb" /><a 
 id="x14-69054r10"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;abline(v=params[2],</span><span 
class="aesltt-10x-x-109">&#x00A0;col=2)</span><br class="fancyvrb" /><a 
 id="x14-69056r11"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(rf$marginals.range.nominal[[1]],</span><span 
class="aesltt-10x-x-109">&#x00A0;type=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">l</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span>
<br class="fancyvrb" /><a 
 id="x14-69058r12"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xlab=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">range</span><span 
class="aesltt-10x-x-109">&#x00A0;nominal</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;ylab=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">Density</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)</span><br class="fancyvrb" /><a 
 id="x14-69060r13"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;abline(v=sqrt(8)/params[2],</span><span 
class="aesltt-10x-x-109">&#x00A0;col=2)</span></div>
<hr class="figure" /><div class="figure" 
><a 
 id="x14-690612"></a><img 
src="spde-tutorial86x.png" alt="PIC" class="graphics" width="320.09622pt" height="291.00539pt"  /><!--tex4ht:graphics  
name="spde-tutorial86x.png" src="figs/spacetime-027.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;10.2: </span><span  
class="content">Marginal posterior distribution for <span 
class="cmmi-10x-x-109">&#x03B2; </span>(top left), <span 
class="cmmi-10x-x-109">&#x03C3;</span><sub><span 
class="cmmi-8">x</span></sub> (top right), <span 
class="cmmi-10x-x-109">&#x03BA; </span>(bottom
left) and the nominal range (bottom right). The red vertical lines are placed at true value.</span></div><!--tex4ht:label?: x14-690612 -->
   </div><hr class="endfigure" />
<!--l. 314--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">10.1.4   </span> <a 
 id="x14-7000010.1.4"></a>A look at the posterior random field</h4>
<!--l. 316--><p class="noindent" >The first look at the random field posterior distribution is to compare the realized random field
with the posterior mean, median or/and mode and any quantile.
</p><!--l. 321--><p class="indent" >   First, we found the index for the random field at data locations
</p>
   <div class="fancyvrb" id="fancyvrb465"><a 
 id="x14-70002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;str(idat</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.stack.index(sdat,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">stdata</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)$data)</span></div>
<!--l. 327--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb466"><a 
 id="x14-70004r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;int</span><span 
class="aett-10x-x-109">&#x00A0;[1:3696]</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;2</span><span 
class="aett-10x-x-109">&#x00A0;3</span><span 
class="aett-10x-x-109">&#x00A0;4</span><span 
class="aett-10x-x-109">&#x00A0;5</span><span 
class="aett-10x-x-109">&#x00A0;6</span><span 
class="aett-10x-x-109">&#x00A0;7</span><span 
class="aett-10x-x-109">&#x00A0;8</span><span 
class="aett-10x-x-109">&#x00A0;9</span><span 
class="aett-10x-x-109">&#x00A0;10</span><span 
class="aett-10x-x-109">&#x00A0;...</span></div>
<!--l. 332--><p class="indent" >   The correlation between the simulated data response and the posterior mean of the predicted
values (there is no error term in the model):
                                                                                 
                                                                                 
</p>
   <div class="fancyvrb" id="fancyvrb467"><a 
 id="x14-70006r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;cor(dat$y,</span><span 
class="aesltt-10x-x-109">&#x00A0;res$summary.linear.predictor$mean[idat])</span></div>
<!--l. 339--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb468"><a 
 id="x14-70008r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;0.9999999</span></div>
<!--l. 344--><p class="indent" >   We also can do prediction for each time and visualize it. First, we define the projection grid
in the same way that on the example on Chapter&#x00A0;<a 
href="spde-tutorialch4.html#x8-320004">4<!--tex4ht:ref: ch:prprec --></a>.
</p>
   <div class="fancyvrb" id="fancyvrb469"><a 
 id="x14-70010r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;stepsize</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;4*1/111</span><br class="fancyvrb" /><a 
 id="x14-70012r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;nxy</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;round(c(diff(range(coords[,1])),</span><span 
class="aesltt-10x-x-109">&#x00A0;diff(range(coords[,2])))/stepsize)</span>
<br class="fancyvrb" /><a 
 id="x14-70014r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;projgrid</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.projector(prmesh1,</span><span 
class="aesltt-10x-x-109">&#x00A0;xlim=range(coords[,1]),</span>
<br class="fancyvrb" /><a 
 id="x14-70016r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;ylim=range(coords[,2]),</span><span 
class="aesltt-10x-x-109">&#x00A0;dims=nxy)</span></div>
<!--l. 356--><p class="indent" >   The prediction for each time can be done by
</p>
   <div class="fancyvrb" id="fancyvrb470"><a 
 id="x14-70018r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xmean</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;list()</span><br class="fancyvrb" /><a 
 id="x14-70020r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;for</span><span 
class="aesltt-10x-x-109">&#x00A0;(j</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;1:k)</span><br class="fancyvrb" /><a 
 id="x14-70022r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xmean[[j]]</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.project(</span>
<br class="fancyvrb" /><a 
 id="x14-70024r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;projgrid,</span><span 
class="aesltt-10x-x-109">&#x00A0;res$summary.random$i$mean[iset$i.group==j])</span></div>
<!--l. 366--><p class="indent" >   We found what points of the grid are inside the Paraná state border.
</p>
   <div class="fancyvrb" id="fancyvrb471"><a 
 id="x14-70026r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;require(splancs)</span><br class="fancyvrb" /><a 
 id="x14-70028r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xy.in</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inout(projgrid$lattice$loc,</span><span 
class="aesltt-10x-x-109">&#x00A0;cbind(PRborder[,1],</span><span 
class="aesltt-10x-x-109">&#x00A0;PRborder[,2]))</span></div>
<!--l. 374--><p class="noindent" >To plot, we set NA to the points of the grid out of the Paraná border.
</p>
   <div class="fancyvrb" id="fancyvrb472"><a 
 id="x14-70030r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;for</span><span 
class="aesltt-10x-x-109">&#x00A0;(j</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;1:k)</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xmean[[j]][!xy.in]</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;NA</span></div>
<!--l. 381--><p class="indent" >   The visualization at Figure&#x00A0;<a 
href="#x14-700393">10.3<!--tex4ht:ref: fig:strf --></a> can be made by the comands bellow
</p>
   <div class="fancyvrb" id="fancyvrb473"><a 
 id="x14-70032r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;require(gridExtra)</span><br class="fancyvrb" /><a 
 id="x14-70034r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;do.call(function(...)</span><span 
class="aesltt-10x-x-109">&#x00A0;grid.arrange(...,</span><span 
class="aesltt-10x-x-109">&#x00A0;nrow=4),</span>
<br class="fancyvrb" /><a 
 id="x14-70036r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;lapply(xmean,</span><span 
class="aesltt-10x-x-109">&#x00A0;levelplot,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xlab=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;ylab=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">,</span>
<br class="fancyvrb" /><a 
 id="x14-70038r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;col.regions=topo.colors(16),</span><span 
class="aesltt-10x-x-109">&#x00A0;scale=list(draw=FALSE)))</span></div>
                                                                                 
                                                                                 
<hr class="figure" /><div class="figure" 
><a 
 id="x14-700393"></a><img 
src="spde-tutorial87x.png" alt="PIC" class="graphics" width="422.52936pt" height="367.36697pt"  /><!--tex4ht:graphics  
name="spde-tutorial87x.png" src="figs/spacetime-vstrf.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;10.3: </span><span  
class="content">Visualization of the posterior mean of the space-time random field.</span></div><!--tex4ht:label?: x14-700393 -->
   </div><hr class="endfigure" />
<!--l. 399--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">10.1.5   </span> <a 
 id="x14-7100010.1.5"></a>Validation</h4>
<!--l. 401--><p class="noindent" >The results on previous section are done using part of the simulated data. This part of the
simulated data is now used as a validation data. So, we prepare another data stack to compute
posterior distributions to this part of the data:
</p>
   <div class="fancyvrb" id="fancyvrb474"><a 
 id="x14-71002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;vdat</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;data.frame(r=as.vector(y),</span><span 
class="aesltt-10x-x-109">&#x00A0;w=ccov,</span><span 
class="aesltt-10x-x-109">&#x00A0;t=rep(1:k,</span><span 
class="aesltt-10x-x-109">&#x00A0;each=n),</span>
<br class="fancyvrb" /><a 
 id="x14-71004r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;x=rep(coords[,1],</span><span 
class="aesltt-10x-x-109">&#x00A0;k),</span><span 
class="aesltt-10x-x-109">&#x00A0;y=rep(coords[,2],</span><span 
class="aesltt-10x-x-109">&#x00A0;k))[-isel,</span><span 
class="aesltt-10x-x-109">&#x00A0;]</span>
<br class="fancyvrb" /><a 
 id="x14-71006r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;Aval</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde.make.A(prmesh1,</span><span 
class="aesltt-10x-x-109">&#x00A0;loc=cbind(vdat$x,</span><span 
class="aesltt-10x-x-109">&#x00A0;vdat$y),</span><span 
class="aesltt-10x-x-109">&#x00A0;group=vdat$t)</span>
<br class="fancyvrb" /><a 
 id="x14-71008r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;stval</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.stack(tag=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">stval</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;data=list(y=NA),</span><span 
class="aesltt-10x-x-109">&#x00A0;###</span><span 
class="aesltt-10x-x-109">&#x00A0;set</span><span 
class="aesltt-10x-x-109">&#x00A0;NA</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;order</span><span 
class="aesltt-10x-x-109">&#x00A0;to</span><span 
class="aesltt-10x-x-109">&#x00A0;predict</span>
<br class="fancyvrb" /><a 
 id="x14-71010r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;A=list(Aval,1),</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;effects=list(iset,</span><span 
class="aesltt-10x-x-109">&#x00A0;w=vdat$w))</span></div>
<!--l. 414--><p class="indent" >   Now, we just use a full data stack to fit the model and consider the hyperparameters values
fitted before
</p>
   <div class="fancyvrb" id="fancyvrb475"><a 
 id="x14-71012r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;stfull</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.stack(sdat,</span><span 
class="aesltt-10x-x-109">&#x00A0;stval)</span><br class="fancyvrb" /><a 
 id="x14-71014r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;vres</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla(formulae,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;data=inla.stack.data(stfull),</span>
<br class="fancyvrb" /><a 
 id="x14-71016r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.predictor=list(compute=TRUE,</span><span 
class="aesltt-10x-x-109">&#x00A0;A=inla.stack.A(stfull)),</span>
<br class="fancyvrb" /><a 
 id="x14-71018r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.family=list(initial=10,</span><span 
class="aesltt-10x-x-109">&#x00A0;fixed=TRUE),</span>
<br class="fancyvrb" /><a 
 id="x14-71020r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.fixed=list(expand.factor.strategy=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">inla</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">),</span>
<br class="fancyvrb" /><a 
 id="x14-71022r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.mode=list(theta=res$mode$theta,</span><span 
class="aesltt-10x-x-109">&#x00A0;restart=FALSE))</span></div>
                                                                                 
                                                                                 
<!--l. 427--><p class="indent" >   We can plot the predicted versus observed values to look at goodness of fit. First, we found
the index for this data from full stack data.
</p>
   <div class="fancyvrb" id="fancyvrb476"><a 
 id="x14-71024r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;ival</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.stack.index(stfull,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">stval</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)$data</span></div>
<!--l. 434--><p class="noindent" >We plot it with following commands and visualize at Figure&#x00A0;<a 
href="#x14-710334">10.4<!--tex4ht:ref: fig:stval --></a>.
</p>
   <div class="fancyvrb" id="fancyvrb477"><a 
 id="x14-71026r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mfrow=c(1,1),</span><span 
class="aesltt-10x-x-109">&#x00A0;mar=c(3,3,0.5,0.5),</span><span 
class="aesltt-10x-x-109">&#x00A0;mgp=c(1.75,0.5,0))</span>
<br class="fancyvrb" /><a 
 id="x14-71028r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(vres$summary.fitted.values$mean[ival],</span><span 
class="aesltt-10x-x-109">&#x00A0;vdat$r,</span>
<br class="fancyvrb" /><a 
 id="x14-71030r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;asp=1,</span><span 
class="aesltt-10x-x-109">&#x00A0;xlab=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">Posterior</span><span 
class="aesltt-10x-x-109">&#x00A0;mean</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;ylab=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">Observed</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)</span><br class="fancyvrb" /><a 
 id="x14-71032r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;abline(0:1,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=gray(.7))</span></div>
<hr class="figure" /><div class="figure" 
><a 
 id="x14-710334"></a><img 
src="spde-tutorial88x.png" alt="PIC" class="graphics" width="192.05643pt" height="174.5933pt"  /><!--tex4ht:graphics  
name="spde-tutorial88x.png" src="figs/spacetime-vstval.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;10.4: </span><span  
class="content">Validation: Observed versus posterior mean.</span></div><!--tex4ht:label?: x14-710334 -->
   </div><hr class="endfigure" />
<!--l. 449--><p class="noindent" >
</p>
   <h3 class="sectionHead"><span class="titlemark">10.2   </span> <a 
 id="x14-7200010.2"></a>Continuous time domain</h3>
<!--l. 451--><p class="noindent" >We now suppose that we have that the observations are not collected over discrete
time points. This is the case for fishing data and space-time point process in general.
Similar to the Finite Method approach for the space, we can use piecewise linear basis
function at a set of time knots, as we have in some other examples in Chapters <a 
href="spde-tutorialch11.html#x15-7600011">11<!--tex4ht:ref: ch:lowst --></a> and
<a 
href="spde-tutorialch14.html#x18-8500014">14<!--tex4ht:ref: ch:stpp --></a>.
</p><!--l. 457--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">10.2.1   </span> <a 
 id="x14-7300010.2.1"></a>Data simulation</h4>
<!--l. 459--><p class="noindent" >We now sample some locations over space and time points as well.
</p>
   <div class="fancyvrb" id="fancyvrb478"><a 
 id="x14-73002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;n</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;nrow(loc</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;unique(as.matrix(PRprec[,1:2])))</span><br class="fancyvrb" /><a 
 id="x14-73004r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;time</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;sort(runif(n,</span><span 
class="aesltt-10x-x-109">&#x00A0;0,</span><span 
class="aesltt-10x-x-109">&#x00A0;1))</span></div>
<!--l. 467--><p class="indent" >   To sample from the model, we define a space-time separable covariance function, which is
Matérn in space and Exponential over time:
</p>
   <div class="fancyvrb" id="fancyvrb479"><a 
 id="x14-73006r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;stcov</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;function(coords,</span><span 
class="aesltt-10x-x-109">&#x00A0;time,</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa.s,</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa.t,</span><span 
class="aesltt-10x-x-109">&#x00A0;variance=1,</span><span 
class="aesltt-10x-x-109">&#x00A0;nu=1)</span><span 
class="aesltt-10x-x-109">&#x00A0;{</span>
<br class="fancyvrb" /><a 
 id="x14-73008r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;s</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;as.matrix(dist(coords))</span><br class="fancyvrb" /><a 
 id="x14-73010r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;t</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;as.matrix(dist(time))</span>
<br class="fancyvrb" /><a 
 id="x14-73012r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;scorr</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;exp((1-nu)*log(2)</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;nu*log(s*kappa.s)</span><span 
class="aesltt-10x-x-109">&#x00A0;-</span><span 
class="aesltt-10x-x-109">&#x00A0;lgamma(nu))</span><span 
class="aesltt-10x-x-109">&#x00A0;*</span>
<br class="fancyvrb" /><a 
 id="x14-73014r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;besselK(s*kappa.s,</span><span 
class="aesltt-10x-x-109">&#x00A0;nu)</span><br class="fancyvrb" /><a 
 id="x14-73016r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;diag(scorr)</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;1</span>
<br class="fancyvrb" /><a 
 id="x14-73018r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;return(variance</span><span 
class="aesltt-10x-x-109">&#x00A0;*</span><span 
class="aesltt-10x-x-109">&#x00A0;scorr</span><span 
class="aesltt-10x-x-109">&#x00A0;*</span><span 
class="aesltt-10x-x-109">&#x00A0;exp(-t*kappa.t))</span><br class="fancyvrb" /><a 
 id="x14-73020r8"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;}</span></div>
                                                                                 
                                                                                 
<!--l. 481--><p class="noindent" >and use it to sample from the model
</p>
   <div class="fancyvrb" id="fancyvrb480"><a 
 id="x14-73022r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa.s</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;3;</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa.t</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;5;</span><span 
class="aesltt-10x-x-109">&#x00A0;s2</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;1/2;</span><span 
class="aesltt-10x-x-109">&#x00A0;taue</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;3</span>
<br class="fancyvrb" /><a 
 id="x14-73024r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;y</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;crossprod(chol(stcov(loc,</span><span 
class="aesltt-10x-x-109">&#x00A0;time,</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa.s,</span><span 
class="aesltt-10x-x-109">&#x00A0;kappa.t,</span><span 
class="aesltt-10x-x-109">&#x00A0;s2)),</span><span 
class="aesltt-10x-x-109">&#x00A0;rnorm(n))</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span>
<br class="fancyvrb" /><a 
 id="x14-73026r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;rnorm(n,</span><span 
class="aesltt-10x-x-109">&#x00A0;0,</span><span 
class="aesltt-10x-x-109">&#x00A0;sqrt(1/taue))</span></div>
<!--l. 490--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">10.2.2   </span> <a 
 id="x14-7400010.2.2"></a>Data stack preparation</h4>
<!--l. 492--><p class="noindent" >To fit the space-time continuous model we need to determine the time knots and the temporal
mesh
</p>
   <div class="fancyvrb" id="fancyvrb481"><a 
 id="x14-74002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;k</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;10</span><br class="fancyvrb" /><a 
 id="x14-74004r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;(mesh.t</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.1d(seq(0+0.5/k,</span><span 
class="aesltt-10x-x-109">&#x00A0;1-0.5/k,</span><span 
class="aesltt-10x-x-109">&#x00A0;length=k)))$loc</span></div>
<!--l. 498--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb482"><a 
 id="x14-74006r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;0.05</span><span 
class="aett-10x-x-109">&#x00A0;0.15</span><span 
class="aett-10x-x-109">&#x00A0;0.25</span><span 
class="aett-10x-x-109">&#x00A0;0.35</span><span 
class="aett-10x-x-109">&#x00A0;0.45</span><span 
class="aett-10x-x-109">&#x00A0;0.55</span><span 
class="aett-10x-x-109">&#x00A0;0.65</span><span 
class="aett-10x-x-109">&#x00A0;0.75</span><span 
class="aett-10x-x-109">&#x00A0;0.85</span><span 
class="aett-10x-x-109">&#x00A0;0.95</span></div>
<!--l. 503--><p class="indent" >   We build the mesh based in the domain and points
</p>
   <div class="fancyvrb" id="fancyvrb483"><a 
 id="x14-74008r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;(mesh.s</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(loc,</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=1.5,</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.25,</span><span 
class="aesltt-10x-x-109">&#x00A0;offset=1.5))$n</span></div>
<!--l. 508--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb484"><a 
 id="x14-74010r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;230</span></div>
<!--l. 512--><p class="noindent" >We use the spatial mesh built in Chapter&#x00A0;<a 
href="spde-tutorialch2.html#x6-100002.2">2.2<!--tex4ht:ref: ch:mesh --></a> and define the SPDE model object
</p>
   <div class="fancyvrb" id="fancyvrb485"><a 
 id="x14-74012r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;spde</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde2.matern(mesh.s)</span></div>
<!--l. 524--><p class="indent" >   Building the index set
</p>
   <div class="fancyvrb" id="fancyvrb486"><a 
 id="x14-74014r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;iset</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde.make.index(</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">i</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;n.spde=spde$n.spde,</span><span 
class="aesltt-10x-x-109">&#x00A0;n.group=k)</span></div>
<!--l. 531--><p class="indent" >   The projector matrix consider the spatial and time projection. So, it needs the spatial mesh
and the spatial locations, the time points and the temporal mesh
</p>
   <div class="fancyvrb" id="fancyvrb487"><a 
 id="x14-74016r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;A</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde.make.A(mesh=mesh.s,</span><span 
class="aesltt-10x-x-109">&#x00A0;loc=loc,</span>
<br class="fancyvrb" /><a 
 id="x14-74018r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;group=time,</span><span 
class="aesltt-10x-x-109">&#x00A0;group.mesh=mesh.t)</span></div>
<!--l. 541--><p class="indent" >   The effects on the stack are a list with two elements, one is the index set and another the
categorical covariate. The stack data is defined as
</p>
   <div class="fancyvrb" id="fancyvrb488"><a 
 id="x14-74020r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;sdat</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.stack(tag=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">stdata</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;data=list(y=y),</span>
<br class="fancyvrb" /><a 
 id="x14-74022r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;A=list(A,1),</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;effects=list(iset,</span><span 
class="aesltt-10x-x-109">&#x00A0;list(b0=rep(1,n))))</span></div>
                                                                                 
                                                                                 
<!--l. 551--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">10.2.3   </span> <a 
 id="x14-7500010.2.3"></a>Fitting the model and some results</h4>
<!--l. 553--><p class="noindent" >We used an Exponential correlation function for time with parameter <span 
class="cmmi-10x-x-109">&#x03BA; </span>as the inverse range
parameter. It gives a correlation between time knots equals to
</p>
   <div class="fancyvrb" id="fancyvrb489"><a 
 id="x14-75002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;exp(-kappa.t*diff(mesh.t$loc[1:2]))</span></div>
<!--l. 559--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb490"><a 
 id="x14-75004r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;0.6065307</span></div>
<!--l. 564--><p class="indent" >   Fitting the model
</p>
   <div class="fancyvrb" id="fancyvrb491"><a 
 id="x14-75006r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;formulae</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;y</span><span 
class="aesltt-10x-x-109">&#x00A0;~</span><span 
class="aesltt-10x-x-109">&#x00A0;0</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;b0</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><br class="fancyvrb" /><a 
 id="x14-75008r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;f(i,</span><span 
class="aesltt-10x-x-109">&#x00A0;model=spde,</span><span 
class="aesltt-10x-x-109">&#x00A0;group=i.group,</span>
<br class="fancyvrb" /><a 
 id="x14-75010r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.group=list(model=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">ar1</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">))</span><br class="fancyvrb" /><a 
 id="x14-75012r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;res</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla(formulae,</span><span 
class="aesltt-10x-x-109">&#x00A0;data=inla.stack.data(sdat),</span>
<br class="fancyvrb" /><a 
 id="x14-75014r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.predictor=list(compute=TRUE,</span><span 
class="aesltt-10x-x-109">&#x00A0;A=inla.stack.A(sdat)))</span></div>
<!--l. 575--><p class="indent" >   Getting the marginals distributions for random field parameters in the user scale:
</p>
   <div class="fancyvrb" id="fancyvrb492"><a 
 id="x14-75016r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;rf</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde2.result(res,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">i</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;spde,</span><span 
class="aesltt-10x-x-109">&#x00A0;do.transf=TRUE)</span></div>
<!--l. 582--><p class="indent" >   These distributions are showed in Figure&#x00A0;<a 
href="#x14-750475">10.5<!--tex4ht:ref: fig:stcpost --></a>, as well also the marginal ditribution
for the intercept, error precision and the temporal correlation, with the commands
bellow
</p>
   <div class="fancyvrb" id="fancyvrb493"><a 
 id="x14-75018r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mfrow=c(2,3),</span><span 
class="aesltt-10x-x-109">&#x00A0;mar=c(3,3,1,0.1),</span><span 
class="aesltt-10x-x-109">&#x00A0;mgp=2:0)</span><br class="fancyvrb" /><a 
 id="x14-75020r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(res$marginals.fixed[[1]],</span><span 
class="aesltt-10x-x-109">&#x00A0;type=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">l</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span>
<br class="fancyvrb" /><a 
 id="x14-75022r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xlab=expression(beta[0]),</span><span 
class="aesltt-10x-x-109">&#x00A0;ylab=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">Density</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)</span>
<br class="fancyvrb" /><a 
 id="x14-75024r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;abline(v=0,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=2)</span><br class="fancyvrb" /><a 
 id="x14-75026r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(res$marginals.hyper[[1]],</span><span 
class="aesltt-10x-x-109">&#x00A0;type=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">l</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span>
<br class="fancyvrb" /><a 
 id="x14-75028r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xlab=expression(tau[e]),</span><span 
class="aesltt-10x-x-109">&#x00A0;ylab=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">Density</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)</span><br class="fancyvrb" /><a 
 id="x14-75030r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;abline(v=taue,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=2)</span>
<br class="fancyvrb" /><a 
 id="x14-75032r8"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(res$marginals.hyper[[4]],</span><span 
class="aesltt-10x-x-109">&#x00A0;type=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">l</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><br class="fancyvrb" /><a 
 id="x14-75034r9"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xlab=expression(beta),</span><span 
class="aesltt-10x-x-109">&#x00A0;ylab=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">Density</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)</span>
<br class="fancyvrb" /><a 
 id="x14-75036r10"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;abline(v=exp(-kappa.t*diff(mesh.t$loc[1:2])),</span><span 
class="aesltt-10x-x-109">&#x00A0;col=2)</span><br class="fancyvrb" /><a 
 id="x14-75038r11"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;for</span><span 
class="aesltt-10x-x-109">&#x00A0;(j</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;15:17)</span><span 
class="aesltt-10x-x-109">&#x00A0;{</span>
<br class="fancyvrb" /><a 
 id="x14-75040r12"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(rf[[j]][[1]],</span><span 
class="aesltt-10x-x-109">&#x00A0;type=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">l</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;ylab=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">Density</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><br class="fancyvrb" /><a 
 id="x14-75042r13"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xlab=substring(names(rf)[j],11))</span>
<br class="fancyvrb" /><a 
 id="x14-75044r14"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;abline(v=c(kappa.s,s2,sqrt(8)/kappa.s)[j-14],</span><span 
class="aesltt-10x-x-109">&#x00A0;col=2)</span><br class="fancyvrb" /><a 
 id="x14-75046r15"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;}</span></div>
<hr class="figure" /><div class="figure" 
><a 
 id="x14-750475"></a><img 
src="spde-tutorial89x.png" alt="PIC" class="graphics" width="384.11285pt" height="256.08673pt"  /><!--tex4ht:graphics  
name="spde-tutorial89x.png" src="figs/spacetime-054.eps"  
-->
                                                                                 
                                                                                 
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;10.5: </span><span  
class="content">Marginal posterior distribution for the intercept, likelihood precision and
the parameters in the space-time process.</span></div><!--tex4ht:label?: x14-750475 -->
   </div><hr class="endfigure" />
                                                                                 
                                                                                 
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="spde-tutorialch11.html" >next</a>] [<a 
href="spde-tutorialch9.html" >prev</a>] [<a 
href="spde-tutorialch9.html#tailspde-tutorialch9.html" >prev-tail</a>] [<a 
href="spde-tutorialch10.html" >front</a>] [<a 
href="spde-tutorial3.html#spde-tutorialch10.html" >up</a>] </p></div>
<!--l. 1--><p class="indent" >   <a 
 id="tailspde-tutorialch10.html"></a>   </p> 
</body></html> 
