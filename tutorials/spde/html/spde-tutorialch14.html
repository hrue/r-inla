<?xml version="1.0" encoding="iso-8859-1" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head><title>14 Space-time log-Cox process</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)" /> 
<!-- xhtml,html,frames,2 --> 
<meta name="src" content="spde-tutorial.tex" /> 
<meta name="date" content="2017-01-22 14:18:00" /> 
<link rel="stylesheet" type="text/css" href="spde-tutorial.css" /> 
</head><body 
>
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="spde-tutorialch15.html" >next</a>] [<a 
href="spde-tutorialch13.html" >prev</a>] [<a 
href="spde-tutorialch13.html#tailspde-tutorialch13.html" >prev-tail</a>] [<a 
href="#tailspde-tutorialch14.html">tail</a>] [<a 
href="spde-tutorial3.html#spde-tutorialch14.html" >up</a>] </p></div>
   <h2 class="chapterHead"><span class="titlemark">Chapter&#x00A0;14</span><br /><a 
 id="x18-8500014"></a>Space-time log-Cox process</h2>
<!--l. 5--><p class="noindent" >In this chapter we show how to fit a spatio temporal log-Cox point process model. In
Section&#x00A0;<a 
href="#x18-8600014.1">14.1<!--tex4ht:ref: sec:burkitt --></a> we have an example. In Section&#x00A0;<a 
href="#x18-8700014.2">14.2<!--tex4ht:ref: sec:lstpp --></a> we show an approach to deal with large data
sets.
</p>
   <h3 class="sectionHead"><span class="titlemark">14.1   </span> <a 
 id="x18-8600014.1"></a>Burkitt example</h3>
<!--l. 5--><p class="noindent" >We use the <span 
class="aett-10x-x-109">burkitt </span>data set from the <span 
class="aeb10-x-x-109">splancs </span>package.
</p><!--l. 8--><p class="indent" >
</p>
   <div class="fancyvrb" id="fancyvrb557"><a 
 id="x18-86002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;data(</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">burkitt</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;package=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">splancs</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)</span><br class="fancyvrb" /><a 
 id="x18-86004r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;t(sapply(burkitt[,</span><span 
class="aesltt-10x-x-109">&#x00A0;1:3],</span><span 
class="aesltt-10x-x-109">&#x00A0;summary))</span></div>
<!--l. 12--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb558"><a 
 id="x18-86006r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Min.</span><span 
class="aett-10x-x-109">&#x00A0;1st</span><span 
class="aett-10x-x-109">&#x00A0;Qu.</span><span 
class="aett-10x-x-109">&#x00A0;Median</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Mean</span><span 
class="aett-10x-x-109">&#x00A0;3rd</span><span 
class="aett-10x-x-109">&#x00A0;Qu.</span><span 
class="aett-10x-x-109">&#x00A0;Max.</span><br class="fancyvrb" /><a 
 id="x18-86008r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;x</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;255</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;269.0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;282.5</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;286.3</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;300.2</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;335</span>
<br class="fancyvrb" /><a 
 id="x18-86010r3"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;y</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;247</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;326.8</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;344.5</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;338.8</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;362.0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;399</span><br class="fancyvrb" /><a 
 id="x18-86012r4"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;t</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;413</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;2412.0</span><span 
class="aett-10x-x-109">&#x00A0;3704.0</span><span 
class="aett-10x-x-109">&#x00A0;3530.0</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;4700.0</span><span 
class="aett-10x-x-109">&#x00A0;5775</span></div>
<!--l. 20--><p class="indent" >   The folowing commands shows the time when each event occurred, Figure&#x00A0;<a 
href="#x18-860291">14.1<!--tex4ht:ref: fig:timeshow --></a>.
</p>
   <div class="fancyvrb" id="fancyvrb559"><a 
 id="x18-86014r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;n</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;nrow(burkitt)</span><br class="fancyvrb" /><a 
 id="x18-86016r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mfrow=c(1,1),</span><span 
class="aesltt-10x-x-109">&#x00A0;mar=c(1.5,.1,.1,.1),</span><span 
class="aesltt-10x-x-109">&#x00A0;mgp=c(2,0.7,0))</span>
<br class="fancyvrb" /><a 
 id="x18-86018r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(burkitt$t,</span><span 
class="aesltt-10x-x-109">&#x00A0;rep(1,n),</span><span 
class="aesltt-10x-x-109">&#x00A0;type=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">h</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;ylim=0:1,</span><span 
class="aesltt-10x-x-109">&#x00A0;axes=FALSE,</span><span 
class="aesltt-10x-x-109">&#x00A0;xlab=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;ylab=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">)</span><br class="fancyvrb" /><a 
 id="x18-86020r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;box();</span><span 
class="aesltt-10x-x-109">&#x00A0;axis(1)</span></div>
<!--l. 30--><p class="indent" >   We have to define a set of knots over time in order to fit SPDE spatio temporal model. It is
then used to built a temporal mesh
</p>
   <div class="fancyvrb" id="fancyvrb560"><a 
 id="x18-86022r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;k</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;6</span><br class="fancyvrb" /><a 
 id="x18-86024r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;tknots</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;seq(min(burkitt$t),</span><span 
class="aesltt-10x-x-109">&#x00A0;max(burkitt$t),</span><span 
class="aesltt-10x-x-109">&#x00A0;length=k)</span>
<br class="fancyvrb" /><a 
 id="x18-86026r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;abline(v=tknots,</span><span 
class="aesltt-10x-x-109">&#x00A0;lwd=4,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=4)</span><span 
class="aesltt-10x-x-109">&#x00A0;##</span><span 
class="aesltt-10x-x-109">&#x00A0;add</span><span 
class="aesltt-10x-x-109">&#x00A0;to</span><span 
class="aesltt-10x-x-109">&#x00A0;plot</span><br class="fancyvrb" /><a 
 id="x18-86028r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh.t</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.1d(tknots)</span></div>
   <hr class="figure" /><div class="figure" 
>
                                                                                 
                                                                                 
<a 
 id="x18-860291"></a>
                                                                                 
                                                                                 
<!--l. 44--><p class="noindent" ><img 
src="spde-tutorial99x.png" alt="PIC" class="graphics" width="422.52936pt" height="84.50613pt"  /><!--tex4ht:graphics  
name="spde-tutorial99x.png" src="figs/burkitt-timeplot.eps"  
-->
<br /> </p><div class="caption" 
><span class="id">Figure&#x00A0;14.1: </span><span  
class="content">Time when each event occurred (black) and knots used for inference (blue).</span></div><!--tex4ht:label?: x18-860291 -->
                                                                                 
                                                                                 
   </div><hr class="endfigure" />
<!--l. 49--><p class="indent" >   To work with the space, we first define a function to convert a polygon defined from a set of
coordinates to an <span 
class="aett-10x-x-109">SpatialPolygons </span>object:
</p>
   <div class="fancyvrb" id="fancyvrb561"><a 
 id="x18-86031r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;coo2sp</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;function(coo)</span><span 
class="aesltt-10x-x-109">&#x00A0;{</span><br class="fancyvrb" /><a 
 id="x18-86033r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;n</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;nrow(coo)</span>
<br class="fancyvrb" /><a 
 id="x18-86035r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;if</span><span 
class="aesltt-10x-x-109">&#x00A0;(any(coo[1,]!=coo[n,]))</span><br class="fancyvrb" /><a 
 id="x18-86037r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;coo</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;coo[c(1:n,1),]</span>
<br class="fancyvrb" /><a 
 id="x18-86039r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;SpatialPolygons(list(Polygons(list(Polygon(coo)),</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">0</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)))</span><br class="fancyvrb" /><a 
 id="x18-86041r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;}</span></div>
<!--l. 61--><p class="indent" >   The spatial mesh can be done using the polygon of the region as a boundary
</p>
   <div class="fancyvrb" id="fancyvrb562"><a 
 id="x18-86043r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;domainSP</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;coo2sp(burbdy)</span><br class="fancyvrb" /><a 
 id="x18-86045r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh.s</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(burpts,</span><span 
class="aesltt-10x-x-109">&#x00A0;boundary=inla.sp2segment(domainSP),</span>
<br class="fancyvrb" /><a 
 id="x18-86047r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=c(25,</span><span 
class="aesltt-10x-x-109">&#x00A0;50),</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=10)</span><span 
class="aesltt-10x-x-109">&#x00A0;###</span><span 
class="aesltt-10x-x-109">&#x00A0;just</span><span 
class="aesltt-10x-x-109">&#x00A0;a</span><span 
class="aesltt-10x-x-109">&#x00A0;crude</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh</span></div>
<!--l. 70--><p class="indent" >   The SPDE model is defined using the spatial mesh as usual
</p>
   <div class="fancyvrb" id="fancyvrb563"><a 
 id="x18-86049r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;(spde</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde2.matern(mesh.s))$n.spde</span></div>
<!--l. 77--><p class="indent" >   The spatio temporal projector matrix is made considering both spatial and temporal
locations and both spatial and temporal meshes.
</p>
   <div class="fancyvrb" id="fancyvrb564"><a 
 id="x18-86051r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;dim(Ast</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde.make.A(mesh=mesh.s,</span><span 
class="aesltt-10x-x-109">&#x00A0;loc=burpts,</span><span 
class="aesltt-10x-x-109">&#x00A0;n.group=length(mesh.t$n),</span>
<br class="fancyvrb" /><a 
 id="x18-86053r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;group=burkitt$t,</span><span 
class="aesltt-10x-x-109">&#x00A0;group.mesh=mesh.t))</span></div>
<div class="fancyvrb" id="fancyvrb565"><a 
 id="x18-86055r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;188</span><span 
class="aett-10x-x-109">&#x00A0;708</span></div>
<!--l. 88--><p class="noindent" >Internally <span 
class="aett-10x-x-109">inla.spde.make.A </span>function makes a row Kronecker product (see <span 
class="aett-10x-x-109">inla.row.kron</span>)
between the spatial projector and the group (temporal in our case) projector. This matrix has
number of columns equals to the number of nodes in the mesh times the number of
groups.
</p><!--l. 92--><p class="indent" >   The index set is made considering the group feature:
</p>
   <div class="fancyvrb" id="fancyvrb566"><a 
 id="x18-86057r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;idx</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde.make.index(</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">s</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;spde$n.spde,</span><span 
class="aesltt-10x-x-109">&#x00A0;n.group=mesh.t$n)</span></div>
<!--l. 99--><p class="indent" >   The data stack can be made considering the ideas for the purerly spatial model. So, we do
need to consider the expected number of cases at the 1) integration points and 2) data
locations. The first is now the spacetime volume at the mesh node and time knot,
which is the area of each Voronoi polygon around the mesh location kronecker the
length of the time window at each time point. The second is zero as for a point the
expectation is zero, in accord to the likelihood approximation proposed by <span class="cite">[<a 
href="spde-tutorialli2.html#Xsimpsonetal:2011">Simpson et&#x00A0;al.,
2011</a>]</span>.
</p><!--l. 108--><p class="indent" >   We need to build the Voronoi polygons. Using a function from the <span 
class="aessbx-10x-x-109">deldir </span>package:
</p>
   <div class="fancyvrb" id="fancyvrb567"><a 
 id="x18-86059r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;require(deldir)</span><br class="fancyvrb" /><a 
 id="x18-86061r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;dd</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;deldir(mesh.s$loc[,1],</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh.s$loc[,2])</span><br class="fancyvrb" /><a 
 id="x18-86063r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;tiles</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;tile.list(dd)</span></div>
<!--l. 118--><p class="indent" >   The area of the intersection between each Voronoi polygons and the domain region can be
done using the <span 
class="aett-10x-x-109">gIntersects </span>function from <span 
class="aessbx-10x-x-109">rgeos </span>package. To use it we define a function to
convert each Voronoi polygon into a <span 
class="aett-10x-x-109">SpatialPolygons </span>and use the <span 
class="aett-10x-x-109">gIntersects</span>
function. It is done in the code below (show the sum of the intersection polygons
areas):
                                                                                 
                                                                                 
</p>
   <div class="fancyvrb" id="fancyvrb568"><a 
 id="x18-86065r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;require(rgeos)</span><br class="fancyvrb" /><a 
 id="x18-86067r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;sum(w</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;sapply(tiles,</span><span 
class="aesltt-10x-x-109">&#x00A0;function(p)</span><span 
class="aesltt-10x-x-109">&#x00A0;{</span>
<br class="fancyvrb" /><a 
 id="x18-86069r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;pl</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;coo2sp(cbind(p$x,</span><span 
class="aesltt-10x-x-109">&#x00A0;p$y))</span>
<br class="fancyvrb" /><a 
 id="x18-86071r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;if</span><span 
class="aesltt-10x-x-109">&#x00A0;(gIntersects(pl,</span><span 
class="aesltt-10x-x-109">&#x00A0;domainSP))</span>
<br class="fancyvrb" /><a 
 id="x18-86073r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;return(gArea(gIntersection(pl,</span><span 
class="aesltt-10x-x-109">&#x00A0;domainSP)))</span>
<br class="fancyvrb" /><a 
 id="x18-86075r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;else</span><span 
class="aesltt-10x-x-109">&#x00A0;return(0)</span><br class="fancyvrb" /><a 
 id="x18-86077r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;}))</span></div>
<div class="fancyvrb" id="fancyvrb569"><a 
 id="x18-86079r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;11035.01</span></div>
<!--l. 137--><p class="noindent" >We can see that it sum up the same as the domain area:
</p>
   <div class="fancyvrb" id="fancyvrb570"><a 
 id="x18-86081r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;gArea(domainSP)</span></div>
<div class="fancyvrb" id="fancyvrb571"><a 
 id="x18-86083r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;11035.01</span></div>
<!--l. 147--><p class="indent" >   The spatio temporal volume is the product of these values and the time window length of
each time knot.
</p>
   <div class="fancyvrb" id="fancyvrb572"><a 
 id="x18-86085r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;st.vol</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;rep(w,</span><span 
class="aesltt-10x-x-109">&#x00A0;k)</span><span 
class="aesltt-10x-x-109">&#x00A0;*</span><span 
class="aesltt-10x-x-109">&#x00A0;rep(diag(inla.mesh.fem(mesh.t)$c0),</span><span 
class="aesltt-10x-x-109">&#x00A0;m)</span></div>
<!--l. 154--><p class="indent" >   The data stack is built using
</p>
   <div class="fancyvrb" id="fancyvrb573"><a 
 id="x18-86087r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;y</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;rep(0:1,</span><span 
class="aesltt-10x-x-109">&#x00A0;c(k</span><span 
class="aesltt-10x-x-109">&#x00A0;*</span><span 
class="aesltt-10x-x-109">&#x00A0;m,</span><span 
class="aesltt-10x-x-109">&#x00A0;n))</span><br class="fancyvrb" /><a 
 id="x18-86089r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;expected</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;c(st.vol,</span><span 
class="aesltt-10x-x-109">&#x00A0;rep(0,</span><span 
class="aesltt-10x-x-109">&#x00A0;n))</span>
<br class="fancyvrb" /><a 
 id="x18-86091r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;stk</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.stack(data=list(y=y,</span><span 
class="aesltt-10x-x-109">&#x00A0;expect=expected),</span><br class="fancyvrb" /><a 
 id="x18-86093r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;A=list(rBind(Diagonal(n=k*m),</span><span 
class="aesltt-10x-x-109">&#x00A0;Ast),</span><span 
class="aesltt-10x-x-109">&#x00A0;1),</span>
<br class="fancyvrb" /><a 
 id="x18-86095r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;effects=list(idx,</span><span 
class="aesltt-10x-x-109">&#x00A0;list(a0=rep(1,</span><span 
class="aesltt-10x-x-109">&#x00A0;k*m</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;n))))</span></div>
<!--l. 165--><p class="indent" >   Model fitting (using the cruder approximation: &#8217;gaussian&#8217;)
</p>
   <div class="fancyvrb" id="fancyvrb574"><a 
 id="x18-86097r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;form</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;y</span><span 
class="aesltt-10x-x-109">&#x00A0;~</span><span 
class="aesltt-10x-x-109">&#x00A0;0</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;a0</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><br class="fancyvrb" /><a 
 id="x18-86099r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;f(s,</span><span 
class="aesltt-10x-x-109">&#x00A0;model=spde,</span><span 
class="aesltt-10x-x-109">&#x00A0;group=s.group,</span><span 
class="aesltt-10x-x-109">&#x00A0;control.group=list(model=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">ar1</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">))</span>
<br class="fancyvrb" /><a 
 id="x18-86101r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;burk.res</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla(form,</span><span 
class="aesltt-10x-x-109">&#x00A0;family=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">poisson</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><br class="fancyvrb" /><a 
 id="x18-86103r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;data=inla.stack.data(stk),</span><span 
class="aesltt-10x-x-109">&#x00A0;E=expect,</span>
<br class="fancyvrb" /><a 
 id="x18-86105r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.predictor=list(A=inla.stack.A(stk)),</span>
<br class="fancyvrb" /><a 
 id="x18-86107r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.inla=list(strategy=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">gaussian</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">))</span></div>
<!--l. 177--><p class="indent" >   The exponential of the intercept plus the random effect at each spacetime integration point is
the relative risk at each these points. This relative risk times the spacetime volume will give the
expected number of points at each these spacetime locations. Summing it will approaches the
number of observations:
</p>
   <div class="fancyvrb" id="fancyvrb575"><a 
 id="x18-86109r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;eta.at.integration.points</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;burk.res$summary.fix[1,1]</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;burk.res$summary.ran$s$mean</span>
<br class="fancyvrb" /><a 
 id="x18-86111r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;c(n=n,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">E(n)</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">=sum(st.vol*exp(eta.at.integration.points)))</span></div>
<div class="fancyvrb" id="fancyvrb576"><a 
 id="x18-86113r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;n</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;E(n)</span><br class="fancyvrb" /><a 
 id="x18-86115r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;188.0000</span><span 
class="aett-10x-x-109">&#x00A0;187.2886</span></div>
<!--l. 209--><p class="indent" >   The projection over a grid for each time knot can be done with
</p>
   <div class="fancyvrb" id="fancyvrb577"><a 
 id="x18-86117r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;r0</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;diff(range(burbdy[,1]))/diff(range(burbdy[,2]))</span>
<br class="fancyvrb" /><a 
 id="x18-86119r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;prj</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.projector(mesh.s,</span><span 
class="aesltt-10x-x-109">&#x00A0;xlim=range(burbdy[,1]),</span>
<br class="fancyvrb" /><a 
 id="x18-86121r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;ylim=range(burbdy[,2]),</span><span 
class="aesltt-10x-x-109">&#x00A0;dims=c(100,</span><span 
class="aesltt-10x-x-109">&#x00A0;100/r0))</span>
<br class="fancyvrb" /><a 
 id="x18-86123r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;ov</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;over(SpatialPoints(prj$lattice$loc),</span><span 
class="aesltt-10x-x-109">&#x00A0;domainSP)</span><br class="fancyvrb" /><a 
 id="x18-86125r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;m.prj</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;lapply(1:k,</span><span 
class="aesltt-10x-x-109">&#x00A0;function(j)</span><span 
class="aesltt-10x-x-109">&#x00A0;{</span>
<br class="fancyvrb" /><a 
 id="x18-86127r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;r</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.project(prj,</span><span 
class="aesltt-10x-x-109">&#x00A0;burk.res$summary.ran$s$mean[1:m+(j-1)*m])</span>
<br class="fancyvrb" /><a 
 id="x18-86129r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;r[is.na(ov)]</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;NA;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;return(r)</span><br class="fancyvrb" /><a 
 id="x18-86131r8"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;})</span></div>
                                                                                 
                                                                                 
<!--l. 223--><p class="indent" >   The fitted latent field at each time knot is in Figure&#x00A0;<a 
href="#x18-861482">14.2<!--tex4ht:ref: fig:stppres --></a>, produced with the code below. It
can also be done for the standard deviation.
</p>
   <div class="fancyvrb" id="fancyvrb578"><a 
 id="x18-86133r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;igr</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;apply(abs(outer(burkitt$t,</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh.t$loc,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">-</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)),</span><span 
class="aesltt-10x-x-109">&#x00A0;1,</span><span 
class="aesltt-10x-x-109">&#x00A0;which.min)</span>
<br class="fancyvrb" /><a 
 id="x18-86135r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;zlm</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;range(unlist(m.prj),</span><span 
class="aesltt-10x-x-109">&#x00A0;na.rm=TRUE)</span><br class="fancyvrb" /><a 
 id="x18-86137r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mfrow=c(2,3),</span><span 
class="aesltt-10x-x-109">&#x00A0;mar=c(0,0,0,0))</span>
<br class="fancyvrb" /><a 
 id="x18-86139r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;for</span><span 
class="aesltt-10x-x-109">&#x00A0;(j</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;1:k)</span><span 
class="aesltt-10x-x-109">&#x00A0;{</span><br class="fancyvrb" /><a 
 id="x18-86141r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;image(x=prj$x,</span><span 
class="aesltt-10x-x-109">&#x00A0;y=prj$y,</span><span 
class="aesltt-10x-x-109">&#x00A0;z=m.prj[[j]],</span><span 
class="aesltt-10x-x-109">&#x00A0;asp=1,</span>
<br class="fancyvrb" /><a 
 id="x18-86143r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xlab=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;zlim=zlm,</span><span 
class="aesltt-10x-x-109">&#x00A0;axes=FALSE,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=tim.colors(64))</span>
<br class="fancyvrb" /><a 
 id="x18-86145r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;points(burkitt[igr==j,</span><span 
class="aesltt-10x-x-109">&#x00A0;1:2],</span><span 
class="aesltt-10x-x-109">&#x00A0;pch=19)</span><br class="fancyvrb" /><a 
 id="x18-86147r8"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;};</span><span 
class="aesltt-10x-x-109">&#x00A0;image.plot(legend.only=TRUE,</span><span 
class="aesltt-10x-x-109">&#x00A0;zlim=zlm,</span><span 
class="aesltt-10x-x-109">&#x00A0;legend.mar=5)</span></div>
<hr class="figure" /><div class="figure" 
><a 
 id="x18-861482"></a><img 
src="spde-tutorial100x.png" alt="PIC" class="graphics" width="422.52936pt" height="591.55072pt"  /><!--tex4ht:graphics  
name="spde-tutorial100x.png" src="figs/burkitt-stppres.eps"  
-->
                                                                                 
                                                                                 
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;14.2: </span><span  
class="content">Fitted latent field at each time knot overlayed by the points closer in time.</span></div><!--tex4ht:label?: x18-861482 -->
   </div><hr class="endfigure" />
   <h3 class="sectionHead"><span class="titlemark">14.2   </span> <a 
 id="x18-8700014.2"></a>Large data set</h3>
<!--l. 14--><p class="noindent" >We are going to drawn samples from a separable space time intensity function.
</p><!--l. 16--><p class="indent" >   First we define the spatial domain as follows
</p>
   <div class="fancyvrb" id="fancyvrb579"><a 
 id="x18-87002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;x0</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;seq(0,</span><span 
class="aesltt-10x-x-109">&#x00A0;4*pi,</span><span 
class="aesltt-10x-x-109">&#x00A0;length=15)</span><br class="fancyvrb" /><a 
 id="x18-87004r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;domain</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;data.frame(x=c(x0,</span><span 
class="aesltt-10x-x-109">&#x00A0;rev(x0),</span><span 
class="aesltt-10x-x-109">&#x00A0;0))</span>
<br class="fancyvrb" /><a 
 id="x18-87006r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;domain$y</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;c(sin(x0/2)-2,</span><span 
class="aesltt-10x-x-109">&#x00A0;sin(rev(x0/2))+2,</span><span 
class="aesltt-10x-x-109">&#x00A0;sin(0)-2)</span></div>
<!--l. 24--><p class="noindent" >and convert it into the <span 
class="aett-10x-x-109">SpatialPolygons </span>class
</p>
   <div class="fancyvrb" id="fancyvrb580"><a 
 id="x18-87008r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;library(sp)</span><br class="fancyvrb" /><a 
 id="x18-87010r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;domainSP</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;SpatialPolygons(list(Polygons(list(Polygon(domain)),</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">0</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">)))</span></div>
<!--l. 32--><p class="indent" >   We choose to sample a dataset using the <span 
class="aessbx-10x-x-109">lgcp</span>, <span class="cite">[<a 
href="spde-tutorialli2.html#XtaylorDRD:2013">Taylor et&#x00A0;al., 2013</a>]</span>, package as
follows
</p>
   <div class="fancyvrb" id="fancyvrb581"><a 
 id="x18-87012r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;library(lgcp)</span><br class="fancyvrb" /><a 
 id="x18-87014r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;ndays</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;15</span><br class="fancyvrb" /><a 
 id="x18-87016r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;n</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;(xyt</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;lgcpSim(</span>
<br class="fancyvrb" /><a 
 id="x18-87018r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;owin=spatstat:::owin(poly=domain),</span><span 
class="aesltt-10x-x-109">&#x00A0;tlim=c(0,ndays),</span>
<br class="fancyvrb" /><a 
 id="x18-87020r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;model.parameters=lgcppars(1,0.5,0.1,0,0.5),</span><span 
class="aesltt-10x-x-109">&#x00A0;cellwidth=0.1,</span>
<br class="fancyvrb" /><a 
 id="x18-87022r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;spatial.covmodel=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">matern</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;covpars=c(nu=1)))$n</span></div>
<!--l. 45--><p class="indent" >   In order to fit the model, we do need to define a discretization over space and over
time. For the time domain, we define a temporal mesh based on a number of time
knots:
</p>
   <div class="fancyvrb" id="fancyvrb582"><a 
 id="x18-87024r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;k</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;7;</span><span 
class="aesltt-10x-x-109">&#x00A0;tmesh</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.1d(seq(0,</span><span 
class="aesltt-10x-x-109">&#x00A0;ndays,</span><span 
class="aesltt-10x-x-109">&#x00A0;length=k))</span></div>
<!--l. 52--><p class="noindent" >The spatial mesh is defined using the domain polygon:
</p>
   <div class="fancyvrb" id="fancyvrb583"><a 
 id="x18-87026r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;smesh</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.2d(boundary=inla.sp2segment(domainSP),</span>
<br class="fancyvrb" /><a 
 id="x18-87028r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;max.edge=1,</span><span 
class="aesltt-10x-x-109">&#x00A0;cutoff=0.3)</span></div>
<!--l. 60--><p class="indent" >   We can have a look in Figure&#x00A0;<a 
href="#x18-870433">14.3<!--tex4ht:ref: fig:stlppshow --></a> to see a plot of a sample of the data over time, the time
knots and over space and the spatial mesh as well with the commands below
</p>
   <div class="fancyvrb" id="fancyvrb584"><a 
 id="x18-87030r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mfrow=c(2,1),</span><span 
class="aesltt-10x-x-109">&#x00A0;mar=c(1.5,0,0,0),</span><span 
class="aesltt-10x-x-109">&#x00A0;mgp=c(1,0.5,0))</span>
<br class="fancyvrb" /><a 
 id="x18-87032r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(sample(xyt$t,500),</span><span 
class="aesltt-10x-x-109">&#x00A0;rep(1,500),</span><span 
class="aesltt-10x-x-109">&#x00A0;type=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">h</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;ylim=0:1,</span>
<br class="fancyvrb" /><a 
 id="x18-87034r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;xlab=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">Day</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;ylab=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;axes=FALSE);</span><span 
class="aesltt-10x-x-109">&#x00A0;box();</span><span 
class="aesltt-10x-x-109">&#x00A0;axis(1)</span><br class="fancyvrb" /><a 
 id="x18-87036r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;abline(v=tmesh$loc,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=4,</span><span 
class="aesltt-10x-x-109">&#x00A0;lwd=3)</span>
<br class="fancyvrb" /><a 
 id="x18-87038r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mar=c(0,0,0,0))</span><br class="fancyvrb" /><a 
 id="x18-87040r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;plot(smesh,</span><span 
class="aesltt-10x-x-109">&#x00A0;asp=1,</span><span 
class="aesltt-10x-x-109">&#x00A0;main=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">)</span><br class="fancyvrb" /><a 
 id="x18-87042r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;points(xyt$x,</span><span 
class="aesltt-10x-x-109">&#x00A0;xyt$y,</span><span 
class="aesltt-10x-x-109">&#x00A0;cex=0.5,</span><span 
class="aesltt-10x-x-109">&#x00A0;pch=3)</span></div>
<hr class="figure" /><div class="figure" 
><a 
 id="x18-870433"></a><img 
src="spde-tutorial101x.png" alt="PIC" class="graphics" width="422.52936pt" height="169.01227pt"  /><!--tex4ht:graphics  
name="spde-tutorial101x.png" src="figs/stpp-stfit.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;14.3: </span><span  
class="content">Time for a sample of the events (black), time knots (blue) in the upper plot.
Spatial locations of a sample on the spatial domain (botton plot).</span></div><!--tex4ht:label?: x18-870433 -->
   </div><hr class="endfigure" />
<!--l. 81--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">14.2.1   </span> <a 
 id="x18-8800014.2.1"></a>Space-time aggregation</h4>
<!--l. 83--><p class="noindent" >For large datasets it can be computationally demanding to fit the model. The problem is
because the dimention of the model would be <span 
class="cmmi-10x-x-109">n </span><span 
class="cmr-10x-x-109">+ </span><span 
class="cmmi-10x-x-109">m</span><span 
class="cmsy-10x-x-109">*</span><span 
class="cmmi-10x-x-109">k</span>, where <span 
class="cmmi-10x-x-109">n </span>is the number of data points, <span 
class="cmmi-10x-x-109">m</span>
is the number of nodes in the mesh, <span 
class="cmmi-10x-x-109">k </span>is the number of time knots. In this section we choose to
aggregate the data in a way that we have a problem with dimention <span 
class="cmr-10x-x-109">2 </span><span 
class="cmsy-10x-x-109">*</span><span 
class="cmmi-10x-x-109">m</span><span 
class="cmsy-10x-x-109">*</span><span 
class="cmmi-10x-x-109">k</span>. So, this approach
really makes sence when <span 
class="cmmi-10x-x-109">n &#x003E;&#x003E; m </span><span 
class="cmsy-10x-x-109">* </span><span 
class="cmmi-10x-x-109">k</span>.
</p><!--l. 91--><p class="indent" >   We choose to aggregate the data in accord to the integration points to make the fitting
process easier. So, firt we find the Voronoi polygons for the mesh nodes
</p>
   <div class="fancyvrb" id="fancyvrb585"><a 
 id="x18-88002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;library(deldir)</span><br class="fancyvrb" /><a 
 id="x18-88004r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;dd</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;deldir(smesh$loc[,1],</span><span 
class="aesltt-10x-x-109">&#x00A0;smesh$loc[,2])</span><br class="fancyvrb" /><a 
 id="x18-88006r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;tiles</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;tile.list(dd)</span></div>
<!--l. 100--><p class="noindent" >Convert it into <span 
class="aett-10x-x-109">SpatialPolygons</span>:
</p>
   <div class="fancyvrb" id="fancyvrb586"><a 
 id="x18-88008r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;polys</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;SpatialPolygons(lapply(1:length(tiles),</span><span 
class="aesltt-10x-x-109">&#x00A0;function(i)</span>
<br class="fancyvrb" /><a 
 id="x18-88010r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;{</span><span 
class="aesltt-10x-x-109">&#x00A0;p</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;cbind(tiles[[i]]$x,</span><span 
class="aesltt-10x-x-109">&#x00A0;tiles[[i]]$y)</span><br class="fancyvrb" /><a 
 id="x18-88012r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;n</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;nrow(p)</span>
<br class="fancyvrb" /><a 
 id="x18-88014r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;Polygons(list(Polygon(p[c(1:n,</span><span 
class="aesltt-10x-x-109">&#x00A0;1),])),</span><span 
class="aesltt-10x-x-109">&#x00A0;i)</span><br class="fancyvrb" /><a 
 id="x18-88016r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;}))</span></div>
<!--l. 111--><p class="indent" >   Find to which polygon belongs each data point:
</p>
   <div class="fancyvrb" id="fancyvrb587"><a 
 id="x18-88018r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;area</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;factor(over(SpatialPoints(cbind(xyt$x,</span><span 
class="aesltt-10x-x-109">&#x00A0;xyt$y)),</span>
<br class="fancyvrb" /><a 
 id="x18-88020r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;polys),</span><span 
class="aesltt-10x-x-109">&#x00A0;levels=1:length(polys))</span></div>
<!--l. 118--><p class="noindent" >Fint to which part of the time mesh belongs each data point:
</p>
   <div class="fancyvrb" id="fancyvrb588"><a 
 id="x18-88022r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;t.breaks</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;sort(c(tmesh$loc[c(1,k)],</span><br class="fancyvrb" /><a 
 id="x18-88024r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;tmesh$loc[2:k-1]/2</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;tmesh$loc[2:k]/2))</span>
<br class="fancyvrb" /><a 
 id="x18-88026r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;table(time</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;factor(findInterval(xyt$t,</span><span 
class="aesltt-10x-x-109">&#x00A0;t.breaks),</span>
<br class="fancyvrb" /><a 
 id="x18-88028r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;levels=1:(length(t.breaks)-1)))</span></div>
<!--l. 126--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb589"><a 
 id="x18-88030r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;2</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;3</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;4</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;5</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;6</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;7</span><br class="fancyvrb" /><a 
 id="x18-88032r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;164</span><span 
class="aett-10x-x-109">&#x00A0;377</span><span 
class="aett-10x-x-109">&#x00A0;419</span><span 
class="aett-10x-x-109">&#x00A0;427</span><span 
class="aett-10x-x-109">&#x00A0;434</span><span 
class="aett-10x-x-109">&#x00A0;336</span><span 
class="aett-10x-x-109">&#x00A0;176</span></div>
<!--l. 131--><p class="noindent" >Use these both identification index sets to aggregate the data
</p>
   <div class="fancyvrb" id="fancyvrb590"><a 
 id="x18-88034r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;agg.dat</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;as.data.frame(table(area,</span><span 
class="aesltt-10x-x-109">&#x00A0;time))</span><br class="fancyvrb" /><a 
 id="x18-88036r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;for(j</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;1:2)</span><span 
class="aesltt-10x-x-109">&#x00A0;###</span><span 
class="aesltt-10x-x-109">&#x00A0;set</span><span 
class="aesltt-10x-x-109">&#x00A0;time</span><span 
class="aesltt-10x-x-109">&#x00A0;and</span><span 
class="aesltt-10x-x-109">&#x00A0;area</span><span 
class="aesltt-10x-x-109">&#x00A0;as</span><span 
class="aesltt-10x-x-109">&#x00A0;integer</span>
<br class="fancyvrb" /><a 
 id="x18-88038r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;agg.dat[[j]]</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;as.integer(as.character(agg.dat[[j]]))</span><br class="fancyvrb" /><a 
 id="x18-88040r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;str(agg.dat)</span></div>
<!--l. 139--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb591"><a 
 id="x18-88042r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">data.frame</span><span 
class="tctt-1095">'</span><span 
class="aett-10x-x-109">:        1064</span><span 
class="aett-10x-x-109">&#x00A0;obs.</span><span 
class="aett-10x-x-109">&#x00A0;of</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;3</span><span 
class="aett-10x-x-109">&#x00A0;variables:</span><br class="fancyvrb" /><a 
 id="x18-88044r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;$</span><span 
class="aett-10x-x-109">&#x00A0;area:</span><span 
class="aett-10x-x-109">&#x00A0;int</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;2</span><span 
class="aett-10x-x-109">&#x00A0;3</span><span 
class="aett-10x-x-109">&#x00A0;4</span><span 
class="aett-10x-x-109">&#x00A0;5</span><span 
class="aett-10x-x-109">&#x00A0;6</span><span 
class="aett-10x-x-109">&#x00A0;7</span><span 
class="aett-10x-x-109">&#x00A0;8</span><span 
class="aett-10x-x-109">&#x00A0;9</span><span 
class="aett-10x-x-109">&#x00A0;10</span><span 
class="aett-10x-x-109">&#x00A0;...</span>
<br class="fancyvrb" /><a 
 id="x18-88046r3"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;$</span><span 
class="aett-10x-x-109">&#x00A0;time:</span><span 
class="aett-10x-x-109">&#x00A0;int</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;...</span><br class="fancyvrb" /><a 
 id="x18-88048r4"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;$</span><span 
class="aett-10x-x-109">&#x00A0;Freq:</span><span 
class="aett-10x-x-109">&#x00A0;int</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;2</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;1</span><span 
class="aett-10x-x-109">&#x00A0;0</span><span 
class="aett-10x-x-109">&#x00A0;...</span></div>
<!--l. 147--><p class="indent" >   We need to define the expected number of cases (at least) proportional to the area of the
Polygons times the width length of the time knots. Compute the intersection area of each
polygon with the domain (show the sum).
                                                                                 
                                                                                 
</p>
   <div class="fancyvrb" id="fancyvrb592"><a 
 id="x18-88050r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;library(rgeos)</span><br class="fancyvrb" /><a 
 id="x18-88052r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;sum(w.areas</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;sapply(1:length(tiles),</span><span 
class="aesltt-10x-x-109">&#x00A0;function(i)</span>
<br class="fancyvrb" /><a 
 id="x18-88054r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;{</span><span 
class="aesltt-10x-x-109">&#x00A0;p</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;cbind(tiles[[i]]$x,</span><span 
class="aesltt-10x-x-109">&#x00A0;tiles[[i]]$y)</span><br class="fancyvrb" /><a 
 id="x18-88056r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;n</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;nrow(p)</span>
<br class="fancyvrb" /><a 
 id="x18-88058r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;pl</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;SpatialPolygons(list(Polygons(list(Polygon(p[c(1:n,</span><span 
class="aesltt-10x-x-109">&#x00A0;1),])),</span><span 
class="aesltt-10x-x-109">&#x00A0;i)))</span>
<br class="fancyvrb" /><a 
 id="x18-88060r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;if</span><span 
class="aesltt-10x-x-109">&#x00A0;(gIntersects(pl,</span><span 
class="aesltt-10x-x-109">&#x00A0;domainSP))</span><br class="fancyvrb" /><a 
 id="x18-88062r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;return(gArea(gIntersection(pl,</span><span 
class="aesltt-10x-x-109">&#x00A0;domainSP)))</span>
<br class="fancyvrb" /><a 
 id="x18-88064r8"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;else</span><span 
class="aesltt-10x-x-109">&#x00A0;return(0)</span><br class="fancyvrb" /><a 
 id="x18-88066r9"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;}))</span></div>
<!--l. 161--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb593"><a 
 id="x18-88068r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;50.26548</span></div>
<!--l. 166--><p class="indent" >   A summary of the polygons area is
</p>
   <div class="fancyvrb" id="fancyvrb594"><a 
 id="x18-88070r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;summary(w.areas)</span></div>
<!--l. 171--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb595"><a 
 id="x18-88072r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Min.</span><span 
class="aett-10x-x-109">&#x00A0;1st</span><span 
class="aett-10x-x-109">&#x00A0;Qu.</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Median</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Mean</span><span 
class="aett-10x-x-109">&#x00A0;3rd</span><span 
class="aett-10x-x-109">&#x00A0;Qu.</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Max.</span><br class="fancyvrb" /><a 
 id="x18-88074r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0.06293</span><span 
class="aett-10x-x-109">&#x00A0;0.21780</span><span 
class="aett-10x-x-109">&#x00A0;0.35040</span><span 
class="aett-10x-x-109">&#x00A0;0.33070</span><span 
class="aett-10x-x-109">&#x00A0;0.41160</span><span 
class="aett-10x-x-109">&#x00A0;0.69310</span></div>
<!--l. 176--><p class="noindent" >and the area of the spatial domain is
</p>
   <div class="fancyvrb" id="fancyvrb596"><a 
 id="x18-88076r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;gArea(domainSP)</span></div>
<!--l. 181--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb597"><a 
 id="x18-88078r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;50.26548</span></div>
<!--l. 185--><p class="noindent" >The time length (domain) is 365 and the width of each knot is
</p>
   <div class="fancyvrb" id="fancyvrb598"><a 
 id="x18-88080r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;(w.t</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;diag(inla.mesh.fem(tmesh)$c0))</span></div>
<!--l. 190--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb599"><a 
 id="x18-88082r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;1.25</span><span 
class="aett-10x-x-109">&#x00A0;2.50</span><span 
class="aett-10x-x-109">&#x00A0;2.50</span><span 
class="aett-10x-x-109">&#x00A0;2.50</span><span 
class="aett-10x-x-109">&#x00A0;2.50</span><span 
class="aett-10x-x-109">&#x00A0;2.50</span><span 
class="aett-10x-x-109">&#x00A0;1.25</span></div>
<!--l. 194--><p class="noindent" >where the knots at boundary are with less width than the internal ones.
</p><!--l. 196--><p class="indent" >   Since the intensity function is the number of cases per volumn unit, with <span 
class="cmmi-10x-x-109">n </span>cases the
intensity varies around the average number of cases (intensity) by unit volumn
</p>
   <div class="fancyvrb" id="fancyvrb600"><a 
 id="x18-88084r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;(i0</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;n</span><span 
class="aesltt-10x-x-109">&#x00A0;/</span><span 
class="aesltt-10x-x-109">&#x00A0;(gArea(domainSP)</span><span 
class="aesltt-10x-x-109">&#x00A0;*</span><span 
class="aesltt-10x-x-109">&#x00A0;diff(range(tmesh$loc))))</span></div>
<!--l. 202--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb601"><a 
 id="x18-88086r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;[1]</span><span 
class="aett-10x-x-109">&#x00A0;3.094237</span></div>
<!--l. 206--><p class="noindent" >and this value is related to an intercept in the model we fit below. The space-time volumn (area unit
per time unit) at each polygon and time knot is
</p>
   <div class="fancyvrb" id="fancyvrb602"><a 
 id="x18-88088r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;summary(e0</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;w.areas[agg.dat$area]</span><span 
class="aesltt-10x-x-109">&#x00A0;*</span><span 
class="aesltt-10x-x-109">&#x00A0;(w.t[agg.dat$time]))</span></div>
<!--l. 212--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb603"><a 
 id="x18-88090r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Min.</span><span 
class="aett-10x-x-109">&#x00A0;1st</span><span 
class="aett-10x-x-109">&#x00A0;Qu.</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Median</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Mean</span><span 
class="aett-10x-x-109">&#x00A0;3rd</span><span 
class="aett-10x-x-109">&#x00A0;Qu.</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;Max.</span><br class="fancyvrb" /><a 
 id="x18-88092r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0.07866</span><span 
class="aett-10x-x-109">&#x00A0;0.45690</span><span 
class="aett-10x-x-109">&#x00A0;0.64780</span><span 
class="aett-10x-x-109">&#x00A0;0.70860</span><span 
class="aett-10x-x-109">&#x00A0;0.97130</span><span 
class="aett-10x-x-109">&#x00A0;1.73300</span></div>
                                                                                 
                                                                                 
<!--l. 218--><p class="noindent" >
</p>
   <h4 class="subsectionHead"><span class="titlemark">14.2.2   </span> <a 
 id="x18-8900014.2.2"></a>Model fit</h4>
<!--l. 220--><p class="noindent" >The projector matrix, SPDE model object and the space-time index set definition:
</p>
   <div class="fancyvrb" id="fancyvrb604"><a 
 id="x18-89002r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;A.st</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde.make.A(smesh,</span><span 
class="aesltt-10x-x-109">&#x00A0;smesh$loc[agg.dat$area,],</span>
<br class="fancyvrb" /><a 
 id="x18-89004r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;group=agg.dat$time,</span><span 
class="aesltt-10x-x-109">&#x00A0;mesh.group=tmesh)</span>
<br class="fancyvrb" /><a 
 id="x18-89006r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;spde</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde2.matern(smesh)</span><br class="fancyvrb" /><a 
 id="x18-89008r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;idx</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.spde.make.index(</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">s</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><span 
class="aesltt-10x-x-109">&#x00A0;spde$n.spde,</span><span 
class="aesltt-10x-x-109">&#x00A0;n.group=k)</span></div>
<!--l. 230--><p class="indent" >   Defining the data stack
</p>
   <div class="fancyvrb" id="fancyvrb605"><a 
 id="x18-89010r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;stk</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.stack(data=list(y=agg.dat$Freq,</span><span 
class="aesltt-10x-x-109">&#x00A0;exposure=e0),</span>
<br class="fancyvrb" /><a 
 id="x18-89012r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;A=list(A.st,</span><span 
class="aesltt-10x-x-109">&#x00A0;1),</span><br class="fancyvrb" /><a 
 id="x18-89014r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;effects=list(idx,</span>
<br class="fancyvrb" /><a 
 id="x18-89016r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;list(b0=rep(1,</span><span 
class="aesltt-10x-x-109">&#x00A0;nrow(agg.dat)))))</span></div>
<!--l. 239--><p class="noindent" >the formula
</p>
   <div class="fancyvrb" id="fancyvrb606"><a 
 id="x18-89018r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;formula</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;y</span><span 
class="aesltt-10x-x-109">&#x00A0;~</span><span 
class="aesltt-10x-x-109">&#x00A0;0</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;b0</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><br class="fancyvrb" /><a 
 id="x18-89020r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;f(s,</span><span 
class="aesltt-10x-x-109">&#x00A0;model=spde,</span><span 
class="aesltt-10x-x-109">&#x00A0;group=s.group,</span><span 
class="aesltt-10x-x-109">&#x00A0;control.group=list(model=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">ar1</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">))</span></div>
<!--l. 246--><p class="noindent" >and fitting the model
</p>
   <div class="fancyvrb" id="fancyvrb607"><a 
 id="x18-89022r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;res</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla(formula,</span><span 
class="aesltt-10x-x-109">&#x00A0;family=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">poisson</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">,</span><br class="fancyvrb" /><a 
 id="x18-89024r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;data=inla.stack.data(stk),</span><span 
class="aesltt-10x-x-109">&#x00A0;E=exposure,</span>
<br class="fancyvrb" /><a 
 id="x18-89026r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.predictor=list(A=inla.stack.A(stk)),</span>
<br class="fancyvrb" /><a 
 id="x18-89028r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;control.inla=list(strategy=</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">gaussian</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">))</span></div>
<!--l. 256--><p class="indent" >   The log of the average intensity and the intercept summary:
</p>
   <div class="fancyvrb" id="fancyvrb608"><a 
 id="x18-89030r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;round(cbind(true=log(i0),</span><span 
class="aesltt-10x-x-109">&#x00A0;res$summary.fixed),4)</span></div>
<!--l. 261--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb609"><a 
 id="x18-89032r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;true</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;mean</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;sd</span><span 
class="aett-10x-x-109">&#x00A0;0.025quant</span><span 
class="aett-10x-x-109">&#x00A0;0.5quant</span><span 
class="aett-10x-x-109">&#x00A0;0.975quant</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;mode</span><span 
class="aett-10x-x-109">&#x00A0;kld</span>
<br class="fancyvrb" /><a 
 id="x18-89034r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;b0</span><span 
class="aett-10x-x-109">&#x00A0;1.1295</span><span 
class="aett-10x-x-109">&#x00A0;0.892</span><span 
class="aett-10x-x-109">&#x00A0;0.1184</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0.6521</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0.8938</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;1.122</span><span 
class="aett-10x-x-109">&#x00A0;0.8971</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;0</span></div>
<!--l. 266--><p class="noindent" >The expected number of cases at each integration point can be used to compute the total expected
number of cases
</p>
   <div class="fancyvrb" id="fancyvrb610"><a 
 id="x18-89036r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;eta.i</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;res$summary.fix[1,1]</span><span 
class="aesltt-10x-x-109">&#x00A0;+</span><span 
class="aesltt-10x-x-109">&#x00A0;res$summary.ran$s$mean</span>
<br class="fancyvrb" /><a 
 id="x18-89038r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;c(n=xyt$n,</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">E(n)</span><span 
class="tcst-1095">'</span><span 
class="aesltt-10x-x-109">=sum(rep(w.areas,</span><span 
class="aesltt-10x-x-109">&#x00A0;k)*rep(w.t,</span><span 
class="aesltt-10x-x-109">&#x00A0;each=smesh$n)*exp(eta.i)))</span></div>
<!--l. 272--><p class="noindent" >
</p>
   <div class="fancyvrb" id="fancyvrb611"><a 
 id="x18-89040r1"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;n</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;E(n)</span><br class="fancyvrb" /><a 
 id="x18-89042r2"></a><span 
class="aett-10x-x-109">&#x00A0;</span><span 
class="aett-10x-x-109">&#x00A0;2333.000</span><span 
class="aett-10x-x-109">&#x00A0;2331.928</span></div>
<!--l. 278--><p class="indent" >   The spatial surface at each time knot can be computed by
</p>
   <div class="fancyvrb" id="fancyvrb612"><a 
 id="x18-89044r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;r0</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;diff(range(domain[,1]))/diff(range(domain[,2]))</span>
<br class="fancyvrb" /><a 
 id="x18-89046r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;prj</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.projector(smesh,</span><span 
class="aesltt-10x-x-109">&#x00A0;xlim=bbox(domainSP)[1,],</span>
<br class="fancyvrb" /><a 
 id="x18-89048r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;ylim=bbox(domainSP)[2,],</span><span 
class="aesltt-10x-x-109">&#x00A0;dims=c(r0*200,</span><span 
class="aesltt-10x-x-109">&#x00A0;200))</span>
<br class="fancyvrb" /><a 
 id="x18-89050r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;g.no.in</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;is.na(over(SpatialPoints(prj$lattice$loc),</span><span 
class="aesltt-10x-x-109">&#x00A0;domainSP))</span><br class="fancyvrb" /><a 
 id="x18-89052r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;t.mean</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;lapply(1:k,</span><span 
class="aesltt-10x-x-109">&#x00A0;function(j)</span><span 
class="aesltt-10x-x-109">&#x00A0;{</span>
<br class="fancyvrb" /><a 
 id="x18-89054r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;z</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;inla.mesh.project(prj,</span><span 
class="aesltt-10x-x-109">&#x00A0;res$summary.ran$s$mean[idx$s.group==j])</span>
<br class="fancyvrb" /><a 
 id="x18-89056r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;z[g.no.in]</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;NA</span><br class="fancyvrb" /><a 
 id="x18-89058r8"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;return(z)</span><br class="fancyvrb" /><a 
 id="x18-89060r9"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;})</span></div>
                                                                                 
                                                                                 
<!--l. 292--><p class="noindent" >and is visualized in Figure&#x00A0;<a 
href="#x18-890814">14.4<!--tex4ht:ref: fig:lstppsres --></a> is visualized by
</p>
   <div class="fancyvrb" id="fancyvrb613"><a 
 id="x18-89062r1"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;zlims</span><span 
class="aesltt-10x-x-109">&#x00A0;&#x003C;-</span><span 
class="aesltt-10x-x-109">&#x00A0;range(unlist(t.mean),</span><span 
class="aesltt-10x-x-109">&#x00A0;na.rm=TRUE)</span><br class="fancyvrb" /><a 
 id="x18-89064r2"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;library(fields)</span>
<br class="fancyvrb" /><a 
 id="x18-89066r3"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;par(mfrow=c(4,2),</span><span 
class="aesltt-10x-x-109">&#x00A0;mar=c(0.1,0.1,0.1,0.1))</span><br class="fancyvrb" /><a 
 id="x18-89068r4"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;for</span><span 
class="aesltt-10x-x-109">&#x00A0;(j</span><span 
class="aesltt-10x-x-109">&#x00A0;in</span><span 
class="aesltt-10x-x-109">&#x00A0;1:k)</span><span 
class="aesltt-10x-x-109">&#x00A0;{</span>
<br class="fancyvrb" /><a 
 id="x18-89070r5"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;image(prj$x,</span><span 
class="aesltt-10x-x-109">&#x00A0;prj$y,</span><span 
class="aesltt-10x-x-109">&#x00A0;t.mean[[j]],</span><br class="fancyvrb" /><a 
 id="x18-89072r6"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;axes=FALSE,</span><span 
class="aesltt-10x-x-109">&#x00A0;zlim=zlims,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=tim.colors(30))</span>
<br class="fancyvrb" /><a 
 id="x18-89074r7"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;points(xyt$x[time==j],</span><span 
class="aesltt-10x-x-109">&#x00A0;xyt$y[time==j],</span><span 
class="aesltt-10x-x-109">&#x00A0;cex=0.1)</span><br class="fancyvrb" /><a 
 id="x18-89076r8"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;}</span>
<br class="fancyvrb" /><a 
 id="x18-89078r9"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;image.plot(prj$x,</span><span 
class="aesltt-10x-x-109">&#x00A0;prj$y,</span><span 
class="aesltt-10x-x-109">&#x00A0;t.mean[[j]]+1e9,</span><span 
class="aesltt-10x-x-109">&#x00A0;axes=FALSE,</span><span 
class="aesltt-10x-x-109">&#x00A0;zlim=zlims,</span><span 
class="aesltt-10x-x-109">&#x00A0;xlab=</span><span 
class="tcst-1095">''</span><span 
class="aesltt-10x-x-109">,</span>
<br class="fancyvrb" /><a 
 id="x18-89080r10"></a><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;</span><span 
class="aesltt-10x-x-109">&#x00A0;legend.mar=10,</span><span 
class="aesltt-10x-x-109">&#x00A0;legend.width=5,</span><span 
class="aesltt-10x-x-109">&#x00A0;col=tim.colors(30),</span><span 
class="aesltt-10x-x-109">&#x00A0;horizontal=T)</span></div>
<hr class="figure" /><div class="figure" 
><a 
 id="x18-890814"></a><img 
src="spde-tutorial102x.png" alt="PIC" class="graphics" width="422.52936pt" height="422.53621pt"  /><!--tex4ht:graphics  
name="spde-tutorial102x.png" src="figs/stpp-lstsresf.eps"  
-->
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;14.4: </span><span  
class="content">Spatial surface fitted at each time knot overlayed by the point pattern formed
by the points nearest to each time knot.</span></div><!--tex4ht:label?: x18-890814 -->
   </div><hr class="endfigure" />
                                                                                 
                                                                                 
   <!--l. 1--><div class="crosslinks"><p class="noindent">[<a 
href="spde-tutorialch15.html" >next</a>] [<a 
href="spde-tutorialch13.html" >prev</a>] [<a 
href="spde-tutorialch13.html#tailspde-tutorialch13.html" >prev-tail</a>] [<a 
href="spde-tutorialch14.html" >front</a>] [<a 
href="spde-tutorial3.html#spde-tutorialch14.html" >up</a>] </p></div>
<!--l. 1--><p class="indent" >   <a 
 id="tailspde-tutorialch14.html"></a>   </p> 
</body></html> 
